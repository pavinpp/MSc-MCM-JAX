
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for project JAX-LaB">
      
      
      
        <link rel="canonical" href="https://example.com/multiphase/">
      
      
        <link rel="prev" href="../models/">
      
      
        <link rel="next" href="../lattice/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>JAX-LaB multiphase - </title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white-grey" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#src.multiphase.Multiphase" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="" class="md-header__button md-logo" aria-label="" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              JAX-LaB multiphase
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white-grey" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/piyush-ppradhan/JAX-LaB" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="" class="md-nav__button md-logo" aria-label="" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/piyush-ppradhan/JAX-LaB" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JAX-LaB's home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    JAX-LaB API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    JAX-LaB API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JAX-LaB base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JAX-LaB models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    JAX-LaB multiphase
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    JAX-LaB multiphase
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiphase
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multiphase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase--references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_bc" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_bc
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="apply_bc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_bc--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_bc--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_contact_angle" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_contact_angle
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="apply_contact_angle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_contact_angle--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_contact_angle--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_contact_angle--reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reference:
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_force" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_force
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="apply_force">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_force--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_force--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.assign_fields_sharded" class="md-nav__link">
    <span class="md-ellipsis">
      
        assign_fields_sharded
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="assign_fields_sharded">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.assign_fields_sharded--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.assign_fields_sharded--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.collision" class="md-nav__link">
    <span class="md-ellipsis">
      
        collision
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_ff_greens_function" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_ff_greens_function
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_ff_greens_function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_ff_greens_function--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_ff_greens_function--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_fluid_fluid_force" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_fluid_fluid_force
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_fluid_fluid_force">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_fluid_fluid_force--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_fluid_fluid_force--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_force" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_force
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_force">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_force--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_force--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_potential" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_potential
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_potential">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_potential--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_potential--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_pressure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_pressure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_pressure--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_pressure--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_density" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_total_density
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_total_density">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_density--parmeters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parmeters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_density--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_total_pressure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_total_pressure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_pressure--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_pressure--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_velocity" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_total_velocity
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_total_velocity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_velocity--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_velocity--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.equilibrium" class="md-nav__link">
    <span class="md-ellipsis">
      
        equilibrium
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="equilibrium">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.equilibrium--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.equilibrium--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.get_solid_mask_streamed" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_solid_mask_streamed
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_solid_mask_streamed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.get_solid_mask_streamed--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.get_solid_mask_streamed--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.handle_io_timestep" class="md-nav__link">
    <span class="md-ellipsis">
      
        handle_io_timestep
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="handle_io_timestep">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.handle_io_timestep--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.handle_io_timestep--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.macroscopic_velocity" class="md-nav__link">
    <span class="md-ellipsis">
      
        macroscopic_velocity
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="macroscopic_velocity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.macroscopic_velocity--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.macroscopic_velocity--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.run" class="md-nav__link">
    <span class="md-ellipsis">
      
        run
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.run--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.run--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.step" class="md-nav__link">
    <span class="md-ellipsis">
      
        step
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="step">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.step--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.step--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.update_macroscopic" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_macroscopic
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="update_macroscopic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.update_macroscopic--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.update_macroscopic--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseBGK" class="md-nav__link">
    <span class="md-ellipsis">
      
        MultiphaseBGK
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseBGK.collision" class="md-nav__link">
    <span class="md-ellipsis">
      
        collision
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseMRT" class="md-nav__link">
    <span class="md-ellipsis">
      
        MultiphaseMRT
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseMRT.apply_force" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_force
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="apply_force">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseMRT.apply_force--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseMRT.apply_force--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseMRT.collision" class="md-nav__link">
    <span class="md-ellipsis">
      
        collision
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade" class="md-nav__link">
    <span class="md-ellipsis">
      
        MultiphaseCascade
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.apply_force" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_force
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="apply_force">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.apply_force--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.apply_force--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.collision" class="md-nav__link">
    <span class="md-ellipsis">
      
        collision
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.compute_eq_central_moments" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_eq_central_moments
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_eq_central_moments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.compute_eq_central_moments--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.compute_eq_central_moments--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.compute_force_central_moments" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_force_central_moments
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_force_central_moments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.compute_force_central_moments--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.compute_force_central_moments--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lattice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JAX-LaB lattice
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JAX-LaB utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../boundary_conditions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JAX-LaB boundary conditions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiphase
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multiphase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase--references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_bc" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_bc
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="apply_bc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_bc--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_bc--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_contact_angle" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_contact_angle
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="apply_contact_angle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_contact_angle--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_contact_angle--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_contact_angle--reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reference:
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_force" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_force
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="apply_force">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_force--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.apply_force--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.assign_fields_sharded" class="md-nav__link">
    <span class="md-ellipsis">
      
        assign_fields_sharded
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="assign_fields_sharded">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.assign_fields_sharded--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.assign_fields_sharded--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.collision" class="md-nav__link">
    <span class="md-ellipsis">
      
        collision
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_ff_greens_function" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_ff_greens_function
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_ff_greens_function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_ff_greens_function--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_ff_greens_function--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_fluid_fluid_force" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_fluid_fluid_force
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_fluid_fluid_force">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_fluid_fluid_force--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_fluid_fluid_force--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_force" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_force
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_force">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_force--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_force--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_potential" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_potential
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_potential">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_potential--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_potential--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_pressure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_pressure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_pressure--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_pressure--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_density" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_total_density
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_total_density">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_density--parmeters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parmeters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_density--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_total_pressure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_total_pressure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_pressure--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_pressure--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_velocity" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_total_velocity
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_total_velocity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_velocity--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.compute_total_velocity--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.equilibrium" class="md-nav__link">
    <span class="md-ellipsis">
      
        equilibrium
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="equilibrium">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.equilibrium--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.equilibrium--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.get_solid_mask_streamed" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_solid_mask_streamed
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_solid_mask_streamed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.get_solid_mask_streamed--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.get_solid_mask_streamed--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.handle_io_timestep" class="md-nav__link">
    <span class="md-ellipsis">
      
        handle_io_timestep
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="handle_io_timestep">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.handle_io_timestep--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.handle_io_timestep--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.macroscopic_velocity" class="md-nav__link">
    <span class="md-ellipsis">
      
        macroscopic_velocity
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="macroscopic_velocity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.macroscopic_velocity--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.macroscopic_velocity--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.run" class="md-nav__link">
    <span class="md-ellipsis">
      
        run
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.run--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.run--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.step" class="md-nav__link">
    <span class="md-ellipsis">
      
        step
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="step">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.step--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.step--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.update_macroscopic" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_macroscopic
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="update_macroscopic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.update_macroscopic--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.Multiphase.update_macroscopic--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseBGK" class="md-nav__link">
    <span class="md-ellipsis">
      
        MultiphaseBGK
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseBGK.collision" class="md-nav__link">
    <span class="md-ellipsis">
      
        collision
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseMRT" class="md-nav__link">
    <span class="md-ellipsis">
      
        MultiphaseMRT
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseMRT.apply_force" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_force
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="apply_force">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseMRT.apply_force--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseMRT.apply_force--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseMRT.collision" class="md-nav__link">
    <span class="md-ellipsis">
      
        collision
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade" class="md-nav__link">
    <span class="md-ellipsis">
      
        MultiphaseCascade
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.apply_force" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_force
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="apply_force">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.apply_force--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.apply_force--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.collision" class="md-nav__link">
    <span class="md-ellipsis">
      
        collision
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.compute_eq_central_moments" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_eq_central_moments
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_eq_central_moments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.compute_eq_central_moments--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.compute_eq_central_moments--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.compute_force_central_moments" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_force_central_moments
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_force_central_moments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.compute_force_central_moments--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.multiphase.MultiphaseCascade.compute_force_central_moments--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>JAX-LaB multiphase</h1>

<div class="doc doc-object doc-class">



<a id="src.multiphase.Multiphase"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.base.LBMBase" href="../base/#src.base.LBMBase">LBMBase</a></code></p>



        <p>Multiphase model, based on the Shan-Chen method. To model the fluid, an equation of state (EOS) is defined by the user.
Sequence of computation is pressure (EOS, dependent on the density and temperature) &ndash;&gt; effective mass (phi).
Can model both single component multiphase (SCMP) and multi-component multiphase (MCMP).</p>
<h3 id="src.multiphase.Multiphase--parameters">Parameters</h3>
<p>k (list): Modification coefficient, used to tune surface tension.</p>
<p>A (numpy.ndarray): Weighting factor, used for linear combination of Shan-Chen and Zhang-Chen Forces</p>
<p>g_kk (numpy.ndarray): Inter component interaction strength. Its a matrix of size n_components x n_components. It must be symmetric.</p>
<h3 id="src.multiphase.Multiphase--references">References</h3>
<ol>
<li>
<p>Shan, Xiaowen, and Hudong Chen. Lattice Boltzmann Model for Simulating Flows with Multiple Phases and Components.
    Physical Review E 47, no. 3 (March 1, 1993): 1815-19. https://doi.org/10.1103/PhysRevE.47.1815.</p>
</li>
<li>
<p>Yuan, Peng, and Laura Schaefer. Equations of State in a Lattice Boltzmann Model.
    Physics of Fluids 18, no. 4 (April 3, 2006): 042101. https://doi.org/10.1063/1.2187070.</p>
</li>
</ol>
<h3 id="src.multiphase.Multiphase--notes">Notes</h3>
<ol>
<li>The boundary conditions for each component is handeled separately. For example a wall BC for two-component system must be
defined twice, once for each component (see examples for details).</li>
<li>Pytrees store component-specific values; order is as defined in initialize_macroscopic_fields by the user.</li>
<li>Length of pytrees is equal to the no of components in the system.</li>
<li>All component-specific values passed as a list or an array by the user must be set according to the sequence defined in the initialize_macroscopic_fields.</li>
</ol>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/multiphase.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-39">  39</a></span>
<span class="normal"><a href="#__codelineno-0-40">  40</a></span>
<span class="normal"><a href="#__codelineno-0-41">  41</a></span>
<span class="normal"><a href="#__codelineno-0-42">  42</a></span>
<span class="normal"><a href="#__codelineno-0-43">  43</a></span>
<span class="normal"><a href="#__codelineno-0-44">  44</a></span>
<span class="normal"><a href="#__codelineno-0-45">  45</a></span>
<span class="normal"><a href="#__codelineno-0-46">  46</a></span>
<span class="normal"><a href="#__codelineno-0-47">  47</a></span>
<span class="normal"><a href="#__codelineno-0-48">  48</a></span>
<span class="normal"><a href="#__codelineno-0-49">  49</a></span>
<span class="normal"><a href="#__codelineno-0-50">  50</a></span>
<span class="normal"><a href="#__codelineno-0-51">  51</a></span>
<span class="normal"><a href="#__codelineno-0-52">  52</a></span>
<span class="normal"><a href="#__codelineno-0-53">  53</a></span>
<span class="normal"><a href="#__codelineno-0-54">  54</a></span>
<span class="normal"><a href="#__codelineno-0-55">  55</a></span>
<span class="normal"><a href="#__codelineno-0-56">  56</a></span>
<span class="normal"><a href="#__codelineno-0-57">  57</a></span>
<span class="normal"><a href="#__codelineno-0-58">  58</a></span>
<span class="normal"><a href="#__codelineno-0-59">  59</a></span>
<span class="normal"><a href="#__codelineno-0-60">  60</a></span>
<span class="normal"><a href="#__codelineno-0-61">  61</a></span>
<span class="normal"><a href="#__codelineno-0-62">  62</a></span>
<span class="normal"><a href="#__codelineno-0-63">  63</a></span>
<span class="normal"><a href="#__codelineno-0-64">  64</a></span>
<span class="normal"><a href="#__codelineno-0-65">  65</a></span>
<span class="normal"><a href="#__codelineno-0-66">  66</a></span>
<span class="normal"><a href="#__codelineno-0-67">  67</a></span>
<span class="normal"><a href="#__codelineno-0-68">  68</a></span>
<span class="normal"><a href="#__codelineno-0-69">  69</a></span>
<span class="normal"><a href="#__codelineno-0-70">  70</a></span>
<span class="normal"><a href="#__codelineno-0-71">  71</a></span>
<span class="normal"><a href="#__codelineno-0-72">  72</a></span>
<span class="normal"><a href="#__codelineno-0-73">  73</a></span>
<span class="normal"><a href="#__codelineno-0-74">  74</a></span>
<span class="normal"><a href="#__codelineno-0-75">  75</a></span>
<span class="normal"><a href="#__codelineno-0-76">  76</a></span>
<span class="normal"><a href="#__codelineno-0-77">  77</a></span>
<span class="normal"><a href="#__codelineno-0-78">  78</a></span>
<span class="normal"><a href="#__codelineno-0-79">  79</a></span>
<span class="normal"><a href="#__codelineno-0-80">  80</a></span>
<span class="normal"><a href="#__codelineno-0-81">  81</a></span>
<span class="normal"><a href="#__codelineno-0-82">  82</a></span>
<span class="normal"><a href="#__codelineno-0-83">  83</a></span>
<span class="normal"><a href="#__codelineno-0-84">  84</a></span>
<span class="normal"><a href="#__codelineno-0-85">  85</a></span>
<span class="normal"><a href="#__codelineno-0-86">  86</a></span>
<span class="normal"><a href="#__codelineno-0-87">  87</a></span>
<span class="normal"><a href="#__codelineno-0-88">  88</a></span>
<span class="normal"><a href="#__codelineno-0-89">  89</a></span>
<span class="normal"><a href="#__codelineno-0-90">  90</a></span>
<span class="normal"><a href="#__codelineno-0-91">  91</a></span>
<span class="normal"><a href="#__codelineno-0-92">  92</a></span>
<span class="normal"><a href="#__codelineno-0-93">  93</a></span>
<span class="normal"><a href="#__codelineno-0-94">  94</a></span>
<span class="normal"><a href="#__codelineno-0-95">  95</a></span>
<span class="normal"><a href="#__codelineno-0-96">  96</a></span>
<span class="normal"><a href="#__codelineno-0-97">  97</a></span>
<span class="normal"><a href="#__codelineno-0-98">  98</a></span>
<span class="normal"><a href="#__codelineno-0-99">  99</a></span>
<span class="normal"><a href="#__codelineno-0-100"> 100</a></span>
<span class="normal"><a href="#__codelineno-0-101"> 101</a></span>
<span class="normal"><a href="#__codelineno-0-102"> 102</a></span>
<span class="normal"><a href="#__codelineno-0-103"> 103</a></span>
<span class="normal"><a href="#__codelineno-0-104"> 104</a></span>
<span class="normal"><a href="#__codelineno-0-105"> 105</a></span>
<span class="normal"><a href="#__codelineno-0-106"> 106</a></span>
<span class="normal"><a href="#__codelineno-0-107"> 107</a></span>
<span class="normal"><a href="#__codelineno-0-108"> 108</a></span>
<span class="normal"><a href="#__codelineno-0-109"> 109</a></span>
<span class="normal"><a href="#__codelineno-0-110"> 110</a></span>
<span class="normal"><a href="#__codelineno-0-111"> 111</a></span>
<span class="normal"><a href="#__codelineno-0-112"> 112</a></span>
<span class="normal"><a href="#__codelineno-0-113"> 113</a></span>
<span class="normal"><a href="#__codelineno-0-114"> 114</a></span>
<span class="normal"><a href="#__codelineno-0-115"> 115</a></span>
<span class="normal"><a href="#__codelineno-0-116"> 116</a></span>
<span class="normal"><a href="#__codelineno-0-117"> 117</a></span>
<span class="normal"><a href="#__codelineno-0-118"> 118</a></span>
<span class="normal"><a href="#__codelineno-0-119"> 119</a></span>
<span class="normal"><a href="#__codelineno-0-120"> 120</a></span>
<span class="normal"><a href="#__codelineno-0-121"> 121</a></span>
<span class="normal"><a href="#__codelineno-0-122"> 122</a></span>
<span class="normal"><a href="#__codelineno-0-123"> 123</a></span>
<span class="normal"><a href="#__codelineno-0-124"> 124</a></span>
<span class="normal"><a href="#__codelineno-0-125"> 125</a></span>
<span class="normal"><a href="#__codelineno-0-126"> 126</a></span>
<span class="normal"><a href="#__codelineno-0-127"> 127</a></span>
<span class="normal"><a href="#__codelineno-0-128"> 128</a></span>
<span class="normal"><a href="#__codelineno-0-129"> 129</a></span>
<span class="normal"><a href="#__codelineno-0-130"> 130</a></span>
<span class="normal"><a href="#__codelineno-0-131"> 131</a></span>
<span class="normal"><a href="#__codelineno-0-132"> 132</a></span>
<span class="normal"><a href="#__codelineno-0-133"> 133</a></span>
<span class="normal"><a href="#__codelineno-0-134"> 134</a></span>
<span class="normal"><a href="#__codelineno-0-135"> 135</a></span>
<span class="normal"><a href="#__codelineno-0-136"> 136</a></span>
<span class="normal"><a href="#__codelineno-0-137"> 137</a></span>
<span class="normal"><a href="#__codelineno-0-138"> 138</a></span>
<span class="normal"><a href="#__codelineno-0-139"> 139</a></span>
<span class="normal"><a href="#__codelineno-0-140"> 140</a></span>
<span class="normal"><a href="#__codelineno-0-141"> 141</a></span>
<span class="normal"><a href="#__codelineno-0-142"> 142</a></span>
<span class="normal"><a href="#__codelineno-0-143"> 143</a></span>
<span class="normal"><a href="#__codelineno-0-144"> 144</a></span>
<span class="normal"><a href="#__codelineno-0-145"> 145</a></span>
<span class="normal"><a href="#__codelineno-0-146"> 146</a></span>
<span class="normal"><a href="#__codelineno-0-147"> 147</a></span>
<span class="normal"><a href="#__codelineno-0-148"> 148</a></span>
<span class="normal"><a href="#__codelineno-0-149"> 149</a></span>
<span class="normal"><a href="#__codelineno-0-150"> 150</a></span>
<span class="normal"><a href="#__codelineno-0-151"> 151</a></span>
<span class="normal"><a href="#__codelineno-0-152"> 152</a></span>
<span class="normal"><a href="#__codelineno-0-153"> 153</a></span>
<span class="normal"><a href="#__codelineno-0-154"> 154</a></span>
<span class="normal"><a href="#__codelineno-0-155"> 155</a></span>
<span class="normal"><a href="#__codelineno-0-156"> 156</a></span>
<span class="normal"><a href="#__codelineno-0-157"> 157</a></span>
<span class="normal"><a href="#__codelineno-0-158"> 158</a></span>
<span class="normal"><a href="#__codelineno-0-159"> 159</a></span>
<span class="normal"><a href="#__codelineno-0-160"> 160</a></span>
<span class="normal"><a href="#__codelineno-0-161"> 161</a></span>
<span class="normal"><a href="#__codelineno-0-162"> 162</a></span>
<span class="normal"><a href="#__codelineno-0-163"> 163</a></span>
<span class="normal"><a href="#__codelineno-0-164"> 164</a></span>
<span class="normal"><a href="#__codelineno-0-165"> 165</a></span>
<span class="normal"><a href="#__codelineno-0-166"> 166</a></span>
<span class="normal"><a href="#__codelineno-0-167"> 167</a></span>
<span class="normal"><a href="#__codelineno-0-168"> 168</a></span>
<span class="normal"><a href="#__codelineno-0-169"> 169</a></span>
<span class="normal"><a href="#__codelineno-0-170"> 170</a></span>
<span class="normal"><a href="#__codelineno-0-171"> 171</a></span>
<span class="normal"><a href="#__codelineno-0-172"> 172</a></span>
<span class="normal"><a href="#__codelineno-0-173"> 173</a></span>
<span class="normal"><a href="#__codelineno-0-174"> 174</a></span>
<span class="normal"><a href="#__codelineno-0-175"> 175</a></span>
<span class="normal"><a href="#__codelineno-0-176"> 176</a></span>
<span class="normal"><a href="#__codelineno-0-177"> 177</a></span>
<span class="normal"><a href="#__codelineno-0-178"> 178</a></span>
<span class="normal"><a href="#__codelineno-0-179"> 179</a></span>
<span class="normal"><a href="#__codelineno-0-180"> 180</a></span>
<span class="normal"><a href="#__codelineno-0-181"> 181</a></span>
<span class="normal"><a href="#__codelineno-0-182"> 182</a></span>
<span class="normal"><a href="#__codelineno-0-183"> 183</a></span>
<span class="normal"><a href="#__codelineno-0-184"> 184</a></span>
<span class="normal"><a href="#__codelineno-0-185"> 185</a></span>
<span class="normal"><a href="#__codelineno-0-186"> 186</a></span>
<span class="normal"><a href="#__codelineno-0-187"> 187</a></span>
<span class="normal"><a href="#__codelineno-0-188"> 188</a></span>
<span class="normal"><a href="#__codelineno-0-189"> 189</a></span>
<span class="normal"><a href="#__codelineno-0-190"> 190</a></span>
<span class="normal"><a href="#__codelineno-0-191"> 191</a></span>
<span class="normal"><a href="#__codelineno-0-192"> 192</a></span>
<span class="normal"><a href="#__codelineno-0-193"> 193</a></span>
<span class="normal"><a href="#__codelineno-0-194"> 194</a></span>
<span class="normal"><a href="#__codelineno-0-195"> 195</a></span>
<span class="normal"><a href="#__codelineno-0-196"> 196</a></span>
<span class="normal"><a href="#__codelineno-0-197"> 197</a></span>
<span class="normal"><a href="#__codelineno-0-198"> 198</a></span>
<span class="normal"><a href="#__codelineno-0-199"> 199</a></span>
<span class="normal"><a href="#__codelineno-0-200"> 200</a></span>
<span class="normal"><a href="#__codelineno-0-201"> 201</a></span>
<span class="normal"><a href="#__codelineno-0-202"> 202</a></span>
<span class="normal"><a href="#__codelineno-0-203"> 203</a></span>
<span class="normal"><a href="#__codelineno-0-204"> 204</a></span>
<span class="normal"><a href="#__codelineno-0-205"> 205</a></span>
<span class="normal"><a href="#__codelineno-0-206"> 206</a></span>
<span class="normal"><a href="#__codelineno-0-207"> 207</a></span>
<span class="normal"><a href="#__codelineno-0-208"> 208</a></span>
<span class="normal"><a href="#__codelineno-0-209"> 209</a></span>
<span class="normal"><a href="#__codelineno-0-210"> 210</a></span>
<span class="normal"><a href="#__codelineno-0-211"> 211</a></span>
<span class="normal"><a href="#__codelineno-0-212"> 212</a></span>
<span class="normal"><a href="#__codelineno-0-213"> 213</a></span>
<span class="normal"><a href="#__codelineno-0-214"> 214</a></span>
<span class="normal"><a href="#__codelineno-0-215"> 215</a></span>
<span class="normal"><a href="#__codelineno-0-216"> 216</a></span>
<span class="normal"><a href="#__codelineno-0-217"> 217</a></span>
<span class="normal"><a href="#__codelineno-0-218"> 218</a></span>
<span class="normal"><a href="#__codelineno-0-219"> 219</a></span>
<span class="normal"><a href="#__codelineno-0-220"> 220</a></span>
<span class="normal"><a href="#__codelineno-0-221"> 221</a></span>
<span class="normal"><a href="#__codelineno-0-222"> 222</a></span>
<span class="normal"><a href="#__codelineno-0-223"> 223</a></span>
<span class="normal"><a href="#__codelineno-0-224"> 224</a></span>
<span class="normal"><a href="#__codelineno-0-225"> 225</a></span>
<span class="normal"><a href="#__codelineno-0-226"> 226</a></span>
<span class="normal"><a href="#__codelineno-0-227"> 227</a></span>
<span class="normal"><a href="#__codelineno-0-228"> 228</a></span>
<span class="normal"><a href="#__codelineno-0-229"> 229</a></span>
<span class="normal"><a href="#__codelineno-0-230"> 230</a></span>
<span class="normal"><a href="#__codelineno-0-231"> 231</a></span>
<span class="normal"><a href="#__codelineno-0-232"> 232</a></span>
<span class="normal"><a href="#__codelineno-0-233"> 233</a></span>
<span class="normal"><a href="#__codelineno-0-234"> 234</a></span>
<span class="normal"><a href="#__codelineno-0-235"> 235</a></span>
<span class="normal"><a href="#__codelineno-0-236"> 236</a></span>
<span class="normal"><a href="#__codelineno-0-237"> 237</a></span>
<span class="normal"><a href="#__codelineno-0-238"> 238</a></span>
<span class="normal"><a href="#__codelineno-0-239"> 239</a></span>
<span class="normal"><a href="#__codelineno-0-240"> 240</a></span>
<span class="normal"><a href="#__codelineno-0-241"> 241</a></span>
<span class="normal"><a href="#__codelineno-0-242"> 242</a></span>
<span class="normal"><a href="#__codelineno-0-243"> 243</a></span>
<span class="normal"><a href="#__codelineno-0-244"> 244</a></span>
<span class="normal"><a href="#__codelineno-0-245"> 245</a></span>
<span class="normal"><a href="#__codelineno-0-246"> 246</a></span>
<span class="normal"><a href="#__codelineno-0-247"> 247</a></span>
<span class="normal"><a href="#__codelineno-0-248"> 248</a></span>
<span class="normal"><a href="#__codelineno-0-249"> 249</a></span>
<span class="normal"><a href="#__codelineno-0-250"> 250</a></span>
<span class="normal"><a href="#__codelineno-0-251"> 251</a></span>
<span class="normal"><a href="#__codelineno-0-252"> 252</a></span>
<span class="normal"><a href="#__codelineno-0-253"> 253</a></span>
<span class="normal"><a href="#__codelineno-0-254"> 254</a></span>
<span class="normal"><a href="#__codelineno-0-255"> 255</a></span>
<span class="normal"><a href="#__codelineno-0-256"> 256</a></span>
<span class="normal"><a href="#__codelineno-0-257"> 257</a></span>
<span class="normal"><a href="#__codelineno-0-258"> 258</a></span>
<span class="normal"><a href="#__codelineno-0-259"> 259</a></span>
<span class="normal"><a href="#__codelineno-0-260"> 260</a></span>
<span class="normal"><a href="#__codelineno-0-261"> 261</a></span>
<span class="normal"><a href="#__codelineno-0-262"> 262</a></span>
<span class="normal"><a href="#__codelineno-0-263"> 263</a></span>
<span class="normal"><a href="#__codelineno-0-264"> 264</a></span>
<span class="normal"><a href="#__codelineno-0-265"> 265</a></span>
<span class="normal"><a href="#__codelineno-0-266"> 266</a></span>
<span class="normal"><a href="#__codelineno-0-267"> 267</a></span>
<span class="normal"><a href="#__codelineno-0-268"> 268</a></span>
<span class="normal"><a href="#__codelineno-0-269"> 269</a></span>
<span class="normal"><a href="#__codelineno-0-270"> 270</a></span>
<span class="normal"><a href="#__codelineno-0-271"> 271</a></span>
<span class="normal"><a href="#__codelineno-0-272"> 272</a></span>
<span class="normal"><a href="#__codelineno-0-273"> 273</a></span>
<span class="normal"><a href="#__codelineno-0-274"> 274</a></span>
<span class="normal"><a href="#__codelineno-0-275"> 275</a></span>
<span class="normal"><a href="#__codelineno-0-276"> 276</a></span>
<span class="normal"><a href="#__codelineno-0-277"> 277</a></span>
<span class="normal"><a href="#__codelineno-0-278"> 278</a></span>
<span class="normal"><a href="#__codelineno-0-279"> 279</a></span>
<span class="normal"><a href="#__codelineno-0-280"> 280</a></span>
<span class="normal"><a href="#__codelineno-0-281"> 281</a></span>
<span class="normal"><a href="#__codelineno-0-282"> 282</a></span>
<span class="normal"><a href="#__codelineno-0-283"> 283</a></span>
<span class="normal"><a href="#__codelineno-0-284"> 284</a></span>
<span class="normal"><a href="#__codelineno-0-285"> 285</a></span>
<span class="normal"><a href="#__codelineno-0-286"> 286</a></span>
<span class="normal"><a href="#__codelineno-0-287"> 287</a></span>
<span class="normal"><a href="#__codelineno-0-288"> 288</a></span>
<span class="normal"><a href="#__codelineno-0-289"> 289</a></span>
<span class="normal"><a href="#__codelineno-0-290"> 290</a></span>
<span class="normal"><a href="#__codelineno-0-291"> 291</a></span>
<span class="normal"><a href="#__codelineno-0-292"> 292</a></span>
<span class="normal"><a href="#__codelineno-0-293"> 293</a></span>
<span class="normal"><a href="#__codelineno-0-294"> 294</a></span>
<span class="normal"><a href="#__codelineno-0-295"> 295</a></span>
<span class="normal"><a href="#__codelineno-0-296"> 296</a></span>
<span class="normal"><a href="#__codelineno-0-297"> 297</a></span>
<span class="normal"><a href="#__codelineno-0-298"> 298</a></span>
<span class="normal"><a href="#__codelineno-0-299"> 299</a></span>
<span class="normal"><a href="#__codelineno-0-300"> 300</a></span>
<span class="normal"><a href="#__codelineno-0-301"> 301</a></span>
<span class="normal"><a href="#__codelineno-0-302"> 302</a></span>
<span class="normal"><a href="#__codelineno-0-303"> 303</a></span>
<span class="normal"><a href="#__codelineno-0-304"> 304</a></span>
<span class="normal"><a href="#__codelineno-0-305"> 305</a></span>
<span class="normal"><a href="#__codelineno-0-306"> 306</a></span>
<span class="normal"><a href="#__codelineno-0-307"> 307</a></span>
<span class="normal"><a href="#__codelineno-0-308"> 308</a></span>
<span class="normal"><a href="#__codelineno-0-309"> 309</a></span>
<span class="normal"><a href="#__codelineno-0-310"> 310</a></span>
<span class="normal"><a href="#__codelineno-0-311"> 311</a></span>
<span class="normal"><a href="#__codelineno-0-312"> 312</a></span>
<span class="normal"><a href="#__codelineno-0-313"> 313</a></span>
<span class="normal"><a href="#__codelineno-0-314"> 314</a></span>
<span class="normal"><a href="#__codelineno-0-315"> 315</a></span>
<span class="normal"><a href="#__codelineno-0-316"> 316</a></span>
<span class="normal"><a href="#__codelineno-0-317"> 317</a></span>
<span class="normal"><a href="#__codelineno-0-318"> 318</a></span>
<span class="normal"><a href="#__codelineno-0-319"> 319</a></span>
<span class="normal"><a href="#__codelineno-0-320"> 320</a></span>
<span class="normal"><a href="#__codelineno-0-321"> 321</a></span>
<span class="normal"><a href="#__codelineno-0-322"> 322</a></span>
<span class="normal"><a href="#__codelineno-0-323"> 323</a></span>
<span class="normal"><a href="#__codelineno-0-324"> 324</a></span>
<span class="normal"><a href="#__codelineno-0-325"> 325</a></span>
<span class="normal"><a href="#__codelineno-0-326"> 326</a></span>
<span class="normal"><a href="#__codelineno-0-327"> 327</a></span>
<span class="normal"><a href="#__codelineno-0-328"> 328</a></span>
<span class="normal"><a href="#__codelineno-0-329"> 329</a></span>
<span class="normal"><a href="#__codelineno-0-330"> 330</a></span>
<span class="normal"><a href="#__codelineno-0-331"> 331</a></span>
<span class="normal"><a href="#__codelineno-0-332"> 332</a></span>
<span class="normal"><a href="#__codelineno-0-333"> 333</a></span>
<span class="normal"><a href="#__codelineno-0-334"> 334</a></span>
<span class="normal"><a href="#__codelineno-0-335"> 335</a></span>
<span class="normal"><a href="#__codelineno-0-336"> 336</a></span>
<span class="normal"><a href="#__codelineno-0-337"> 337</a></span>
<span class="normal"><a href="#__codelineno-0-338"> 338</a></span>
<span class="normal"><a href="#__codelineno-0-339"> 339</a></span>
<span class="normal"><a href="#__codelineno-0-340"> 340</a></span>
<span class="normal"><a href="#__codelineno-0-341"> 341</a></span>
<span class="normal"><a href="#__codelineno-0-342"> 342</a></span>
<span class="normal"><a href="#__codelineno-0-343"> 343</a></span>
<span class="normal"><a href="#__codelineno-0-344"> 344</a></span>
<span class="normal"><a href="#__codelineno-0-345"> 345</a></span>
<span class="normal"><a href="#__codelineno-0-346"> 346</a></span>
<span class="normal"><a href="#__codelineno-0-347"> 347</a></span>
<span class="normal"><a href="#__codelineno-0-348"> 348</a></span>
<span class="normal"><a href="#__codelineno-0-349"> 349</a></span>
<span class="normal"><a href="#__codelineno-0-350"> 350</a></span>
<span class="normal"><a href="#__codelineno-0-351"> 351</a></span>
<span class="normal"><a href="#__codelineno-0-352"> 352</a></span>
<span class="normal"><a href="#__codelineno-0-353"> 353</a></span>
<span class="normal"><a href="#__codelineno-0-354"> 354</a></span>
<span class="normal"><a href="#__codelineno-0-355"> 355</a></span>
<span class="normal"><a href="#__codelineno-0-356"> 356</a></span>
<span class="normal"><a href="#__codelineno-0-357"> 357</a></span>
<span class="normal"><a href="#__codelineno-0-358"> 358</a></span>
<span class="normal"><a href="#__codelineno-0-359"> 359</a></span>
<span class="normal"><a href="#__codelineno-0-360"> 360</a></span>
<span class="normal"><a href="#__codelineno-0-361"> 361</a></span>
<span class="normal"><a href="#__codelineno-0-362"> 362</a></span>
<span class="normal"><a href="#__codelineno-0-363"> 363</a></span>
<span class="normal"><a href="#__codelineno-0-364"> 364</a></span>
<span class="normal"><a href="#__codelineno-0-365"> 365</a></span>
<span class="normal"><a href="#__codelineno-0-366"> 366</a></span>
<span class="normal"><a href="#__codelineno-0-367"> 367</a></span>
<span class="normal"><a href="#__codelineno-0-368"> 368</a></span>
<span class="normal"><a href="#__codelineno-0-369"> 369</a></span>
<span class="normal"><a href="#__codelineno-0-370"> 370</a></span>
<span class="normal"><a href="#__codelineno-0-371"> 371</a></span>
<span class="normal"><a href="#__codelineno-0-372"> 372</a></span>
<span class="normal"><a href="#__codelineno-0-373"> 373</a></span>
<span class="normal"><a href="#__codelineno-0-374"> 374</a></span>
<span class="normal"><a href="#__codelineno-0-375"> 375</a></span>
<span class="normal"><a href="#__codelineno-0-376"> 376</a></span>
<span class="normal"><a href="#__codelineno-0-377"> 377</a></span>
<span class="normal"><a href="#__codelineno-0-378"> 378</a></span>
<span class="normal"><a href="#__codelineno-0-379"> 379</a></span>
<span class="normal"><a href="#__codelineno-0-380"> 380</a></span>
<span class="normal"><a href="#__codelineno-0-381"> 381</a></span>
<span class="normal"><a href="#__codelineno-0-382"> 382</a></span>
<span class="normal"><a href="#__codelineno-0-383"> 383</a></span>
<span class="normal"><a href="#__codelineno-0-384"> 384</a></span>
<span class="normal"><a href="#__codelineno-0-385"> 385</a></span>
<span class="normal"><a href="#__codelineno-0-386"> 386</a></span>
<span class="normal"><a href="#__codelineno-0-387"> 387</a></span>
<span class="normal"><a href="#__codelineno-0-388"> 388</a></span>
<span class="normal"><a href="#__codelineno-0-389"> 389</a></span>
<span class="normal"><a href="#__codelineno-0-390"> 390</a></span>
<span class="normal"><a href="#__codelineno-0-391"> 391</a></span>
<span class="normal"><a href="#__codelineno-0-392"> 392</a></span>
<span class="normal"><a href="#__codelineno-0-393"> 393</a></span>
<span class="normal"><a href="#__codelineno-0-394"> 394</a></span>
<span class="normal"><a href="#__codelineno-0-395"> 395</a></span>
<span class="normal"><a href="#__codelineno-0-396"> 396</a></span>
<span class="normal"><a href="#__codelineno-0-397"> 397</a></span>
<span class="normal"><a href="#__codelineno-0-398"> 398</a></span>
<span class="normal"><a href="#__codelineno-0-399"> 399</a></span>
<span class="normal"><a href="#__codelineno-0-400"> 400</a></span>
<span class="normal"><a href="#__codelineno-0-401"> 401</a></span>
<span class="normal"><a href="#__codelineno-0-402"> 402</a></span>
<span class="normal"><a href="#__codelineno-0-403"> 403</a></span>
<span class="normal"><a href="#__codelineno-0-404"> 404</a></span>
<span class="normal"><a href="#__codelineno-0-405"> 405</a></span>
<span class="normal"><a href="#__codelineno-0-406"> 406</a></span>
<span class="normal"><a href="#__codelineno-0-407"> 407</a></span>
<span class="normal"><a href="#__codelineno-0-408"> 408</a></span>
<span class="normal"><a href="#__codelineno-0-409"> 409</a></span>
<span class="normal"><a href="#__codelineno-0-410"> 410</a></span>
<span class="normal"><a href="#__codelineno-0-411"> 411</a></span>
<span class="normal"><a href="#__codelineno-0-412"> 412</a></span>
<span class="normal"><a href="#__codelineno-0-413"> 413</a></span>
<span class="normal"><a href="#__codelineno-0-414"> 414</a></span>
<span class="normal"><a href="#__codelineno-0-415"> 415</a></span>
<span class="normal"><a href="#__codelineno-0-416"> 416</a></span>
<span class="normal"><a href="#__codelineno-0-417"> 417</a></span>
<span class="normal"><a href="#__codelineno-0-418"> 418</a></span>
<span class="normal"><a href="#__codelineno-0-419"> 419</a></span>
<span class="normal"><a href="#__codelineno-0-420"> 420</a></span>
<span class="normal"><a href="#__codelineno-0-421"> 421</a></span>
<span class="normal"><a href="#__codelineno-0-422"> 422</a></span>
<span class="normal"><a href="#__codelineno-0-423"> 423</a></span>
<span class="normal"><a href="#__codelineno-0-424"> 424</a></span>
<span class="normal"><a href="#__codelineno-0-425"> 425</a></span>
<span class="normal"><a href="#__codelineno-0-426"> 426</a></span>
<span class="normal"><a href="#__codelineno-0-427"> 427</a></span>
<span class="normal"><a href="#__codelineno-0-428"> 428</a></span>
<span class="normal"><a href="#__codelineno-0-429"> 429</a></span>
<span class="normal"><a href="#__codelineno-0-430"> 430</a></span>
<span class="normal"><a href="#__codelineno-0-431"> 431</a></span>
<span class="normal"><a href="#__codelineno-0-432"> 432</a></span>
<span class="normal"><a href="#__codelineno-0-433"> 433</a></span>
<span class="normal"><a href="#__codelineno-0-434"> 434</a></span>
<span class="normal"><a href="#__codelineno-0-435"> 435</a></span>
<span class="normal"><a href="#__codelineno-0-436"> 436</a></span>
<span class="normal"><a href="#__codelineno-0-437"> 437</a></span>
<span class="normal"><a href="#__codelineno-0-438"> 438</a></span>
<span class="normal"><a href="#__codelineno-0-439"> 439</a></span>
<span class="normal"><a href="#__codelineno-0-440"> 440</a></span>
<span class="normal"><a href="#__codelineno-0-441"> 441</a></span>
<span class="normal"><a href="#__codelineno-0-442"> 442</a></span>
<span class="normal"><a href="#__codelineno-0-443"> 443</a></span>
<span class="normal"><a href="#__codelineno-0-444"> 444</a></span>
<span class="normal"><a href="#__codelineno-0-445"> 445</a></span>
<span class="normal"><a href="#__codelineno-0-446"> 446</a></span>
<span class="normal"><a href="#__codelineno-0-447"> 447</a></span>
<span class="normal"><a href="#__codelineno-0-448"> 448</a></span>
<span class="normal"><a href="#__codelineno-0-449"> 449</a></span>
<span class="normal"><a href="#__codelineno-0-450"> 450</a></span>
<span class="normal"><a href="#__codelineno-0-451"> 451</a></span>
<span class="normal"><a href="#__codelineno-0-452"> 452</a></span>
<span class="normal"><a href="#__codelineno-0-453"> 453</a></span>
<span class="normal"><a href="#__codelineno-0-454"> 454</a></span>
<span class="normal"><a href="#__codelineno-0-455"> 455</a></span>
<span class="normal"><a href="#__codelineno-0-456"> 456</a></span>
<span class="normal"><a href="#__codelineno-0-457"> 457</a></span>
<span class="normal"><a href="#__codelineno-0-458"> 458</a></span>
<span class="normal"><a href="#__codelineno-0-459"> 459</a></span>
<span class="normal"><a href="#__codelineno-0-460"> 460</a></span>
<span class="normal"><a href="#__codelineno-0-461"> 461</a></span>
<span class="normal"><a href="#__codelineno-0-462"> 462</a></span>
<span class="normal"><a href="#__codelineno-0-463"> 463</a></span>
<span class="normal"><a href="#__codelineno-0-464"> 464</a></span>
<span class="normal"><a href="#__codelineno-0-465"> 465</a></span>
<span class="normal"><a href="#__codelineno-0-466"> 466</a></span>
<span class="normal"><a href="#__codelineno-0-467"> 467</a></span>
<span class="normal"><a href="#__codelineno-0-468"> 468</a></span>
<span class="normal"><a href="#__codelineno-0-469"> 469</a></span>
<span class="normal"><a href="#__codelineno-0-470"> 470</a></span>
<span class="normal"><a href="#__codelineno-0-471"> 471</a></span>
<span class="normal"><a href="#__codelineno-0-472"> 472</a></span>
<span class="normal"><a href="#__codelineno-0-473"> 473</a></span>
<span class="normal"><a href="#__codelineno-0-474"> 474</a></span>
<span class="normal"><a href="#__codelineno-0-475"> 475</a></span>
<span class="normal"><a href="#__codelineno-0-476"> 476</a></span>
<span class="normal"><a href="#__codelineno-0-477"> 477</a></span>
<span class="normal"><a href="#__codelineno-0-478"> 478</a></span>
<span class="normal"><a href="#__codelineno-0-479"> 479</a></span>
<span class="normal"><a href="#__codelineno-0-480"> 480</a></span>
<span class="normal"><a href="#__codelineno-0-481"> 481</a></span>
<span class="normal"><a href="#__codelineno-0-482"> 482</a></span>
<span class="normal"><a href="#__codelineno-0-483"> 483</a></span>
<span class="normal"><a href="#__codelineno-0-484"> 484</a></span>
<span class="normal"><a href="#__codelineno-0-485"> 485</a></span>
<span class="normal"><a href="#__codelineno-0-486"> 486</a></span>
<span class="normal"><a href="#__codelineno-0-487"> 487</a></span>
<span class="normal"><a href="#__codelineno-0-488"> 488</a></span>
<span class="normal"><a href="#__codelineno-0-489"> 489</a></span>
<span class="normal"><a href="#__codelineno-0-490"> 490</a></span>
<span class="normal"><a href="#__codelineno-0-491"> 491</a></span>
<span class="normal"><a href="#__codelineno-0-492"> 492</a></span>
<span class="normal"><a href="#__codelineno-0-493"> 493</a></span>
<span class="normal"><a href="#__codelineno-0-494"> 494</a></span>
<span class="normal"><a href="#__codelineno-0-495"> 495</a></span>
<span class="normal"><a href="#__codelineno-0-496"> 496</a></span>
<span class="normal"><a href="#__codelineno-0-497"> 497</a></span>
<span class="normal"><a href="#__codelineno-0-498"> 498</a></span>
<span class="normal"><a href="#__codelineno-0-499"> 499</a></span>
<span class="normal"><a href="#__codelineno-0-500"> 500</a></span>
<span class="normal"><a href="#__codelineno-0-501"> 501</a></span>
<span class="normal"><a href="#__codelineno-0-502"> 502</a></span>
<span class="normal"><a href="#__codelineno-0-503"> 503</a></span>
<span class="normal"><a href="#__codelineno-0-504"> 504</a></span>
<span class="normal"><a href="#__codelineno-0-505"> 505</a></span>
<span class="normal"><a href="#__codelineno-0-506"> 506</a></span>
<span class="normal"><a href="#__codelineno-0-507"> 507</a></span>
<span class="normal"><a href="#__codelineno-0-508"> 508</a></span>
<span class="normal"><a href="#__codelineno-0-509"> 509</a></span>
<span class="normal"><a href="#__codelineno-0-510"> 510</a></span>
<span class="normal"><a href="#__codelineno-0-511"> 511</a></span>
<span class="normal"><a href="#__codelineno-0-512"> 512</a></span>
<span class="normal"><a href="#__codelineno-0-513"> 513</a></span>
<span class="normal"><a href="#__codelineno-0-514"> 514</a></span>
<span class="normal"><a href="#__codelineno-0-515"> 515</a></span>
<span class="normal"><a href="#__codelineno-0-516"> 516</a></span>
<span class="normal"><a href="#__codelineno-0-517"> 517</a></span>
<span class="normal"><a href="#__codelineno-0-518"> 518</a></span>
<span class="normal"><a href="#__codelineno-0-519"> 519</a></span>
<span class="normal"><a href="#__codelineno-0-520"> 520</a></span>
<span class="normal"><a href="#__codelineno-0-521"> 521</a></span>
<span class="normal"><a href="#__codelineno-0-522"> 522</a></span>
<span class="normal"><a href="#__codelineno-0-523"> 523</a></span>
<span class="normal"><a href="#__codelineno-0-524"> 524</a></span>
<span class="normal"><a href="#__codelineno-0-525"> 525</a></span>
<span class="normal"><a href="#__codelineno-0-526"> 526</a></span>
<span class="normal"><a href="#__codelineno-0-527"> 527</a></span>
<span class="normal"><a href="#__codelineno-0-528"> 528</a></span>
<span class="normal"><a href="#__codelineno-0-529"> 529</a></span>
<span class="normal"><a href="#__codelineno-0-530"> 530</a></span>
<span class="normal"><a href="#__codelineno-0-531"> 531</a></span>
<span class="normal"><a href="#__codelineno-0-532"> 532</a></span>
<span class="normal"><a href="#__codelineno-0-533"> 533</a></span>
<span class="normal"><a href="#__codelineno-0-534"> 534</a></span>
<span class="normal"><a href="#__codelineno-0-535"> 535</a></span>
<span class="normal"><a href="#__codelineno-0-536"> 536</a></span>
<span class="normal"><a href="#__codelineno-0-537"> 537</a></span>
<span class="normal"><a href="#__codelineno-0-538"> 538</a></span>
<span class="normal"><a href="#__codelineno-0-539"> 539</a></span>
<span class="normal"><a href="#__codelineno-0-540"> 540</a></span>
<span class="normal"><a href="#__codelineno-0-541"> 541</a></span>
<span class="normal"><a href="#__codelineno-0-542"> 542</a></span>
<span class="normal"><a href="#__codelineno-0-543"> 543</a></span>
<span class="normal"><a href="#__codelineno-0-544"> 544</a></span>
<span class="normal"><a href="#__codelineno-0-545"> 545</a></span>
<span class="normal"><a href="#__codelineno-0-546"> 546</a></span>
<span class="normal"><a href="#__codelineno-0-547"> 547</a></span>
<span class="normal"><a href="#__codelineno-0-548"> 548</a></span>
<span class="normal"><a href="#__codelineno-0-549"> 549</a></span>
<span class="normal"><a href="#__codelineno-0-550"> 550</a></span>
<span class="normal"><a href="#__codelineno-0-551"> 551</a></span>
<span class="normal"><a href="#__codelineno-0-552"> 552</a></span>
<span class="normal"><a href="#__codelineno-0-553"> 553</a></span>
<span class="normal"><a href="#__codelineno-0-554"> 554</a></span>
<span class="normal"><a href="#__codelineno-0-555"> 555</a></span>
<span class="normal"><a href="#__codelineno-0-556"> 556</a></span>
<span class="normal"><a href="#__codelineno-0-557"> 557</a></span>
<span class="normal"><a href="#__codelineno-0-558"> 558</a></span>
<span class="normal"><a href="#__codelineno-0-559"> 559</a></span>
<span class="normal"><a href="#__codelineno-0-560"> 560</a></span>
<span class="normal"><a href="#__codelineno-0-561"> 561</a></span>
<span class="normal"><a href="#__codelineno-0-562"> 562</a></span>
<span class="normal"><a href="#__codelineno-0-563"> 563</a></span>
<span class="normal"><a href="#__codelineno-0-564"> 564</a></span>
<span class="normal"><a href="#__codelineno-0-565"> 565</a></span>
<span class="normal"><a href="#__codelineno-0-566"> 566</a></span>
<span class="normal"><a href="#__codelineno-0-567"> 567</a></span>
<span class="normal"><a href="#__codelineno-0-568"> 568</a></span>
<span class="normal"><a href="#__codelineno-0-569"> 569</a></span>
<span class="normal"><a href="#__codelineno-0-570"> 570</a></span>
<span class="normal"><a href="#__codelineno-0-571"> 571</a></span>
<span class="normal"><a href="#__codelineno-0-572"> 572</a></span>
<span class="normal"><a href="#__codelineno-0-573"> 573</a></span>
<span class="normal"><a href="#__codelineno-0-574"> 574</a></span>
<span class="normal"><a href="#__codelineno-0-575"> 575</a></span>
<span class="normal"><a href="#__codelineno-0-576"> 576</a></span>
<span class="normal"><a href="#__codelineno-0-577"> 577</a></span>
<span class="normal"><a href="#__codelineno-0-578"> 578</a></span>
<span class="normal"><a href="#__codelineno-0-579"> 579</a></span>
<span class="normal"><a href="#__codelineno-0-580"> 580</a></span>
<span class="normal"><a href="#__codelineno-0-581"> 581</a></span>
<span class="normal"><a href="#__codelineno-0-582"> 582</a></span>
<span class="normal"><a href="#__codelineno-0-583"> 583</a></span>
<span class="normal"><a href="#__codelineno-0-584"> 584</a></span>
<span class="normal"><a href="#__codelineno-0-585"> 585</a></span>
<span class="normal"><a href="#__codelineno-0-586"> 586</a></span>
<span class="normal"><a href="#__codelineno-0-587"> 587</a></span>
<span class="normal"><a href="#__codelineno-0-588"> 588</a></span>
<span class="normal"><a href="#__codelineno-0-589"> 589</a></span>
<span class="normal"><a href="#__codelineno-0-590"> 590</a></span>
<span class="normal"><a href="#__codelineno-0-591"> 591</a></span>
<span class="normal"><a href="#__codelineno-0-592"> 592</a></span>
<span class="normal"><a href="#__codelineno-0-593"> 593</a></span>
<span class="normal"><a href="#__codelineno-0-594"> 594</a></span>
<span class="normal"><a href="#__codelineno-0-595"> 595</a></span>
<span class="normal"><a href="#__codelineno-0-596"> 596</a></span>
<span class="normal"><a href="#__codelineno-0-597"> 597</a></span>
<span class="normal"><a href="#__codelineno-0-598"> 598</a></span>
<span class="normal"><a href="#__codelineno-0-599"> 599</a></span>
<span class="normal"><a href="#__codelineno-0-600"> 600</a></span>
<span class="normal"><a href="#__codelineno-0-601"> 601</a></span>
<span class="normal"><a href="#__codelineno-0-602"> 602</a></span>
<span class="normal"><a href="#__codelineno-0-603"> 603</a></span>
<span class="normal"><a href="#__codelineno-0-604"> 604</a></span>
<span class="normal"><a href="#__codelineno-0-605"> 605</a></span>
<span class="normal"><a href="#__codelineno-0-606"> 606</a></span>
<span class="normal"><a href="#__codelineno-0-607"> 607</a></span>
<span class="normal"><a href="#__codelineno-0-608"> 608</a></span>
<span class="normal"><a href="#__codelineno-0-609"> 609</a></span>
<span class="normal"><a href="#__codelineno-0-610"> 610</a></span>
<span class="normal"><a href="#__codelineno-0-611"> 611</a></span>
<span class="normal"><a href="#__codelineno-0-612"> 612</a></span>
<span class="normal"><a href="#__codelineno-0-613"> 613</a></span>
<span class="normal"><a href="#__codelineno-0-614"> 614</a></span>
<span class="normal"><a href="#__codelineno-0-615"> 615</a></span>
<span class="normal"><a href="#__codelineno-0-616"> 616</a></span>
<span class="normal"><a href="#__codelineno-0-617"> 617</a></span>
<span class="normal"><a href="#__codelineno-0-618"> 618</a></span>
<span class="normal"><a href="#__codelineno-0-619"> 619</a></span>
<span class="normal"><a href="#__codelineno-0-620"> 620</a></span>
<span class="normal"><a href="#__codelineno-0-621"> 621</a></span>
<span class="normal"><a href="#__codelineno-0-622"> 622</a></span>
<span class="normal"><a href="#__codelineno-0-623"> 623</a></span>
<span class="normal"><a href="#__codelineno-0-624"> 624</a></span>
<span class="normal"><a href="#__codelineno-0-625"> 625</a></span>
<span class="normal"><a href="#__codelineno-0-626"> 626</a></span>
<span class="normal"><a href="#__codelineno-0-627"> 627</a></span>
<span class="normal"><a href="#__codelineno-0-628"> 628</a></span>
<span class="normal"><a href="#__codelineno-0-629"> 629</a></span>
<span class="normal"><a href="#__codelineno-0-630"> 630</a></span>
<span class="normal"><a href="#__codelineno-0-631"> 631</a></span>
<span class="normal"><a href="#__codelineno-0-632"> 632</a></span>
<span class="normal"><a href="#__codelineno-0-633"> 633</a></span>
<span class="normal"><a href="#__codelineno-0-634"> 634</a></span>
<span class="normal"><a href="#__codelineno-0-635"> 635</a></span>
<span class="normal"><a href="#__codelineno-0-636"> 636</a></span>
<span class="normal"><a href="#__codelineno-0-637"> 637</a></span>
<span class="normal"><a href="#__codelineno-0-638"> 638</a></span>
<span class="normal"><a href="#__codelineno-0-639"> 639</a></span>
<span class="normal"><a href="#__codelineno-0-640"> 640</a></span>
<span class="normal"><a href="#__codelineno-0-641"> 641</a></span>
<span class="normal"><a href="#__codelineno-0-642"> 642</a></span>
<span class="normal"><a href="#__codelineno-0-643"> 643</a></span>
<span class="normal"><a href="#__codelineno-0-644"> 644</a></span>
<span class="normal"><a href="#__codelineno-0-645"> 645</a></span>
<span class="normal"><a href="#__codelineno-0-646"> 646</a></span>
<span class="normal"><a href="#__codelineno-0-647"> 647</a></span>
<span class="normal"><a href="#__codelineno-0-648"> 648</a></span>
<span class="normal"><a href="#__codelineno-0-649"> 649</a></span>
<span class="normal"><a href="#__codelineno-0-650"> 650</a></span>
<span class="normal"><a href="#__codelineno-0-651"> 651</a></span>
<span class="normal"><a href="#__codelineno-0-652"> 652</a></span>
<span class="normal"><a href="#__codelineno-0-653"> 653</a></span>
<span class="normal"><a href="#__codelineno-0-654"> 654</a></span>
<span class="normal"><a href="#__codelineno-0-655"> 655</a></span>
<span class="normal"><a href="#__codelineno-0-656"> 656</a></span>
<span class="normal"><a href="#__codelineno-0-657"> 657</a></span>
<span class="normal"><a href="#__codelineno-0-658"> 658</a></span>
<span class="normal"><a href="#__codelineno-0-659"> 659</a></span>
<span class="normal"><a href="#__codelineno-0-660"> 660</a></span>
<span class="normal"><a href="#__codelineno-0-661"> 661</a></span>
<span class="normal"><a href="#__codelineno-0-662"> 662</a></span>
<span class="normal"><a href="#__codelineno-0-663"> 663</a></span>
<span class="normal"><a href="#__codelineno-0-664"> 664</a></span>
<span class="normal"><a href="#__codelineno-0-665"> 665</a></span>
<span class="normal"><a href="#__codelineno-0-666"> 666</a></span>
<span class="normal"><a href="#__codelineno-0-667"> 667</a></span>
<span class="normal"><a href="#__codelineno-0-668"> 668</a></span>
<span class="normal"><a href="#__codelineno-0-669"> 669</a></span>
<span class="normal"><a href="#__codelineno-0-670"> 670</a></span>
<span class="normal"><a href="#__codelineno-0-671"> 671</a></span>
<span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="k">class</span><span class="w"> </span><span class="nc">Multiphase</span><span class="p">(</span><span class="n">LBMBase</span><span class="p">):</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    Multiphase model, based on the Shan-Chen method. To model the fluid, an equation of state (EOS) is defined by the user.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    Sequence of computation is pressure (EOS, dependent on the density and temperature) --&gt; effective mass (phi).</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Can model both single component multiphase (SCMP) and multi-component multiphase (MCMP).</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    k (list): Modification coefficient, used to tune surface tension.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    A (numpy.ndarray): Weighting factor, used for linear combination of Shan-Chen and Zhang-Chen Forces</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    g_kk (numpy.ndarray): Inter component interaction strength. Its a matrix of size n_components x n_components. It must be symmetric.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    References</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    1. Shan, Xiaowen, and Hudong Chen. Lattice Boltzmann Model for Simulating Flows with Multiple Phases and Components.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        Physical Review E 47, no. 3 (March 1, 1993): 1815-19. https://doi.org/10.1103/PhysRevE.47.1815.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    2. Yuan, Peng, and Laura Schaefer. Equations of State in a Lattice Boltzmann Model.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        Physics of Fluids 18, no. 4 (April 3, 2006): 042101. https://doi.org/10.1063/1.2187070.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    -----</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    1. The boundary conditions for each component is handeled separately. For example a wall BC for two-component system must be</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    defined twice, once for each component (see examples for details).</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    2. Pytrees store component-specific values; order is as defined in initialize_macroscopic_fields by the user.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    2. Length of pytrees is equal to the no of components in the system.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    3. All component-specific values passed as a list or an array by the user must be set according to the sequence defined in the initialize_macroscopic_fields.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;n_components&quot;</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eos</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;EOS&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">g_kkprime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;g_kkprime&quot;</span><span class="p">)</span>  <span class="c1"># Fluid-fluid interaction strength</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="c1"># self.g_ks = kwargs.get(&quot;g_ks&quot;)  # Fluid-solid interaction strength</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">body_force</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;body_force&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">G_ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_ff_greens_function</span><span class="p">()</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="c1"># self.G_fs = self.compute_fs_greens_function()</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="c1"># self.omega = jnp.array(self.omega, dtype=self.precisionPolicy.compute_dtype)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">g_kkprime</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g_kkprime</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solid_mask_streamed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_solid_mask_streamed</span><span class="p">()</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">omega</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omega</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="nd">@omega</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">omega</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;omega must be a list&quot;</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_omega</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">n_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_components</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="nd">@n_components</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">n_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of components cannot be None&quot;</span><span class="p">)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of components must be positive&quot;</span><span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of components must be an integer&quot;</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_n_components</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">k</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="nd">@k</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Modification coefficient must be provided&quot;</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of modification coefficients provided does not match the number of components in the system&quot;</span><span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_k</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of modification coefficients provided does not match the number of components in the system&quot;</span><span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_k</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">A</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="nd">@A</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">A</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Weight coefficient value must be provided&quot;</span><span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The dimensions of A should match the number of components&quot;</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">body_force</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_body_force</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="nd">@body_force</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">body_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_body_force</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_body_force</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_body_force</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">g_kkprime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_kkprime</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="nd">@g_kkprime</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">g_kkprime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;g_kkprime must be a numpy array or jax.numpy.ndarray&quot;</span><span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;g_kkprime must be a matrix of size n_components x n_components&quot;</span><span class="p">)</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;g_kkprime must be a symmetric matrix&quot;</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_g_kkprime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="c1"># @property</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="c1"># def g_ks(self):</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="c1">#     return self._g_ks</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="c1">#</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="c1"># @g_ks.setter</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="c1"># def g_ks(self, value):</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="c1">#     if len(value) != self.n_components:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="c1">#         raise ValueError(&quot;g_ks must be a list size n_components&quot;)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="c1">#     if isinstance(value, np.ndarray):</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="c1">#         value = self.distributed_array_init(</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="c1">#             value.shape, self.precisionPolicy.compute_dtype, value</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="c1">#         )</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="c1">#     self._g_ks = value</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_solid_mask_streamed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        Define the solid mask used for fluid-solid interaction force. The boundary conditions must be passed separately.</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        None</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        -------</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        solid_mask array: (numpy.ndarray) Dimension: (nx, ny, 1) for d == 2 and (nx, ny, nz, 1) for d == 3</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="c1"># solid_indices = []</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="c1"># for i in range(self.n_components):</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="c1">#     for bc in self.BCs[i]:</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="c1">#         if (</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="c1">#             isinstance(bc, BounceBack)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="c1">#             or isinstance(bc, BounceBackHalfway)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="c1">#             or isinstance(bc, BounceBackMoving)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="c1">#         ):</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="c1">#             solid_indices.append(np.array(bc.indices).T)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="c1"># solid_index = None</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="c1"># if not len(solid_indices) == 0:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="c1">#     solid_index = np.vstack(solid_indices)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="c1"># if self.dim == 2:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="c1">#     shape = (self.nx, self.ny, 1)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="c1">#     solid_mask = jnp.zeros(shape, dtype=jnp.int8)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="c1">#     if solid_index is not None:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="c1">#         solid_mask = solid_mask.at[solid_index[:, 0], solid_index[:, 1], 0].set(</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="c1">#             1</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="c1">#         )</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="c1"># else:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="c1">#     shape = (self.nx, self.ny, self.nz, 1)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="c1">#     solid_mask = jnp.zeros(shape, dtype=jnp.int8)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="c1">#     if solid_index is not None:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="c1">#         solid_mask = solid_mask.at[</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="c1">#             solid_index[:, 0], solid_index[:, 1], solid_index[:, 2], 0</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="c1">#         ].set(1)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="c1"># return self.streaming(</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="c1">#     jnp.repeat(</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="c1">#         solid_mask,</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="c1">#         axis=-1,</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="c1">#         repeats=self.q,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="c1">#     )</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="c1"># )</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="n">solid_mask</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="n">solid_indices</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">)]</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">BCs</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">BounceBack</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">BounceBackHalfway</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">BounceBackMoving</span><span class="p">):</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>                    <span class="n">solid_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bc</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">solid_indices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>                <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">solid_indices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                    <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">))</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                <span class="n">solid_mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                    <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">index</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">))</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>                <span class="n">solid_mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="k">return</span> <span class="n">solid_mask</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_boundary_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">        Create boundary data for the Lattice Boltzmann simulation by setting boundary conditions,</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">        creating grid mask, and preparing local masks and normal arrays.</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">BCs</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">)]</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_boundary_conditions</span><span class="p">()</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="c1"># Accumulate the indices of all BCs to create the grid mask with FALSE along directions that</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="c1"># stream into a boundary voxel.</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Component: </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="n">solid_halo_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bc</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">BCs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">bc</span><span class="o">.</span><span class="n">isSolid</span><span class="p">]</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="n">solid_halo_voxels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">solid_halo_list</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">solid_halo_list</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="c1"># Create the grid mask on each process</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="n">grid_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_grid_mask</span><span class="p">(</span><span class="n">solid_halo_voxels</span><span class="p">)</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time to create the grid mask:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">BCs</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>                <span class="k">assert</span> <span class="n">bc</span><span class="o">.</span><span class="n">implementationStep</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PostStreaming&quot;</span><span class="p">,</span> <span class="s2">&quot;PostCollision&quot;</span><span class="p">]</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>                <span class="n">bc</span><span class="o">.</span><span class="n">create_local_mask_and_normal_arrays</span><span class="p">(</span><span class="n">grid_mask</span><span class="p">)</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time to create the local masks and normal arrays:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">equilibrium</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">,</span> <span class="n">cast_output</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">        Compute the equillibrium distribution function using the given density and velocity pytrees.</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">        rho_tree (pytree of jax.numpy.ndarray): Density field</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">        u_tree (pytree of jax.numpy.ndarray): Velocity field</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        cast_output (bool, optional): A flag to cast the density and velocity values to the compute and output precision. Default: True</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        -------</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        feq_tree (pytree of jax.numpy.ndarray): Equillibrium distribution</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="k">if</span> <span class="n">cast_output</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="n">cast</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_compute</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="n">rho_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">cast</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="n">u_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">cast</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="n">cu_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="n">usqr_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="n">feq_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">,</span> <span class="n">udote</span><span class="p">,</span> <span class="n">udotu</span><span class="p">:</span> <span class="n">rho</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">udote</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">udote</span><span class="p">)</span> <span class="o">-</span> <span class="n">udotu</span><span class="p">),</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">cu_tree</span><span class="p">,</span> <span class="n">usqr_tree</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="k">if</span> <span class="n">cast_output</span><span class="p">:</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f_eq</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_output</span><span class="p">(</span><span class="n">f_eq</span><span class="p">),</span> <span class="n">feq_tree</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="k">return</span> <span class="n">feq_tree</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_average_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">):</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="n">rho_s_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">)),</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="n">rho_ave_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="k">lambda</span> <span class="n">rho_s</span><span class="p">,</span> <span class="n">solid_mask</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_ff</span> <span class="o">*</span> <span class="n">rho_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">solid_mask</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_ff</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">solid_mask</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>            <span class="p">),</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="n">rho_s_tree</span><span class="p">,</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">solid_mask_streamed</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="p">)</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="k">return</span> <span class="n">rho_ave_tree</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_contact_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">):</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">        Apply the prescribed contact angle to density. The control parameters for this scheme are</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        self.theta_tree, self.phi_tree and self.delta_rho_tree. The max and min density fields are identified from initial configuration.</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">        By default, any wall boundary condition can accept optional wettability parameters. By default, these parameters are None.</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">        rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">        -------</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        (pytree of jax.numpy.ndarray) Density field with adjusted contact angle values at the boundary nodes.</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">        Reference:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">        ---------</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">        1. Li, Q., Yu, Y. &amp; Luo, K. H. &quot;Implementation of contact angles in pseudopotential lattice Boltzmann simulations with</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">        curved boundaries.&quot; Phys. Rev. E 100, 053313 (2019).</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="n">rho_ave_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_average_density</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">set_contact_angle</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">rho_ave</span><span class="p">,</span> <span class="n">BC</span><span class="p">):</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>            <span class="n">rho_min</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="n">rho_max</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>            <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="n">BC</span><span class="p">:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>                    <span class="n">bc</span><span class="p">,</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>                    <span class="p">(</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>                        <span class="n">BounceBackHalfway</span><span class="p">,</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>                        <span class="n">BounceBack</span><span class="p">,</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>                        <span class="n">BounceBackMoving</span><span class="p">,</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                        <span class="n">InterpolatedBounceBackBouzidi</span><span class="p">,</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>                        <span class="n">InterpolatedBounceBackDifferentiable</span><span class="p">,</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                    <span class="p">),</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                <span class="p">):</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                    <span class="k">if</span> <span class="n">bc</span><span class="o">.</span><span class="n">theta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                        <span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">bc</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                            <span class="p">(</span><span class="n">bc</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">bc</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rho_ave</span><span class="p">[</span><span class="n">bc</span><span class="o">.</span><span class="n">indices</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">bc</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho_ave</span><span class="p">[</span><span class="n">bc</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span> <span class="o">-</span> <span class="n">bc</span><span class="o">.</span><span class="n">delta_rho</span><span class="p">)</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                        <span class="p">)</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                    <span class="n">rho</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">rho_min</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">rho_max</span><span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="k">return</span> <span class="n">rho</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">,</span> <span class="n">rho_ave</span><span class="p">,</span> <span class="n">BC</span><span class="p">:</span> <span class="n">set_contact_angle</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">rho_ave</span><span class="p">,</span> <span class="n">BC</span><span class="p">),</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">rho_ave_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BCs</span><span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">):</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">        Apply collision step of LBM</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="k">pass</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_ff_greens_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">        Define the fluid-fluid interaction force Green&#39;s function used to compute interaction phase-phase interaction forces.</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">        The interaction coefficient between k^th and kprime^th component: self.gkkprime[k, kprime]</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">        During computation, this value is multiplied with corresponding g_kkprime value to get the Green&#39;s function:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">        G_kkprime = self.g_kk[k, k_prime] * self.G_ff</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">        G_kkprime(x, x&#39;) = g1 * g_kkprime,  if |x - x&#39;| = 1</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">                         = g2 * g_kkprime,  if |x - x&#39;| = sqrt(2)</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">                         = 0,               otherwise</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">        Here d is the dimension of problem and x&#39; are the neighboring points.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">        Some examples values could be:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">        For D2Q9:</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">            g1 = 1/3 and g2 = 1/12</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">        For D3Q19</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">            g1 = 1/6 and g2 = 1/12</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        None</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">        -------</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">        G_ff (jax.numpy.ndarray): Dimension: (q, )</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="n">G_ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="n">cl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD2Q9</span><span class="p">):</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>            <span class="n">g1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>            <span class="n">g2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>            <span class="n">G_ff</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g1</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>            <span class="n">G_ff</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">),</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g2</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q19</span><span class="p">):</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>            <span class="n">g1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">6</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>            <span class="n">g2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>            <span class="n">G_ff</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g1</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>            <span class="n">G_ff</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">),</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g2</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Please define Green&#39;s function for D3Q27 lattice by modifying compute_ff_greens_function.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">G_ff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="c1"># def compute_fs_greens_function(self):</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="c1">#     &quot;&quot;&quot;</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="c1">#     Define the Green&#39;s function used to model interaction between kth fluid and solid.</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="c1">#</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="c1">#     During computation, this G_fs is multiplied with corresponding g_ks value to get the Green&#39;s function:</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="c1">#     G_ks = self.g_ks[k] * self.G_fs</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="c1">#</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="c1">#     Green&#39;s function used in this case:</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="c1">#     G_ks(x, x&#39;) = g1 * g_ks,       if |x - x&#39;| = 1</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="c1">#                 = g2 * g_ks,       if |x - x&#39;| = sqrt(2)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="c1">#                 = 0,               otherwise</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>    <span class="c1">#</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>    <span class="c1">#     Here d is the dimension of problem and x&#39; are the neighboring points.</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>    <span class="c1">#     For D2Q9:</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>    <span class="c1">#         g1 = 2 and g2 = 1/2</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>    <span class="c1">#     For D3Q19</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="c1">#         g1 = 1 and g2 = 1/2</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>    <span class="c1">#</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>    <span class="c1">#     Parameters</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="c1">#     ----------</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>    <span class="c1">#     None</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>    <span class="c1">#</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>    <span class="c1">#     Returns</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>    <span class="c1">#     -------</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="c1">#     G_fs: jax.numpy.ndarray</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>    <span class="c1">#         Dimension: (q, )</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="c1">#     &quot;&quot;&quot;</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>    <span class="c1">#     c = np.array(self.lattice.c).T</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>    <span class="c1">#     cl = np.linalg.norm(c, axis=-1)</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>    <span class="c1">#     G_fs = np.zeros((self.q,), dtype=np.float64)</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="c1">#     if isinstance(self.lattice, LatticeD2Q9):</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>    <span class="c1">#         g1 = 1 / 3</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="c1">#         g2 = 1 / 12</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="c1">#         G_fs[np.isclose(cl, 1.0, atol=1e-6)] = g1</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>    <span class="c1">#         G_fs[np.isclose(cl, jnp.sqrt(2.0), atol=1e-6)] = g2</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>    <span class="c1">#     elif isinstance(self.lattice, LatticeD3Q19):</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="c1">#         g1 = 1 / 6</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>    <span class="c1">#         g2 = 1 / 12</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>    <span class="c1">#         G_fs[np.isclose(cl, 1.0, atol=1e-6)] = g1</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>    <span class="c1">#         G_fs[np.isclose(cl, jnp.sqrt(2.0), atol=1e-6)] = g2</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>    <span class="c1">#     return jnp.array(G_fs, dtype=self.precisionPolicy.compute_dtype)</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assign_fields_sharded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">        This function is used to initialize pytree of the distribution arrays using the initial velocities and velocity defined in self.initialize_macroscopic_fields function.</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">        To do this, function first uses the initialize_macroscopic_fields function to get the initial values of rho (rho0) and velocity (u0).</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">        If this function is not modified then, the distribution pytree is initialized with density value of 1.0 everywhere and velocity of 0.0 everywhere</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">        The distribution is initialized with rho0 and u0 values, using the self.equilibrium function.</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">        None</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">        -------</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">        f: pytree of distributed JAX array of shape: (self.nx, self.ny, self.q) for 2D and (self.nx, self.ny, self.nz, self.q) for 3D.</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="n">rho0_tree</span><span class="p">,</span> <span class="n">u0_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_macroscopic_fields</span><span class="p">()</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="n">f_tree</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="k">if</span> <span class="n">rho0_tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u0_tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rho0_tree</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">,</span> <span class="s2">&quot;The initial density values for all components must be provided&quot;</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">u0_tree</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">,</span> <span class="s2">&quot;The initial velocity values for all components must be provided.&quot;</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>                <span class="n">rho0</span><span class="p">,</span> <span class="n">u0</span> <span class="o">=</span> <span class="n">rho0_tree</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u0_tree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                <span class="n">rho0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_compute</span><span class="p">(</span><span class="n">rho0</span><span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                <span class="n">u0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_compute</span><span class="p">(</span><span class="n">u0</span><span class="p">)</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>                <span class="n">f_tree</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initialize_populations</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">u0</span><span class="p">))</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>                <span class="n">f_tree</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distributed_array_init</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">output_dtype</span><span class="p">,</span> <span class="n">init_val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">))</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>        <span class="k">return</span> <span class="n">f_tree</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_macroscopic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_tree</span><span class="p">):</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">        update_macroscopic from base.py extended to pytrees.</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">        f_tree (pytree of jax.numpy.ndarray): Distribution field.</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">        -------</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="sd">        rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">        u_tree (pytree of jax.numpy.ndarray): Velocity field.</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>        <span class="n">rho_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">f_tree</span><span class="p">)</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>        <span class="n">u_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="n">rho</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">rho</span><span class="p">,</span> <span class="n">f_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>  <span class="c1"># Component velocity</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="k">return</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">macroscopic_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">):</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">        macroscopic_velocity computes the velocity and incorporates forces into velocity for Exact Difference Method (EDM) (used for SRT and MRT collision) models</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">        and the consistent forcing scheme developed by LinLin Fei et. al (for Cascaded LBM). This is used for post-processing only and not for equilibrium distribution computation.</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">        f_tree (pytree of jax.numpy.ndarray): Distribution field.</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">        rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">        -------</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">        u_tree (pytree of jax.numpy.ndarray): Velocity field.</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>        <span class="c1"># rho_tree = map(lambda f: jnp.sum(f, axis=-1, keepdims=True), f_tree)</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="n">u_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="n">rho</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">rho</span><span class="p">,</span> <span class="n">f_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>        <span class="n">F_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_force</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">F</span><span class="p">:</span> <span class="n">u</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">F</span> <span class="o">/</span> <span class="n">rho</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">,</span> <span class="n">F_tree</span><span class="p">)</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_total_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">):</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">        Compute the total density using component velocity and density values.</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">        Parmeters</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">        ---------</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">        rho_tree (Pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">        -------</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">        (jax.numpy.ndarray): Total density field.</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>        <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_total_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">):</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">        Compute the total velocity using component velocity and density values.</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">        rho_tree (pytree of jax.numpy.ndarray): Density field</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">        u_tree (pytree of jax.numpy.ndarray): Velocity field</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">        -------</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">        (jax.numpy.ndarray): Total velocity field.</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">u</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">))</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>        <span class="k">return</span> <span class="n">n</span> <span class="o">/</span> <span class="n">d</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">psi_tree</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">        Generalized function for computing pressure. By default it uses equation</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">        of state but it can be modified if the pseudopotential is computed using</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">        a different method.</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">        rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">        psi_tree (pytree of jax.numpy.ndarray): Pseudopotential field.</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">        -------</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">        (pytree of jax.numpy.ndarray): Pressure field.</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos</span><span class="o">.</span><span class="n">EOS</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_total_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">        Compute the total combined pressure from all components.</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="sd">        p_tree (pytree of jax.numpy.ndarray): Pressure field.</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="sd">        rho_tree (pytree of jax.numpy.ndarray, default=None): Density field.</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="sd">        -------</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="sd">        (jax.numpy.ndarray): Total pressure field.</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>        <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">p_tree</span><span class="p">)</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_potential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">):</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">        Compute the potential (psi and U) which is required for computing interaction forces.</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a><span class="sd">        The psi values are obtained using the corresponding EOS. This function can be overloaded to handle cases where one or more component does not</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">        have EOS.</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="sd">        rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a><span class="sd">        -------</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a><span class="sd">        psi_tree (pytree of jax.numpy.ndarray): Pseudopotential field.</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="n">rho_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_compute</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>        <span class="n">p_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_pressure</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>        <span class="c1"># Shan-Chen potential using modified pressure</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>        <span class="n">psi_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>            <span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">G</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span> <span class="o">*</span> <span class="n">rho</span><span class="p">)</span> <span class="o">/</span> <span class="n">G</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">p_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_kkprime</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="p">)</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="c1"># Zhang-Chen potential</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>        <span class="n">U_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">rho</span><span class="p">:</span> <span class="n">k</span> <span class="o">*</span> <span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span> <span class="o">*</span> <span class="n">rho</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">p_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>        <span class="k">return</span> <span class="n">psi_tree</span><span class="p">,</span> <span class="n">U_tree</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>    <span class="c1"># Compute the force using the effective mass (psi) and the interaction potential (phi)</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">):</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">        Compute the force acting on each component(fluid). This includes fluid-fluid, fluid-solid, and body forces.</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">        rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">        -------</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">        fluid_fluid_force (pytree of jax.numpy.ndarray): Total force field.</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="n">rho_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_contact_angle</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>        <span class="n">psi_tree</span><span class="p">,</span> <span class="n">U_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_potential</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>        <span class="n">fluid_fluid_force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_fluid_fluid_force</span><span class="p">(</span><span class="n">psi_tree</span><span class="p">,</span> <span class="n">U_tree</span><span class="p">)</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>        <span class="c1"># fluid_solid_force = self.compute_fluid_solid_force(rho_tree)</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_force</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ff</span><span class="p">,</span> <span class="n">rho</span><span class="p">:</span> <span class="n">ff</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_force</span> <span class="o">*</span> <span class="n">rho</span><span class="p">,</span> <span class="n">fluid_fluid_force</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>            <span class="k">return</span> <span class="n">fluid_fluid_force</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_fluid_fluid_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psi_tree</span><span class="p">,</span> <span class="n">U_tree</span><span class="p">):</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">        Compute the fluid-fluid interaction force using the effective mass (psi).</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">        The force calculation is based on the Shan-Chen method using the weighted sum</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">        of Shan-Chen and Zhang-Chen potential where modified pressure is used:</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">        modified pressure = k * pressure;</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">        k is defined by user. Set k=1 for default pseudopotential formulation.</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">        psi_tree (pytree of jax.numpy.ndarray): Pseudo-potential field (Yuan-Schaefer, with modification)</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">        U_tree (pytree of jax.numpy.ndarray): Pseudo-potential field (Zhang-Chen, with modification)</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a><span class="sd">        -------</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="sd">        (pytree of jax.numpy.ndarray): Fluid-fluid interaction forces.</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="n">psi_s_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">psi</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)),</span> <span class="n">psi_tree</span><span class="p">)</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>        <span class="n">U_s_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">U</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)),</span> <span class="n">U_tree</span><span class="p">)</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">ffk_1</span><span class="p">(</span><span class="n">Ai</span><span class="p">,</span> <span class="n">g_kkprime</span><span class="p">):</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">            Shan-Chen interaction force</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">            g_kkprime is a row of self.gkkprime, as it represents the interaction between kth component with all components</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>            <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">A</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">G</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">G_ff</span> <span class="o">*</span> <span class="n">psi_s</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">Ai</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">g_kkprime</span><span class="p">),</span> <span class="n">psi_s_tree</span><span class="p">))</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">ffk_2</span><span class="p">(</span><span class="n">Ai</span><span class="p">):</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">            Zhang-Chen interaction force.</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>            <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">A</span><span class="p">,</span> <span class="n">U_s</span><span class="p">:</span> <span class="n">A</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_ff</span> <span class="o">*</span> <span class="n">U_s</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">Ai</span><span class="p">),</span> <span class="n">U_s_tree</span><span class="p">))</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>            <span class="k">lambda</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nt_1</span><span class="p">,</span> <span class="n">nt_2</span><span class="p">:</span> <span class="n">psi</span> <span class="o">*</span> <span class="n">nt_1</span> <span class="o">+</span> <span class="n">nt_2</span><span class="p">,</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>            <span class="n">psi_tree</span><span class="p">,</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>            <span class="nb">list</span><span class="p">(</span><span class="n">vmap</span><span class="p">(</span><span class="n">ffk_1</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_kkprime</span><span class="p">)),</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>            <span class="nb">list</span><span class="p">(</span><span class="n">vmap</span><span class="p">(</span><span class="n">ffk_2</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">))(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)),</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>        <span class="p">)</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>    <span class="c1"># @partial(jit, static_argnums=(0,))</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>    <span class="c1"># def compute_fluid_solid_force(self, rho_tree):</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>    <span class="c1">#     &quot;&quot;&quot;</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>    <span class="c1">#     Compute the fluid-fluid interaction force using the effective mass (psi).</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>    <span class="c1">#     Parameters</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>    <span class="c1">#     ----------</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>    <span class="c1">#     psi_tree: Pytree of jax.numpy.ndarray</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>    <span class="c1">#         Pytree of pseudopotential of all components.</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>    <span class="c1">#     Returns</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>    <span class="c1">#     -------</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>    <span class="c1">#     Pytree of jax.numpy.ndarray</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>    <span class="c1">#         Pytree of fluid-solid interaction force.</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>    <span class="c1">#     &quot;&quot;&quot;</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>    <span class="c1">#     return map(</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>    <span class="c1">#         lambda g_ks, rho, solid_mask: -g_ks</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>    <span class="c1">#         * rho</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>    <span class="c1">#         * jnp.dot(self.G_fs * solid_mask, self.c.T),</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>    <span class="c1">#         self.g_ks,</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>    <span class="c1">#         rho_tree,</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>    <span class="c1">#         self.solid_mask_streamed</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>    <span class="c1">#     )</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>    <span class="c1"># psi_tree, _ = self.compute_potential(rho_tree)</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>    <span class="c1"># psi_s_tree = map(lambda psi: self.streaming(jnp.repeat(psi, axis=-1, repeats=self.lattice.q)), psi_tree)</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>    <span class="c1"># return map(</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>    <span class="c1">#     lambda g_ks, psi, psi_s, solid_mask: -g_ks</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>    <span class="c1">#     * psi</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>    <span class="c1">#     * jnp.dot(self.G_fs * solid_mask * psi_s, self.c.T),</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>    <span class="c1">#     self.g_ks,</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>    <span class="c1">#     psi_tree,</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>    <span class="c1">#     psi_s_tree,</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>    <span class="c1">#     self.solid_mask_streamed</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>    <span class="c1"># )</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_postcollision_tree</span><span class="p">,</span> <span class="n">feq_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">):</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">        Modified version of the apply_force defined in LBMBase to account for modified force.</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a><span class="sd">        f_postcollision_tree (pytree of jax.numpy.ndarray): Post-collision distribution field.</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="sd">        feq_tree (pytree of jax.numpy.ndarray): Equilibrium distribution functions.</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="sd">        rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="sd">        u_tree (pytree of jax.numpy.ndarray): Velocity field.</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">        -------</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="sd">        f_postcollision_tree (pytree of jax.numpy.ndarray): The post-collision distribution field with the force applied.</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>        <span class="n">F_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_force</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>        <span class="n">u_temp_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">rho</span><span class="p">:</span> <span class="n">u</span> <span class="o">+</span> <span class="n">F</span> <span class="o">/</span> <span class="n">rho</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">,</span> <span class="n">F_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>        <span class="n">feq_force_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equilibrium</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_temp_tree</span><span class="p">)</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f_postcollision</span><span class="p">,</span> <span class="n">feq_force</span><span class="p">,</span> <span class="n">feq</span><span class="p">:</span> <span class="n">f_postcollision</span> <span class="o">+</span> <span class="n">feq_force</span> <span class="o">-</span> <span class="n">feq</span><span class="p">,</span> <span class="n">f_postcollision_tree</span><span class="p">,</span> <span class="n">feq_force_tree</span><span class="p">,</span> <span class="n">feq_tree</span><span class="p">)</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_bc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fout_tree</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">implementation_step</span><span class="p">):</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a><span class="sd">        This function extends apply_bc to pytrees.</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="sd">        fout_tree (pytree of jax.numpy.ndarray): The post-collision or post-streaming distribution functions where bc needs to be applied.</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">        fin_tree (pytree of jax.numpy.ndarray): The pre-collision or post-collision distribution functions.</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">        implementation_step (str): The implementation step at which the boundary conditions should be applied.</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">        -------</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">        (pytree of jax.numpy.ndarray): The output distribution functions after applying the boundary conditions.</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_apply_bc_</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">bc</span><span class="p">):</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>            <span class="n">fout</span> <span class="o">=</span> <span class="n">bc</span><span class="o">.</span><span class="n">prepare_populations</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="n">fin</span><span class="p">,</span> <span class="n">implementation_step</span><span class="p">)</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>            <span class="k">if</span> <span class="n">bc</span><span class="o">.</span><span class="n">implementationStep</span> <span class="o">==</span> <span class="n">implementation_step</span><span class="p">:</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>                <span class="k">if</span> <span class="n">bc</span><span class="o">.</span><span class="n">isDynamic</span><span class="p">:</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>                    <span class="n">fout</span> <span class="o">=</span> <span class="n">bc</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="n">fin</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>                    <span class="n">fout</span> <span class="o">=</span> <span class="n">fout</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">bc</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">bc</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="n">fin</span><span class="p">))</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>            <span class="k">return</span> <span class="n">fout</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>        <span class="c1"># for i in range(self.n_components):</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>        <span class="c1">#     for bc in self.BCs[i]:</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="c1">#         fout_tree[i] = _apply_bc_(fin_tree[i], fout_tree[i], bc)</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>        <span class="c1">#</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>        <span class="c1"># return fout_tree</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">__apply_bc__</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="n">fin</span><span class="p">,</span> <span class="n">BCs</span><span class="p">):</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>            <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="n">BCs</span><span class="p">:</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>                <span class="n">fout</span> <span class="o">=</span> <span class="n">_apply_bc_</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>            <span class="k">return</span> <span class="n">fout</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fout</span><span class="p">,</span> <span class="n">fin</span><span class="p">,</span> <span class="n">BCs</span><span class="p">:</span> <span class="n">__apply_bc__</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="n">fin</span><span class="p">,</span> <span class="n">BCs</span><span class="p">),</span> <span class="n">fout_tree</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BCs</span><span class="p">)</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_poststreaming_tree</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">return_fpost</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">        This function performs a single step of the LBM simulation.</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="sd">        It first performs the collision step, which is the relaxation of the distribution functions</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">        towards their equilibrium values. It then applies the respective boundary conditions to the</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a><span class="sd">        post-collision distribution functions.</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a><span class="sd">        The function then performs the streaming step, which is the propagation of the distribution</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a><span class="sd">        functions in the lattice. It then applies the respective boundary conditions to the post-streaming</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a><span class="sd">        distribution functions.</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a><span class="sd">        fin_tree (pytree of jax.numpy.ndarray): Post-streaming distribution function.</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a><span class="sd">        timestep (int): Current timestep</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="sd">        return_fpost (bool): Return post-collision distribution function (pytree).</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a><span class="sd">        -------</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a><span class="sd">        f_poststreaming_tree (pytree of jax.numpy.ndarray): Post-streamed distribution function.</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a><span class="sd">        f_collision_tree (pytree of jax.numpy.ndarray {Optional}): Post-collision distribution function.</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>        <span class="n">f_postcollision_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collision</span><span class="p">(</span><span class="n">f_poststreaming_tree</span><span class="p">)</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>        <span class="n">f_postcollision_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_bc</span><span class="p">(</span><span class="n">f_postcollision_tree</span><span class="p">,</span> <span class="n">f_poststreaming_tree</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="s2">&quot;PostCollision&quot;</span><span class="p">)</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>        <span class="n">f_poststreaming_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f_postcollision</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="p">(</span><span class="n">f_postcollision</span><span class="p">),</span> <span class="n">f_postcollision_tree</span><span class="p">)</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>        <span class="n">f_poststreaming_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_bc</span><span class="p">(</span><span class="n">f_poststreaming_tree</span><span class="p">,</span> <span class="n">f_postcollision_tree</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="s2">&quot;PostStreaming&quot;</span><span class="p">)</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>        <span class="k">if</span> <span class="n">return_fpost</span><span class="p">:</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>            <span class="k">return</span> <span class="n">f_poststreaming_tree</span><span class="p">,</span> <span class="n">f_postcollision_tree</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>            <span class="k">return</span> <span class="n">f_poststreaming_tree</span><span class="p">,</span> <span class="kc">None</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_max</span><span class="p">):</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a><span class="sd">        This function runs the LBM simulation for a specified number of time steps.</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a><span class="sd">        It first initializes the distribution functions and then enters a loop where it performs the</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="sd">        simulation steps (collision, streaming, and boundary conditions) for each time step.</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a><span class="sd">        The function can also print the progress of the simulation, save the simulation data, and</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">        compute the performance of the simulation in million lattice updates per second (MLUPS).</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a><span class="sd">        t_max (int): The total number of time steps to run the simulation.</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a><span class="sd">        -------</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">        f_tree (pytree of jax.numpy.ndarray): Distribution function after t_max timesteps.</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>        <span class="n">f_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign_fields_sharded</span><span class="p">()</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>        <span class="n">start_step</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_checkpoint</span><span class="p">:</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>            <span class="n">latest_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mngr</span><span class="o">.</span><span class="n">latest_step</span><span class="p">()</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>            <span class="k">if</span> <span class="n">latest_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># existing checkpoint present</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>                <span class="c1"># Assert that the checkpoint manager is not None</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">mngr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Checkpoint manager does not exist.&quot;</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>                <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>                <span class="n">c_name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;component_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>                    <span class="n">state</span><span class="p">[</span><span class="n">c_name</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">f_tree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>                <span class="c1"># shardings = jax.map(lambda x: x.sharding, f_tree)</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>                <span class="c1"># restore_args = orb.checkpoint_utils.construct_restore_args(</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>                <span class="c1">#     f_tree, shardings</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>                <span class="c1"># )</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>                    <span class="n">f_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mngr</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">latest_step</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">orb</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">StandardRestore</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Restored checkpoint at step </span><span class="si">{</span><span class="n">latest_step</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to restore checkpoint at step </span><span class="si">{</span><span class="n">latest_step</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>                <span class="n">start_step</span> <span class="o">=</span> <span class="n">latest_step</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">t_max</span> <span class="o">&gt;</span> <span class="n">start_step</span><span class="p">):</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulation already exceeded maximum allowable steps (t_max  = </span><span class="si">{</span><span class="n">t_max</span><span class="si">}</span><span class="s2">). Consider increasing t_max.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeMLUPS</span><span class="p">:</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>        <span class="c1"># Loop over all time steps</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>        <span class="k">for</span> <span class="n">timestep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_step</span><span class="p">,</span> <span class="n">t_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>            <span class="n">io_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioRate</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">timestep</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioRate</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">timestep</span> <span class="o">==</span> <span class="n">t_max</span><span class="p">)</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>            <span class="n">print_iter_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">printInfoRate</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">timestep</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">printInfoRate</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>            <span class="n">checkpoint_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpointRate</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">timestep</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpointRate</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>            <span class="k">if</span> <span class="n">io_flag</span><span class="p">:</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>                <span class="c1"># Update the macroscopic variables and save the previous values (for error computation)</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>                <span class="n">rho_prev_tree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_macroscopic</span><span class="p">(</span><span class="n">f_tree</span><span class="p">)</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>                <span class="n">u_prev_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macroscopic_velocity</span><span class="p">(</span><span class="n">f_tree</span><span class="p">,</span> <span class="n">rho_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>                <span class="n">rho_prev_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>                    <span class="k">lambda</span> <span class="n">rho_prev</span><span class="p">:</span> <span class="n">downsample_field</span><span class="p">(</span><span class="n">rho_prev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsamplingFactor</span><span class="p">),</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>                    <span class="n">rho_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>                <span class="p">)</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>                <span class="n">psi_prev_tree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_potential</span><span class="p">(</span><span class="n">rho_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>                <span class="n">p_prev_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_pressure</span><span class="p">(</span><span class="n">rho_prev_tree</span><span class="p">,</span> <span class="n">psi_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>                <span class="n">p_prev_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_total_pressure</span><span class="p">(</span><span class="n">p_prev_tree</span><span class="p">,</span> <span class="n">rho_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>                <span class="n">p_prev_total</span> <span class="o">=</span> <span class="n">downsample_field</span><span class="p">(</span><span class="n">p_prev_total</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsamplingFactor</span><span class="p">)</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>                <span class="n">u_prev_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>                    <span class="k">lambda</span> <span class="n">u_prev</span><span class="p">:</span> <span class="n">downsample_field</span><span class="p">(</span><span class="n">u_prev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsamplingFactor</span><span class="p">),</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>                    <span class="n">u_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>                <span class="p">)</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>                <span class="n">rho_total_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_total_density</span><span class="p">(</span><span class="n">rho_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>                <span class="n">u_total_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_total_velocity</span><span class="p">(</span><span class="n">rho_prev_tree</span><span class="p">,</span> <span class="n">u_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>                <span class="c1"># Gather the data from all processes and convert it to numpy arrays (move to host memory)</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>                <span class="n">p_prev_total</span> <span class="o">=</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">p_prev_total</span><span class="p">)</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>                <span class="n">rho_prev_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho_prev</span><span class="p">:</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">rho_prev</span><span class="p">),</span> <span class="n">rho_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>                <span class="n">u_prev_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u_prev</span><span class="p">:</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">u_prev</span><span class="p">),</span> <span class="n">u_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>                <span class="n">rho_total_prev</span> <span class="o">=</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">rho_total_prev</span><span class="p">)</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>                <span class="n">u_total_prev</span> <span class="o">=</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">u_total_prev</span><span class="p">)</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>            <span class="c1"># Perform one time-step (collision, streaming, and boundary conditions)</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>            <span class="n">f_tree</span><span class="p">,</span> <span class="n">fstar_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">f_tree</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>            <span class="c1"># Print the progress of the simulation</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>            <span class="k">if</span> <span class="n">print_iter_flag</span><span class="p">:</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>                    <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;Timestep &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>                    <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>                    <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot; of &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>                    <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t_max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>                    <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot; completed&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>                <span class="p">)</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>            <span class="k">if</span> <span class="n">io_flag</span><span class="p">:</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>                <span class="c1"># Save the simulation data</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving data at timestep </span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">t_max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>                <span class="n">rho_tree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_macroscopic</span><span class="p">(</span><span class="n">f_tree</span><span class="p">)</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>                <span class="n">u_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macroscopic_velocity</span><span class="p">(</span><span class="n">f_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>                <span class="n">psi_tree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_potential</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>                <span class="n">p_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_pressure</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">psi_tree</span><span class="p">)</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>                <span class="n">p_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_total_pressure</span><span class="p">(</span><span class="n">p_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>                <span class="n">p_total</span> <span class="o">=</span> <span class="n">downsample_field</span><span class="p">(</span><span class="n">p_total</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsamplingFactor</span><span class="p">)</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>                <span class="n">rho_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>                    <span class="k">lambda</span> <span class="n">rho</span><span class="p">:</span> <span class="n">downsample_field</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsamplingFactor</span><span class="p">),</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>                    <span class="n">rho_tree</span><span class="p">,</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>                <span class="p">)</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>                <span class="n">u_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">downsample_field</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsamplingFactor</span><span class="p">),</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>                <span class="n">rho_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_total_density</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>                <span class="n">u_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_total_velocity</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>                <span class="c1"># Gather the data from all processes and convert it to numpy arrays (move to host memory)</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>                <span class="n">p_total</span> <span class="o">=</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">p_total</span><span class="p">)</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>                <span class="n">rho_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">:</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>                <span class="n">u_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>                <span class="n">rho_total</span> <span class="o">=</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">rho_total</span><span class="p">)</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>                <span class="n">u_total</span> <span class="o">=</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">u_total</span><span class="p">)</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>                <span class="c1"># Save the data</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">handle_io_timestep</span><span class="p">(</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>                    <span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>                    <span class="n">f_tree</span><span class="p">,</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>                    <span class="n">fstar_tree</span><span class="p">,</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>                    <span class="n">p_tree</span><span class="p">,</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>                    <span class="n">p_total</span><span class="p">,</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>                    <span class="n">u_tree</span><span class="p">,</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>                    <span class="n">u_total</span><span class="p">,</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>                    <span class="n">rho_total</span><span class="p">,</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>                    <span class="n">rho_tree</span><span class="p">,</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>                    <span class="n">p_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>                    <span class="n">p_prev_total</span><span class="p">,</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>                    <span class="n">u_total_prev</span><span class="p">,</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>                    <span class="n">u_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>                    <span class="n">rho_total_prev</span><span class="p">,</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>                    <span class="n">rho_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>                <span class="p">)</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>            <span class="k">if</span> <span class="n">checkpoint_flag</span><span class="p">:</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>                <span class="c1"># Save the checkpoint</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving checkpoint at timestep </span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">t_max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>                <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>                <span class="n">c_name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;component_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>                    <span class="n">state</span><span class="p">[</span><span class="n">c_name</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">f_tree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mngr</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">timestep</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">orb</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">StandardSave</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>            <span class="c1"># Start the timer for the MLUPS computation after the first timestep (to remove compilation overhead)</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeMLUPS</span> <span class="ow">and</span> <span class="n">timestep</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>                <span class="n">jax</span><span class="o">.</span><span class="n">block_until_ready</span><span class="p">(</span><span class="n">f_tree</span><span class="p">)</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>                <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeMLUPS</span><span class="p">:</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>            <span class="c1"># Compute and print the performance of the simulation in MLUPS</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>            <span class="n">jax</span><span class="o">.</span><span class="n">block_until_ready</span><span class="p">(</span><span class="n">f_tree</span><span class="p">)</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>            <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>                    <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;Domain: &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>                    <span class="k">else</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>                <span class="p">)</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                    <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;Number of voxels: &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>                    <span class="k">else</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>                <span class="p">)</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>                    <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;MLUPS: &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>                    <span class="o">+</span> <span class="n">colored</span><span class="p">(</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t_max</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e6</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>                        <span class="s2">&quot;red&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>                <span class="p">)</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">colored</span><span class="p">(</span><span class="s2">&quot;Domain: &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">colored</span><span class="p">(</span><span class="s2">&quot;Number of voxels: &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>                    <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;MLUPS: &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>                    <span class="o">+</span> <span class="n">colored</span><span class="p">(</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t_max</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e6</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>                        <span class="s2">&quot;red&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>                <span class="p">)</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mngr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mngr</span><span class="o">.</span><span class="n">wait_until_finished</span><span class="p">()</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>        <span class="k">return</span> <span class="n">f_tree</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">handle_io_timestep</span><span class="p">(</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>        <span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>        <span class="n">f_tree</span><span class="p">,</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>        <span class="n">fstar_tree</span><span class="p">,</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>        <span class="n">p_tree</span><span class="p">,</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>        <span class="n">p_total</span><span class="p">,</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>        <span class="n">u_tree</span><span class="p">,</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>        <span class="n">u_total</span><span class="p">,</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>        <span class="n">rho_total</span><span class="p">,</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>        <span class="n">rho_tree</span><span class="p">,</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>        <span class="n">p_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>        <span class="n">p_prev_total</span><span class="p">,</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>        <span class="n">u_total_prev</span><span class="p">,</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>        <span class="n">u_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>        <span class="n">rho_total_prev</span><span class="p">,</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>        <span class="n">rho_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>    <span class="p">):</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a><span class="sd">        This function handles the input/output (I/O) operations at each time step of the simulation.</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><span class="sd">        It prepares the data to be saved and calls the output_data function, which can be overwritten</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="sd">        by the user to customize the I/O operations.</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">        timestep (int): The current time step of the simulation.</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="sd">        f_tree (pytree of jax.numpy.ndarray): Post-streaming distribution functions at the current time step.</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">        fstar_tree (pytree of jax.numpy.ndarray): Post-collision distribution functions at the current time step.</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">        p_tree (pytree of jax.numpy.ndarray): Pressure field at the current time step.</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">        p (jax.numpy.ndarray): Total pressure field at the current time step.</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a><span class="sd">        u_total (jax.numpy.ndarray): Total velocity field at the current time step.</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a><span class="sd">        u_tree (pytree of jax.numpy.ndarray): Velocity field at the current time step.</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a><span class="sd">        rho_total (jax.numpy.ndarray): Total density field at the current time step.</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a><span class="sd">        rho_tree (pytree of jax.numpy.ndarray): Density field at the current time step.</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a><span class="sd">        p_prev_tree (pytree of jax.numpy.ndarray): Pressure field at the previous time step.</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a><span class="sd">        p_prev (jax.numpy.ndarray): Total pressure field at the previous time step.</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a><span class="sd">        u_total_prev (jax.numpy.ndarray): Total velocity field at the previous time step.</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="sd">        u_prev_tree (pytree of jax.numpy.ndarray): Velocity field at the previous time step.</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><span class="sd">        rho_total_prev (jax.numpy.ndarray): Total density field at the previous time step.</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a><span class="sd">        rho_prev_tree: (ytree of jax.numpy.ndarray): Density field at the previous time step.</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="sd">        None</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>            <span class="s2">&quot;n_components&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">,</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>            <span class="s2">&quot;timestep&quot;</span><span class="p">:</span> <span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>            <span class="s2">&quot;rho_total&quot;</span><span class="p">:</span> <span class="n">rho_total</span><span class="p">,</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>            <span class="s2">&quot;rho_tree&quot;</span><span class="p">:</span> <span class="n">rho_tree</span><span class="p">,</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>            <span class="s2">&quot;p_tree&quot;</span><span class="p">:</span> <span class="n">p_tree</span><span class="p">,</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>            <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="n">p_total</span><span class="p">,</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>            <span class="s2">&quot;u_total&quot;</span><span class="p">:</span> <span class="n">u_total</span><span class="p">,</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>            <span class="s2">&quot;u_tree&quot;</span><span class="p">:</span> <span class="n">u_tree</span><span class="p">,</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>            <span class="s2">&quot;rho_total_prev&quot;</span><span class="p">:</span> <span class="n">rho_total_prev</span><span class="p">,</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>            <span class="s2">&quot;rho_prev_tree&quot;</span><span class="p">:</span> <span class="n">rho_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>            <span class="s2">&quot;p_prev_tree&quot;</span><span class="p">:</span> <span class="n">p_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>            <span class="s2">&quot;p_prev&quot;</span><span class="p">:</span> <span class="n">p_prev_total</span><span class="p">,</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>            <span class="s2">&quot;u_total_prev&quot;</span><span class="p">:</span> <span class="n">u_total_prev</span><span class="p">,</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>            <span class="s2">&quot;u_prev_tree&quot;</span><span class="p">:</span> <span class="n">u_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>            <span class="s2">&quot;f_poststreaming_tree&quot;</span><span class="p">:</span> <span class="n">f_tree</span><span class="p">,</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>            <span class="s2">&quot;f_postcollision_tree&quot;</span><span class="p">:</span> <span class="n">fstar_tree</span><span class="p">,</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>        <span class="p">}</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.apply_bc" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">apply_bc</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">apply_bc</span><span class="p">(</span><span class="n">fout_tree</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">implementation_step</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This function extends apply_bc to pytrees.</p>
<h4 id="src.multiphase.Multiphase.apply_bc--parameters">Parameters</h4>
<p>fout_tree (pytree of jax.numpy.ndarray): The post-collision or post-streaming distribution functions where bc needs to be applied.</p>
<p>fin_tree (pytree of jax.numpy.ndarray): The pre-collision or post-collision distribution functions.</p>
<p>implementation_step (str): The implementation step at which the boundary conditions should be applied.</p>
<h4 id="src.multiphase.Multiphase.apply_bc--returns">Returns</h4>
<p>(pytree of jax.numpy.ndarray): The output distribution functions after applying the boundary conditions.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-763" name="__codelineno-0-763"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_bc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fout_tree</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">implementation_step</span><span class="p">):</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a><span class="sd">    This function extends apply_bc to pytrees.</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="sd">    fout_tree (pytree of jax.numpy.ndarray): The post-collision or post-streaming distribution functions where bc needs to be applied.</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">    fin_tree (pytree of jax.numpy.ndarray): The pre-collision or post-collision distribution functions.</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">    implementation_step (str): The implementation step at which the boundary conditions should be applied.</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">    -------</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">    (pytree of jax.numpy.ndarray): The output distribution functions after applying the boundary conditions.</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_bc_</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">bc</span><span class="p">):</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>        <span class="n">fout</span> <span class="o">=</span> <span class="n">bc</span><span class="o">.</span><span class="n">prepare_populations</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="n">fin</span><span class="p">,</span> <span class="n">implementation_step</span><span class="p">)</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>        <span class="k">if</span> <span class="n">bc</span><span class="o">.</span><span class="n">implementationStep</span> <span class="o">==</span> <span class="n">implementation_step</span><span class="p">:</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>            <span class="k">if</span> <span class="n">bc</span><span class="o">.</span><span class="n">isDynamic</span><span class="p">:</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>                <span class="n">fout</span> <span class="o">=</span> <span class="n">bc</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="n">fin</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>                <span class="n">fout</span> <span class="o">=</span> <span class="n">fout</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">bc</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">bc</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="n">fin</span><span class="p">))</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>        <span class="k">return</span> <span class="n">fout</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>    <span class="c1"># for i in range(self.n_components):</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>    <span class="c1">#     for bc in self.BCs[i]:</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>    <span class="c1">#         fout_tree[i] = _apply_bc_(fin_tree[i], fout_tree[i], bc)</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>    <span class="c1">#</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>    <span class="c1"># return fout_tree</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__apply_bc__</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="n">fin</span><span class="p">,</span> <span class="n">BCs</span><span class="p">):</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="n">BCs</span><span class="p">:</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>            <span class="n">fout</span> <span class="o">=</span> <span class="n">_apply_bc_</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>        <span class="k">return</span> <span class="n">fout</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fout</span><span class="p">,</span> <span class="n">fin</span><span class="p">,</span> <span class="n">BCs</span><span class="p">:</span> <span class="n">__apply_bc__</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="n">fin</span><span class="p">,</span> <span class="n">BCs</span><span class="p">),</span> <span class="n">fout_tree</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BCs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.apply_contact_angle" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">apply_contact_angle</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">apply_contact_angle</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Apply the prescribed contact angle to density. The control parameters for this scheme are
self.theta_tree, self.phi_tree and self.delta_rho_tree. The max and min density fields are identified from initial configuration.
By default, any wall boundary condition can accept optional wettability parameters. By default, these parameters are None.</p>
<h4 id="src.multiphase.Multiphase.apply_contact_angle--parameters">Parameters</h4>
<p>rho_tree (pytree of jax.numpy.ndarray): Density field.</p>
<h4 id="src.multiphase.Multiphase.apply_contact_angle--returns">Returns</h4>
<p>(pytree of jax.numpy.ndarray) Density field with adjusted contact angle values at the boundary nodes.</p>
<h4 id="src.multiphase.Multiphase.apply_contact_angle--reference">Reference:</h4>
<ol>
<li>Li, Q., Yu, Y. &amp; Luo, K. H. &ldquo;Implementation of contact angles in pseudopotential lattice Boltzmann simulations with
curved boundaries.&rdquo; Phys. Rev. E 100, 053313 (2019).</li>
</ol>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_contact_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">):</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">    Apply the prescribed contact angle to density. The control parameters for this scheme are</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">    self.theta_tree, self.phi_tree and self.delta_rho_tree. The max and min density fields are identified from initial configuration.</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">    By default, any wall boundary condition can accept optional wettability parameters. By default, these parameters are None.</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">    rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">    -------</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">    (pytree of jax.numpy.ndarray) Density field with adjusted contact angle values at the boundary nodes.</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">    Reference:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">    1. Li, Q., Yu, Y. &amp; Luo, K. H. &quot;Implementation of contact angles in pseudopotential lattice Boltzmann simulations with</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">    curved boundaries.&quot; Phys. Rev. E 100, 053313 (2019).</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="n">rho_ave_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_average_density</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_contact_angle</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">rho_ave</span><span class="p">,</span> <span class="n">BC</span><span class="p">):</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="n">rho_min</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="n">rho_max</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="n">BC</span><span class="p">:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>                <span class="n">bc</span><span class="p">,</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>                <span class="p">(</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>                    <span class="n">BounceBackHalfway</span><span class="p">,</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>                    <span class="n">BounceBack</span><span class="p">,</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>                    <span class="n">BounceBackMoving</span><span class="p">,</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                    <span class="n">InterpolatedBounceBackBouzidi</span><span class="p">,</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>                    <span class="n">InterpolatedBounceBackDifferentiable</span><span class="p">,</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                <span class="p">),</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="p">):</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                <span class="k">if</span> <span class="n">bc</span><span class="o">.</span><span class="n">theta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                    <span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">bc</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                        <span class="p">(</span><span class="n">bc</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">bc</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rho_ave</span><span class="p">[</span><span class="n">bc</span><span class="o">.</span><span class="n">indices</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">bc</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho_ave</span><span class="p">[</span><span class="n">bc</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span> <span class="o">-</span> <span class="n">bc</span><span class="o">.</span><span class="n">delta_rho</span><span class="p">)</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                    <span class="p">)</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                <span class="n">rho</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">rho_min</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">rho_max</span><span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="k">return</span> <span class="n">rho</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">,</span> <span class="n">rho_ave</span><span class="p">,</span> <span class="n">BC</span><span class="p">:</span> <span class="n">set_contact_angle</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">rho_ave</span><span class="p">,</span> <span class="n">BC</span><span class="p">),</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">rho_ave_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BCs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.apply_force" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">apply_force</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">apply_force</span><span class="p">(</span><span class="n">f_postcollision_tree</span><span class="p">,</span> <span class="n">feq_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Modified version of the apply_force defined in LBMBase to account for modified force.</p>
<h4 id="src.multiphase.Multiphase.apply_force--parameters">Parameters</h4>
<p>f_postcollision_tree (pytree of jax.numpy.ndarray): Post-collision distribution field.</p>
<p>feq_tree (pytree of jax.numpy.ndarray): Equilibrium distribution functions.</p>
<p>rho_tree (pytree of jax.numpy.ndarray): Density field.</p>
<p>u_tree (pytree of jax.numpy.ndarray): Velocity field.</p>
<h4 id="src.multiphase.Multiphase.apply_force--returns">Returns</h4>
<p>f_postcollision_tree (pytree of jax.numpy.ndarray): The post-collision distribution field with the force applied.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-738" name="__codelineno-0-738"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_postcollision_tree</span><span class="p">,</span> <span class="n">feq_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">):</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">    Modified version of the apply_force defined in LBMBase to account for modified force.</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a><span class="sd">    f_postcollision_tree (pytree of jax.numpy.ndarray): Post-collision distribution field.</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="sd">    feq_tree (pytree of jax.numpy.ndarray): Equilibrium distribution functions.</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="sd">    rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="sd">    u_tree (pytree of jax.numpy.ndarray): Velocity field.</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">    -------</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="sd">    f_postcollision_tree (pytree of jax.numpy.ndarray): The post-collision distribution field with the force applied.</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>    <span class="n">F_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_force</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>    <span class="n">u_temp_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">rho</span><span class="p">:</span> <span class="n">u</span> <span class="o">+</span> <span class="n">F</span> <span class="o">/</span> <span class="n">rho</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">,</span> <span class="n">F_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>    <span class="n">feq_force_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equilibrium</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_temp_tree</span><span class="p">)</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f_postcollision</span><span class="p">,</span> <span class="n">feq_force</span><span class="p">,</span> <span class="n">feq</span><span class="p">:</span> <span class="n">f_postcollision</span> <span class="o">+</span> <span class="n">feq_force</span> <span class="o">-</span> <span class="n">feq</span><span class="p">,</span> <span class="n">f_postcollision_tree</span><span class="p">,</span> <span class="n">feq_force_tree</span><span class="p">,</span> <span class="n">feq_tree</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.assign_fields_sharded" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">assign_fields_sharded</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">assign_fields_sharded</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This function is used to initialize pytree of the distribution arrays using the initial velocities and velocity defined in self.initialize_macroscopic_fields function.
To do this, function first uses the initialize_macroscopic_fields function to get the initial values of rho (rho0) and velocity (u0).</p>
<p>If this function is not modified then, the distribution pytree is initialized with density value of 1.0 everywhere and velocity of 0.0 everywhere</p>
<p>The distribution is initialized with rho0 and u0 values, using the self.equilibrium function.</p>
<h4 id="src.multiphase.Multiphase.assign_fields_sharded--parameters">Parameters</h4>
<p>None</p>
<h4 id="src.multiphase.Multiphase.assign_fields_sharded--returns">Returns</h4>
<p>f: pytree of distributed JAX array of shape: (self.nx, self.ny, self.q) for 2D and (self.nx, self.ny, self.nz, self.q) for 3D.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="k">def</span><span class="w"> </span><span class="nf">assign_fields_sharded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">    This function is used to initialize pytree of the distribution arrays using the initial velocities and velocity defined in self.initialize_macroscopic_fields function.</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">    To do this, function first uses the initialize_macroscopic_fields function to get the initial values of rho (rho0) and velocity (u0).</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">    If this function is not modified then, the distribution pytree is initialized with density value of 1.0 everywhere and velocity of 0.0 everywhere</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">    The distribution is initialized with rho0 and u0 values, using the self.equilibrium function.</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">    None</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">    -------</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">    f: pytree of distributed JAX array of shape: (self.nx, self.ny, self.q) for 2D and (self.nx, self.ny, self.nz, self.q) for 3D.</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="n">rho0_tree</span><span class="p">,</span> <span class="n">u0_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_macroscopic_fields</span><span class="p">()</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="n">f_tree</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="k">if</span> <span class="n">rho0_tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u0_tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rho0_tree</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">,</span> <span class="s2">&quot;The initial density values for all components must be provided&quot;</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">u0_tree</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">,</span> <span class="s2">&quot;The initial velocity values for all components must be provided.&quot;</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>            <span class="n">rho0</span><span class="p">,</span> <span class="n">u0</span> <span class="o">=</span> <span class="n">rho0_tree</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u0_tree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>            <span class="n">rho0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_compute</span><span class="p">(</span><span class="n">rho0</span><span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>            <span class="n">u0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_compute</span><span class="p">(</span><span class="n">u0</span><span class="p">)</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>            <span class="n">f_tree</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initialize_populations</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">u0</span><span class="p">))</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>            <span class="n">f_tree</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distributed_array_init</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">output_dtype</span><span class="p">,</span> <span class="n">init_val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">))</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="k">return</span> <span class="n">f_tree</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.collision" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">collision</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">collision</span><span class="p">(</span><span class="n">fin_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Apply collision step of LBM</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="k">def</span><span class="w"> </span><span class="nf">collision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">):</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">    Apply collision step of LBM</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.compute_ff_greens_function" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">compute_ff_greens_function</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">compute_ff_greens_function</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Define the fluid-fluid interaction force Green&rsquo;s function used to compute interaction phase-phase interaction forces.</p>
<p>The interaction coefficient between k^th and kprime^th component: self.gkkprime[k, kprime]
During computation, this value is multiplied with corresponding g_kkprime value to get the Green&rsquo;s function:
G_kkprime = self.g_kk[k, k_prime] * self.G_ff</p>
<p>G_kkprime(x, x&rsquo;) = g1 * g_kkprime,  if |x - x&rsquo;| = 1
                 = g2 * g_kkprime,  if |x - x&rsquo;| = sqrt(2)
                 = 0,               otherwise</p>
<p>Here d is the dimension of problem and x&rsquo; are the neighboring points.</p>
<p>Some examples values could be:
For D2Q9:
    g1 = 1/3 and g2 = 1/12
For D3Q19
    g1 = 1/6 and g2 = 1/12</p>
<h4 id="src.multiphase.Multiphase.compute_ff_greens_function--parameters">Parameters</h4>
<p>None</p>
<h4 id="src.multiphase.Multiphase.compute_ff_greens_function--returns">Returns</h4>
<p>G_ff (jax.numpy.ndarray): Dimension: (q, )</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_ff_greens_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">    Define the fluid-fluid interaction force Green&#39;s function used to compute interaction phase-phase interaction forces.</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">    The interaction coefficient between k^th and kprime^th component: self.gkkprime[k, kprime]</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">    During computation, this value is multiplied with corresponding g_kkprime value to get the Green&#39;s function:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">    G_kkprime = self.g_kk[k, k_prime] * self.G_ff</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">    G_kkprime(x, x&#39;) = g1 * g_kkprime,  if |x - x&#39;| = 1</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">                     = g2 * g_kkprime,  if |x - x&#39;| = sqrt(2)</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">                     = 0,               otherwise</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">    Here d is the dimension of problem and x&#39; are the neighboring points.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">    Some examples values could be:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">    For D2Q9:</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">        g1 = 1/3 and g2 = 1/12</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">    For D3Q19</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        g1 = 1/6 and g2 = 1/12</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">    None</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">    -------</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">    G_ff (jax.numpy.ndarray): Dimension: (q, )</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="n">G_ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>    <span class="n">cl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD2Q9</span><span class="p">):</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="n">g1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="n">g2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>        <span class="n">G_ff</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g1</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="n">G_ff</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">),</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g2</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q19</span><span class="p">):</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="n">g1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">6</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="n">g2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="n">G_ff</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g1</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="n">G_ff</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">),</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g2</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Please define Green&#39;s function for D3Q27 lattice by modifying compute_ff_greens_function.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">G_ff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.compute_fluid_fluid_force" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">compute_fluid_fluid_force</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">compute_fluid_fluid_force</span><span class="p">(</span><span class="n">psi_tree</span><span class="p">,</span> <span class="n">U_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute the fluid-fluid interaction force using the effective mass (psi).
The force calculation is based on the Shan-Chen method using the weighted sum
of Shan-Chen and Zhang-Chen potential where modified pressure is used:</p>
<p>modified pressure = k * pressure;
k is defined by user. Set k=1 for default pseudopotential formulation.</p>
<h4 id="src.multiphase.Multiphase.compute_fluid_fluid_force--parameters">Parameters</h4>
<p>psi_tree (pytree of jax.numpy.ndarray): Pseudo-potential field (Yuan-Schaefer, with modification)</p>
<p>U_tree (pytree of jax.numpy.ndarray): Pseudo-potential field (Zhang-Chen, with modification)</p>
<h4 id="src.multiphase.Multiphase.compute_fluid_fluid_force--returns">Returns</h4>
<p>(pytree of jax.numpy.ndarray): Fluid-fluid interaction forces.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_fluid_fluid_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psi_tree</span><span class="p">,</span> <span class="n">U_tree</span><span class="p">):</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">    Compute the fluid-fluid interaction force using the effective mass (psi).</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">    The force calculation is based on the Shan-Chen method using the weighted sum</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">    of Shan-Chen and Zhang-Chen potential where modified pressure is used:</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">    modified pressure = k * pressure;</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">    k is defined by user. Set k=1 for default pseudopotential formulation.</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">    psi_tree (pytree of jax.numpy.ndarray): Pseudo-potential field (Yuan-Schaefer, with modification)</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">    U_tree (pytree of jax.numpy.ndarray): Pseudo-potential field (Zhang-Chen, with modification)</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a><span class="sd">    -------</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="sd">    (pytree of jax.numpy.ndarray): Fluid-fluid interaction forces.</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>    <span class="n">psi_s_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">psi</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)),</span> <span class="n">psi_tree</span><span class="p">)</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>    <span class="n">U_s_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">U</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)),</span> <span class="n">U_tree</span><span class="p">)</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ffk_1</span><span class="p">(</span><span class="n">Ai</span><span class="p">,</span> <span class="n">g_kkprime</span><span class="p">):</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">        Shan-Chen interaction force</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">        g_kkprime is a row of self.gkkprime, as it represents the interaction between kth component with all components</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>        <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">A</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">G</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">G_ff</span> <span class="o">*</span> <span class="n">psi_s</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">Ai</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">g_kkprime</span><span class="p">),</span> <span class="n">psi_s_tree</span><span class="p">))</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ffk_2</span><span class="p">(</span><span class="n">Ai</span><span class="p">):</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">        Zhang-Chen interaction force.</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">A</span><span class="p">,</span> <span class="n">U_s</span><span class="p">:</span> <span class="n">A</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_ff</span> <span class="o">*</span> <span class="n">U_s</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">Ai</span><span class="p">),</span> <span class="n">U_s_tree</span><span class="p">))</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>        <span class="k">lambda</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nt_1</span><span class="p">,</span> <span class="n">nt_2</span><span class="p">:</span> <span class="n">psi</span> <span class="o">*</span> <span class="n">nt_1</span> <span class="o">+</span> <span class="n">nt_2</span><span class="p">,</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>        <span class="n">psi_tree</span><span class="p">,</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>        <span class="nb">list</span><span class="p">(</span><span class="n">vmap</span><span class="p">(</span><span class="n">ffk_1</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_kkprime</span><span class="p">)),</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>        <span class="nb">list</span><span class="p">(</span><span class="n">vmap</span><span class="p">(</span><span class="n">ffk_2</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">))(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)),</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.compute_force" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">compute_force</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">compute_force</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute the force acting on each component(fluid). This includes fluid-fluid, fluid-solid, and body forces.</p>
<h4 id="src.multiphase.Multiphase.compute_force--parameters">Parameters</h4>
<p>rho_tree (pytree of jax.numpy.ndarray): Density field.</p>
<h4 id="src.multiphase.Multiphase.compute_force--returns">Returns</h4>
<p>fluid_fluid_force (pytree of jax.numpy.ndarray): Total force field.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">):</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">    Compute the force acting on each component(fluid). This includes fluid-fluid, fluid-solid, and body forces.</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">    rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">    -------</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">    fluid_fluid_force (pytree of jax.numpy.ndarray): Total force field.</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>    <span class="n">rho_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_contact_angle</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>    <span class="n">psi_tree</span><span class="p">,</span> <span class="n">U_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_potential</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>    <span class="n">fluid_fluid_force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_fluid_fluid_force</span><span class="p">(</span><span class="n">psi_tree</span><span class="p">,</span> <span class="n">U_tree</span><span class="p">)</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>    <span class="c1"># fluid_solid_force = self.compute_fluid_solid_force(rho_tree)</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_force</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ff</span><span class="p">,</span> <span class="n">rho</span><span class="p">:</span> <span class="n">ff</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_force</span> <span class="o">*</span> <span class="n">rho</span><span class="p">,</span> <span class="n">fluid_fluid_force</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>        <span class="k">return</span> <span class="n">fluid_fluid_force</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.compute_potential" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">compute_potential</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">compute_potential</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute the potential (psi and U) which is required for computing interaction forces.
The psi values are obtained using the corresponding EOS. This function can be overloaded to handle cases where one or more component does not
have EOS.</p>
<h4 id="src.multiphase.Multiphase.compute_potential--parameters">Parameters</h4>
<p>rho_tree (pytree of jax.numpy.ndarray): Density field.</p>
<h4 id="src.multiphase.Multiphase.compute_potential--returns">Returns</h4>
<p>psi_tree (pytree of jax.numpy.ndarray): Pseudopotential field.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_potential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">):</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">    Compute the potential (psi and U) which is required for computing interaction forces.</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a><span class="sd">    The psi values are obtained using the corresponding EOS. This function can be overloaded to handle cases where one or more component does not</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">    have EOS.</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="sd">    rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a><span class="sd">    -------</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a><span class="sd">    psi_tree (pytree of jax.numpy.ndarray): Pseudopotential field.</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>    <span class="n">rho_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_compute</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>    <span class="n">p_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_pressure</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="c1"># Shan-Chen potential using modified pressure</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>    <span class="n">psi_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">G</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span> <span class="o">*</span> <span class="n">rho</span><span class="p">)</span> <span class="o">/</span> <span class="n">G</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">p_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_kkprime</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>    <span class="p">)</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>    <span class="c1"># Zhang-Chen potential</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>    <span class="n">U_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">rho</span><span class="p">:</span> <span class="n">k</span> <span class="o">*</span> <span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span> <span class="o">*</span> <span class="n">rho</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">p_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>    <span class="k">return</span> <span class="n">psi_tree</span><span class="p">,</span> <span class="n">U_tree</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.compute_pressure" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">compute_pressure</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">compute_pressure</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">psi_tree</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generalized function for computing pressure. By default it uses equation
of state but it can be modified if the pseudopotential is computed using
a different method.</p>
<h4 id="src.multiphase.Multiphase.compute_pressure--parameters">Parameters</h4>
<p>rho_tree (pytree of jax.numpy.ndarray): Density field.</p>
<p>psi_tree (pytree of jax.numpy.ndarray): Pseudopotential field.</p>
<h4 id="src.multiphase.Multiphase.compute_pressure--returns">Returns</h4>
<p>(pytree of jax.numpy.ndarray): Pressure field.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">psi_tree</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">    Generalized function for computing pressure. By default it uses equation</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">    of state but it can be modified if the pseudopotential is computed using</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">    a different method.</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">    rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">    psi_tree (pytree of jax.numpy.ndarray): Pseudopotential field.</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">    -------</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">    (pytree of jax.numpy.ndarray): Pressure field.</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos</span><span class="o">.</span><span class="n">EOS</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.compute_total_density" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">compute_total_density</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">compute_total_density</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute the total density using component velocity and density values.</p>
<h4 id="src.multiphase.Multiphase.compute_total_density--parmeters">Parmeters</h4>
<p>rho_tree (Pytree of jax.numpy.ndarray): Density field.</p>
<h4 id="src.multiphase.Multiphase.compute_total_density--returns">Returns</h4>
<p>(jax.numpy.ndarray): Total density field.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_total_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">):</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">    Compute the total density using component velocity and density values.</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">    Parmeters</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">    rho_tree (Pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">    -------</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">    (jax.numpy.ndarray): Total density field.</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>    <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.compute_total_pressure" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">compute_total_pressure</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">compute_total_pressure</span><span class="p">(</span><span class="n">p_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute the total combined pressure from all components.</p>
<h4 id="src.multiphase.Multiphase.compute_total_pressure--parameters">Parameters</h4>
<p>p_tree (pytree of jax.numpy.ndarray): Pressure field.</p>
<p>rho_tree (pytree of jax.numpy.ndarray, default=None): Density field.</p>
<h4 id="src.multiphase.Multiphase.compute_total_pressure--returns">Returns</h4>
<p>(jax.numpy.ndarray): Total pressure field.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_total_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">    Compute the total combined pressure from all components.</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="sd">    p_tree (pytree of jax.numpy.ndarray): Pressure field.</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="sd">    rho_tree (pytree of jax.numpy.ndarray, default=None): Density field.</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="sd">    -------</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="sd">    (jax.numpy.ndarray): Total pressure field.</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>    <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">p_tree</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.compute_total_velocity" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">compute_total_velocity</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">compute_total_velocity</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute the total velocity using component velocity and density values.</p>
<h4 id="src.multiphase.Multiphase.compute_total_velocity--parameters">Parameters</h4>
<p>rho_tree (pytree of jax.numpy.ndarray): Density field</p>
<p>u_tree (pytree of jax.numpy.ndarray): Velocity field</p>
<h4 id="src.multiphase.Multiphase.compute_total_velocity--returns">Returns</h4>
<p>(jax.numpy.ndarray): Total velocity field.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_total_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">):</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">    Compute the total velocity using component velocity and density values.</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">    rho_tree (pytree of jax.numpy.ndarray): Density field</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">    u_tree (pytree of jax.numpy.ndarray): Velocity field</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">    -------</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">    (jax.numpy.ndarray): Total velocity field.</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">u</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">))</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>    <span class="k">return</span> <span class="n">n</span> <span class="o">/</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.equilibrium" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">equilibrium</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">equilibrium</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">,</span> <span class="n">cast_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute the equillibrium distribution function using the given density and velocity pytrees.</p>
<h4 id="src.multiphase.Multiphase.equilibrium--parameters">Parameters</h4>
<p>rho_tree (pytree of jax.numpy.ndarray): Density field</p>
<p>u_tree (pytree of jax.numpy.ndarray): Velocity field</p>
<p>cast_output (bool, optional): A flag to cast the density and velocity values to the compute and output precision. Default: True</p>
<h4 id="src.multiphase.Multiphase.equilibrium--returns">Returns</h4>
<p>feq_tree (pytree of jax.numpy.ndarray): Equillibrium distribution</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="k">def</span><span class="w"> </span><span class="nf">equilibrium</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">,</span> <span class="n">cast_output</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">    Compute the equillibrium distribution function using the given density and velocity pytrees.</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">    rho_tree (pytree of jax.numpy.ndarray): Density field</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">    u_tree (pytree of jax.numpy.ndarray): Velocity field</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    cast_output (bool, optional): A flag to cast the density and velocity values to the compute and output precision. Default: True</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">    -------</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">    feq_tree (pytree of jax.numpy.ndarray): Equillibrium distribution</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="k">if</span> <span class="n">cast_output</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="n">cast</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_compute</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="n">rho_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">cast</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="n">u_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">cast</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>    <span class="n">cu_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="n">usqr_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="n">feq_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">,</span> <span class="n">udote</span><span class="p">,</span> <span class="n">udotu</span><span class="p">:</span> <span class="n">rho</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">udote</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">udote</span><span class="p">)</span> <span class="o">-</span> <span class="n">udotu</span><span class="p">),</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">cu_tree</span><span class="p">,</span> <span class="n">usqr_tree</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>    <span class="k">if</span> <span class="n">cast_output</span><span class="p">:</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f_eq</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_output</span><span class="p">(</span><span class="n">f_eq</span><span class="p">),</span> <span class="n">feq_tree</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="k">return</span> <span class="n">feq_tree</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.get_solid_mask_streamed" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_solid_mask_streamed</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_solid_mask_streamed</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Define the solid mask used for fluid-solid interaction force. The boundary conditions must be passed separately.</p>
<h4 id="src.multiphase.Multiphase.get_solid_mask_streamed--parameters">Parameters</h4>
<p>None</p>
<h4 id="src.multiphase.Multiphase.get_solid_mask_streamed--returns">Returns</h4>
<p>solid_mask array: (numpy.ndarray) Dimension: (nx, ny, 1) for d == 2 and (nx, ny, nz, 1) for d == 3</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_solid_mask_streamed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    Define the solid mask used for fluid-solid interaction force. The boundary conditions must be passed separately.</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">    None</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    -------</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    solid_mask array: (numpy.ndarray) Dimension: (nx, ny, 1) for d == 2 and (nx, ny, nz, 1) for d == 3</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="c1"># solid_indices = []</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="c1"># for i in range(self.n_components):</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="c1">#     for bc in self.BCs[i]:</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="c1">#         if (</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="c1">#             isinstance(bc, BounceBack)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="c1">#             or isinstance(bc, BounceBackHalfway)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="c1">#             or isinstance(bc, BounceBackMoving)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="c1">#         ):</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="c1">#             solid_indices.append(np.array(bc.indices).T)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="c1"># solid_index = None</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="c1"># if not len(solid_indices) == 0:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="c1">#     solid_index = np.vstack(solid_indices)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="c1"># if self.dim == 2:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="c1">#     shape = (self.nx, self.ny, 1)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="c1">#     solid_mask = jnp.zeros(shape, dtype=jnp.int8)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="c1">#     if solid_index is not None:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="c1">#         solid_mask = solid_mask.at[solid_index[:, 0], solid_index[:, 1], 0].set(</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="c1">#             1</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="c1">#         )</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="c1"># else:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="c1">#     shape = (self.nx, self.ny, self.nz, 1)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="c1">#     solid_mask = jnp.zeros(shape, dtype=jnp.int8)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="c1">#     if solid_index is not None:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="c1">#         solid_mask = solid_mask.at[</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="c1">#             solid_index[:, 0], solid_index[:, 1], solid_index[:, 2], 0</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="c1">#         ].set(1)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="c1"># return self.streaming(</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="c1">#     jnp.repeat(</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="c1">#         solid_mask,</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="c1">#         axis=-1,</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="c1">#         repeats=self.q,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="c1">#     )</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="c1"># )</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="n">solid_mask</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="n">solid_indices</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">)]</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">BCs</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">BounceBack</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">BounceBackHalfway</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">BounceBackMoving</span><span class="p">):</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>                <span class="n">solid_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bc</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">solid_indices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">solid_indices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">))</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="n">solid_mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">index</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">))</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="n">solid_mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="k">return</span> <span class="n">solid_mask</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.handle_io_timestep" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">handle_io_timestep</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">handle_io_timestep</span><span class="p">(</span><span class="n">timestep</span><span class="p">,</span> <span class="n">f_tree</span><span class="p">,</span> <span class="n">fstar_tree</span><span class="p">,</span> <span class="n">p_tree</span><span class="p">,</span> <span class="n">p_total</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">,</span> <span class="n">u_total</span><span class="p">,</span> <span class="n">rho_total</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">p_prev_tree</span><span class="p">,</span> <span class="n">p_prev_total</span><span class="p">,</span> <span class="n">u_total_prev</span><span class="p">,</span> <span class="n">u_prev_tree</span><span class="p">,</span> <span class="n">rho_total_prev</span><span class="p">,</span> <span class="n">rho_prev_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This function handles the input/output (I/O) operations at each time step of the simulation.</p>
<p>It prepares the data to be saved and calls the output_data function, which can be overwritten
by the user to customize the I/O operations.</p>
<h4 id="src.multiphase.Multiphase.handle_io_timestep--parameters">Parameters</h4>
<p>timestep (int): The current time step of the simulation.</p>
<p>f_tree (pytree of jax.numpy.ndarray): Post-streaming distribution functions at the current time step.</p>
<p>fstar_tree (pytree of jax.numpy.ndarray): Post-collision distribution functions at the current time step.</p>
<p>p_tree (pytree of jax.numpy.ndarray): Pressure field at the current time step.</p>
<p>p (jax.numpy.ndarray): Total pressure field at the current time step.</p>
<p>u_total (jax.numpy.ndarray): Total velocity field at the current time step.</p>
<p>u_tree (pytree of jax.numpy.ndarray): Velocity field at the current time step.</p>
<p>rho_total (jax.numpy.ndarray): Total density field at the current time step.</p>
<p>rho_tree (pytree of jax.numpy.ndarray): Density field at the current time step.</p>
<p>p_prev_tree (pytree of jax.numpy.ndarray): Pressure field at the previous time step.</p>
<p>p_prev (jax.numpy.ndarray): Total pressure field at the previous time step.</p>
<p>u_total_prev (jax.numpy.ndarray): Total velocity field at the previous time step.</p>
<p>u_prev_tree (pytree of jax.numpy.ndarray): Velocity field at the previous time step.</p>
<p>rho_total_prev (jax.numpy.ndarray): Total density field at the previous time step.</p>
<p>rho_prev_tree: (ytree of jax.numpy.ndarray): Density field at the previous time step.</p>
<h4 id="src.multiphase.Multiphase.handle_io_timestep--returns">Returns</h4>
<p>None</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1027" name="__codelineno-0-1027"></a><span class="k">def</span><span class="w"> </span><span class="nf">handle_io_timestep</span><span class="p">(</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>    <span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>    <span class="n">f_tree</span><span class="p">,</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>    <span class="n">fstar_tree</span><span class="p">,</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>    <span class="n">p_tree</span><span class="p">,</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>    <span class="n">p_total</span><span class="p">,</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>    <span class="n">u_tree</span><span class="p">,</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>    <span class="n">u_total</span><span class="p">,</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>    <span class="n">rho_total</span><span class="p">,</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>    <span class="n">rho_tree</span><span class="p">,</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>    <span class="n">p_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>    <span class="n">p_prev_total</span><span class="p">,</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>    <span class="n">u_total_prev</span><span class="p">,</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>    <span class="n">u_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>    <span class="n">rho_total_prev</span><span class="p">,</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>    <span class="n">rho_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><span class="p">):</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a><span class="sd">    This function handles the input/output (I/O) operations at each time step of the simulation.</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><span class="sd">    It prepares the data to be saved and calls the output_data function, which can be overwritten</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="sd">    by the user to customize the I/O operations.</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">    timestep (int): The current time step of the simulation.</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="sd">    f_tree (pytree of jax.numpy.ndarray): Post-streaming distribution functions at the current time step.</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">    fstar_tree (pytree of jax.numpy.ndarray): Post-collision distribution functions at the current time step.</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">    p_tree (pytree of jax.numpy.ndarray): Pressure field at the current time step.</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">    p (jax.numpy.ndarray): Total pressure field at the current time step.</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a><span class="sd">    u_total (jax.numpy.ndarray): Total velocity field at the current time step.</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a><span class="sd">    u_tree (pytree of jax.numpy.ndarray): Velocity field at the current time step.</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a><span class="sd">    rho_total (jax.numpy.ndarray): Total density field at the current time step.</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a><span class="sd">    rho_tree (pytree of jax.numpy.ndarray): Density field at the current time step.</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a><span class="sd">    p_prev_tree (pytree of jax.numpy.ndarray): Pressure field at the previous time step.</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a><span class="sd">    p_prev (jax.numpy.ndarray): Total pressure field at the previous time step.</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a><span class="sd">    u_total_prev (jax.numpy.ndarray): Total velocity field at the previous time step.</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="sd">    u_prev_tree (pytree of jax.numpy.ndarray): Velocity field at the previous time step.</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><span class="sd">    rho_total_prev (jax.numpy.ndarray): Total density field at the previous time step.</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a><span class="sd">    rho_prev_tree: (ytree of jax.numpy.ndarray): Density field at the previous time step.</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="sd">    None</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>        <span class="s2">&quot;n_components&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">,</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>        <span class="s2">&quot;timestep&quot;</span><span class="p">:</span> <span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>        <span class="s2">&quot;rho_total&quot;</span><span class="p">:</span> <span class="n">rho_total</span><span class="p">,</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>        <span class="s2">&quot;rho_tree&quot;</span><span class="p">:</span> <span class="n">rho_tree</span><span class="p">,</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>        <span class="s2">&quot;p_tree&quot;</span><span class="p">:</span> <span class="n">p_tree</span><span class="p">,</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>        <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="n">p_total</span><span class="p">,</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>        <span class="s2">&quot;u_total&quot;</span><span class="p">:</span> <span class="n">u_total</span><span class="p">,</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>        <span class="s2">&quot;u_tree&quot;</span><span class="p">:</span> <span class="n">u_tree</span><span class="p">,</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>        <span class="s2">&quot;rho_total_prev&quot;</span><span class="p">:</span> <span class="n">rho_total_prev</span><span class="p">,</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>        <span class="s2">&quot;rho_prev_tree&quot;</span><span class="p">:</span> <span class="n">rho_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>        <span class="s2">&quot;p_prev_tree&quot;</span><span class="p">:</span> <span class="n">p_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>        <span class="s2">&quot;p_prev&quot;</span><span class="p">:</span> <span class="n">p_prev_total</span><span class="p">,</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>        <span class="s2">&quot;u_total_prev&quot;</span><span class="p">:</span> <span class="n">u_total_prev</span><span class="p">,</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>        <span class="s2">&quot;u_prev_tree&quot;</span><span class="p">:</span> <span class="n">u_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>        <span class="s2">&quot;f_poststreaming_tree&quot;</span><span class="p">:</span> <span class="n">f_tree</span><span class="p">,</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>        <span class="s2">&quot;f_postcollision_tree&quot;</span><span class="p">:</span> <span class="n">fstar_tree</span><span class="p">,</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>    <span class="p">}</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">output_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.macroscopic_velocity" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">macroscopic_velocity</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">macroscopic_velocity</span><span class="p">(</span><span class="n">f_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>macroscopic_velocity computes the velocity and incorporates forces into velocity for Exact Difference Method (EDM) (used for SRT and MRT collision) models
and the consistent forcing scheme developed by LinLin Fei et. al (for Cascaded LBM). This is used for post-processing only and not for equilibrium distribution computation.</p>
<h4 id="src.multiphase.Multiphase.macroscopic_velocity--parameters">Parameters</h4>
<p>f_tree (pytree of jax.numpy.ndarray): Distribution field.</p>
<p>rho_tree (pytree of jax.numpy.ndarray): Density field.</p>
<h4 id="src.multiphase.Multiphase.macroscopic_velocity--returns">Returns</h4>
<p>u_tree (pytree of jax.numpy.ndarray): Velocity field.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="k">def</span><span class="w"> </span><span class="nf">macroscopic_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">):</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">    macroscopic_velocity computes the velocity and incorporates forces into velocity for Exact Difference Method (EDM) (used for SRT and MRT collision) models</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">    and the consistent forcing scheme developed by LinLin Fei et. al (for Cascaded LBM). This is used for post-processing only and not for equilibrium distribution computation.</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">    f_tree (pytree of jax.numpy.ndarray): Distribution field.</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">    rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">    -------</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">    u_tree (pytree of jax.numpy.ndarray): Velocity field.</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="c1"># rho_tree = map(lambda f: jnp.sum(f, axis=-1, keepdims=True), f_tree)</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>    <span class="n">u_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="n">rho</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">rho</span><span class="p">,</span> <span class="n">f_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>    <span class="n">F_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_force</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">F</span><span class="p">:</span> <span class="n">u</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">F</span> <span class="o">/</span> <span class="n">rho</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">,</span> <span class="n">F_tree</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.run" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run</span><span class="p">(</span><span class="n">t_max</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This function runs the LBM simulation for a specified number of time steps.</p>
<p>It first initializes the distribution functions and then enters a loop where it performs the
simulation steps (collision, streaming, and boundary conditions) for each time step.</p>
<p>The function can also print the progress of the simulation, save the simulation data, and
compute the performance of the simulation in million lattice updates per second (MLUPS).</p>
<h4 id="src.multiphase.Multiphase.run--parameters">Parameters</h4>
<p>t_max (int): The total number of time steps to run the simulation.</p>
<h4 id="src.multiphase.Multiphase.run--returns">Returns</h4>
<p>f_tree (pytree of jax.numpy.ndarray): Distribution function after t_max timesteps.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-840" name="__codelineno-0-840"></a><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_max</span><span class="p">):</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a><span class="sd">    This function runs the LBM simulation for a specified number of time steps.</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a><span class="sd">    It first initializes the distribution functions and then enters a loop where it performs the</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="sd">    simulation steps (collision, streaming, and boundary conditions) for each time step.</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a><span class="sd">    The function can also print the progress of the simulation, save the simulation data, and</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">    compute the performance of the simulation in million lattice updates per second (MLUPS).</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a><span class="sd">    t_max (int): The total number of time steps to run the simulation.</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a><span class="sd">    -------</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">    f_tree (pytree of jax.numpy.ndarray): Distribution function after t_max timesteps.</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>    <span class="n">f_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign_fields_sharded</span><span class="p">()</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>    <span class="n">start_step</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_checkpoint</span><span class="p">:</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>        <span class="n">latest_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mngr</span><span class="o">.</span><span class="n">latest_step</span><span class="p">()</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>        <span class="k">if</span> <span class="n">latest_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># existing checkpoint present</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>            <span class="c1"># Assert that the checkpoint manager is not None</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">mngr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Checkpoint manager does not exist.&quot;</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>            <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>            <span class="n">c_name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;component_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>                <span class="n">state</span><span class="p">[</span><span class="n">c_name</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">f_tree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>            <span class="c1"># shardings = jax.map(lambda x: x.sharding, f_tree)</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>            <span class="c1"># restore_args = orb.checkpoint_utils.construct_restore_args(</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>            <span class="c1">#     f_tree, shardings</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>            <span class="c1"># )</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>                <span class="n">f_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mngr</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">latest_step</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">orb</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">StandardRestore</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Restored checkpoint at step </span><span class="si">{</span><span class="n">latest_step</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to restore checkpoint at step </span><span class="si">{</span><span class="n">latest_step</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>            <span class="n">start_step</span> <span class="o">=</span> <span class="n">latest_step</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">t_max</span> <span class="o">&gt;</span> <span class="n">start_step</span><span class="p">):</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulation already exceeded maximum allowable steps (t_max  = </span><span class="si">{</span><span class="n">t_max</span><span class="si">}</span><span class="s2">). Consider increasing t_max.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeMLUPS</span><span class="p">:</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>    <span class="c1"># Loop over all time steps</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>    <span class="k">for</span> <span class="n">timestep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_step</span><span class="p">,</span> <span class="n">t_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>        <span class="n">io_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioRate</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">timestep</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioRate</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">timestep</span> <span class="o">==</span> <span class="n">t_max</span><span class="p">)</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>        <span class="n">print_iter_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">printInfoRate</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">timestep</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">printInfoRate</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>        <span class="n">checkpoint_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpointRate</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">timestep</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpointRate</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>        <span class="k">if</span> <span class="n">io_flag</span><span class="p">:</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>            <span class="c1"># Update the macroscopic variables and save the previous values (for error computation)</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>            <span class="n">rho_prev_tree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_macroscopic</span><span class="p">(</span><span class="n">f_tree</span><span class="p">)</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>            <span class="n">u_prev_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macroscopic_velocity</span><span class="p">(</span><span class="n">f_tree</span><span class="p">,</span> <span class="n">rho_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>            <span class="n">rho_prev_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>                <span class="k">lambda</span> <span class="n">rho_prev</span><span class="p">:</span> <span class="n">downsample_field</span><span class="p">(</span><span class="n">rho_prev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsamplingFactor</span><span class="p">),</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>                <span class="n">rho_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>            <span class="p">)</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>            <span class="n">psi_prev_tree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_potential</span><span class="p">(</span><span class="n">rho_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>            <span class="n">p_prev_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_pressure</span><span class="p">(</span><span class="n">rho_prev_tree</span><span class="p">,</span> <span class="n">psi_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>            <span class="n">p_prev_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_total_pressure</span><span class="p">(</span><span class="n">p_prev_tree</span><span class="p">,</span> <span class="n">rho_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>            <span class="n">p_prev_total</span> <span class="o">=</span> <span class="n">downsample_field</span><span class="p">(</span><span class="n">p_prev_total</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsamplingFactor</span><span class="p">)</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>            <span class="n">u_prev_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>                <span class="k">lambda</span> <span class="n">u_prev</span><span class="p">:</span> <span class="n">downsample_field</span><span class="p">(</span><span class="n">u_prev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsamplingFactor</span><span class="p">),</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>                <span class="n">u_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>            <span class="p">)</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>            <span class="n">rho_total_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_total_density</span><span class="p">(</span><span class="n">rho_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>            <span class="n">u_total_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_total_velocity</span><span class="p">(</span><span class="n">rho_prev_tree</span><span class="p">,</span> <span class="n">u_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>            <span class="c1"># Gather the data from all processes and convert it to numpy arrays (move to host memory)</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>            <span class="n">p_prev_total</span> <span class="o">=</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">p_prev_total</span><span class="p">)</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>            <span class="n">rho_prev_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho_prev</span><span class="p">:</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">rho_prev</span><span class="p">),</span> <span class="n">rho_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>            <span class="n">u_prev_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u_prev</span><span class="p">:</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">u_prev</span><span class="p">),</span> <span class="n">u_prev_tree</span><span class="p">)</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>            <span class="n">rho_total_prev</span> <span class="o">=</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">rho_total_prev</span><span class="p">)</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>            <span class="n">u_total_prev</span> <span class="o">=</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">u_total_prev</span><span class="p">)</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>        <span class="c1"># Perform one time-step (collision, streaming, and boundary conditions)</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>        <span class="n">f_tree</span><span class="p">,</span> <span class="n">fstar_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">f_tree</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>        <span class="c1"># Print the progress of the simulation</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>        <span class="k">if</span> <span class="n">print_iter_flag</span><span class="p">:</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>                <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;Timestep &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>                <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>                <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot; of &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>                <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t_max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>                <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot; completed&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>            <span class="p">)</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>        <span class="k">if</span> <span class="n">io_flag</span><span class="p">:</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>            <span class="c1"># Save the simulation data</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving data at timestep </span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">t_max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>            <span class="n">rho_tree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_macroscopic</span><span class="p">(</span><span class="n">f_tree</span><span class="p">)</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>            <span class="n">u_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macroscopic_velocity</span><span class="p">(</span><span class="n">f_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>            <span class="n">psi_tree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_potential</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>            <span class="n">p_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_pressure</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">psi_tree</span><span class="p">)</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>            <span class="n">p_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_total_pressure</span><span class="p">(</span><span class="n">p_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>            <span class="n">p_total</span> <span class="o">=</span> <span class="n">downsample_field</span><span class="p">(</span><span class="n">p_total</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsamplingFactor</span><span class="p">)</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>            <span class="n">rho_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>                <span class="k">lambda</span> <span class="n">rho</span><span class="p">:</span> <span class="n">downsample_field</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsamplingFactor</span><span class="p">),</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>                <span class="n">rho_tree</span><span class="p">,</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>            <span class="p">)</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>            <span class="n">u_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">downsample_field</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsamplingFactor</span><span class="p">),</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>            <span class="n">rho_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_total_density</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>            <span class="n">u_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_total_velocity</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>            <span class="c1"># Gather the data from all processes and convert it to numpy arrays (move to host memory)</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>            <span class="n">p_total</span> <span class="o">=</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">p_total</span><span class="p">)</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>            <span class="n">rho_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">:</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>            <span class="n">u_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>            <span class="n">rho_total</span> <span class="o">=</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">rho_total</span><span class="p">)</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>            <span class="n">u_total</span> <span class="o">=</span> <span class="n">process_allgather</span><span class="p">(</span><span class="n">u_total</span><span class="p">)</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>            <span class="c1"># Save the data</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">handle_io_timestep</span><span class="p">(</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>                <span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>                <span class="n">f_tree</span><span class="p">,</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>                <span class="n">fstar_tree</span><span class="p">,</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>                <span class="n">p_tree</span><span class="p">,</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>                <span class="n">p_total</span><span class="p">,</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>                <span class="n">u_tree</span><span class="p">,</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>                <span class="n">u_total</span><span class="p">,</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>                <span class="n">rho_total</span><span class="p">,</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>                <span class="n">rho_tree</span><span class="p">,</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>                <span class="n">p_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>                <span class="n">p_prev_total</span><span class="p">,</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>                <span class="n">u_total_prev</span><span class="p">,</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>                <span class="n">u_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>                <span class="n">rho_total_prev</span><span class="p">,</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>                <span class="n">rho_prev_tree</span><span class="p">,</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>            <span class="p">)</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>        <span class="k">if</span> <span class="n">checkpoint_flag</span><span class="p">:</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>            <span class="c1"># Save the checkpoint</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving checkpoint at timestep </span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">t_max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>            <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>            <span class="n">c_name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;component_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>                <span class="n">state</span><span class="p">[</span><span class="n">c_name</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">f_tree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mngr</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">timestep</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">orb</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">StandardSave</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>        <span class="c1"># Start the timer for the MLUPS computation after the first timestep (to remove compilation overhead)</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeMLUPS</span> <span class="ow">and</span> <span class="n">timestep</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>            <span class="n">jax</span><span class="o">.</span><span class="n">block_until_ready</span><span class="p">(</span><span class="n">f_tree</span><span class="p">)</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeMLUPS</span><span class="p">:</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>        <span class="c1"># Compute and print the performance of the simulation in MLUPS</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>        <span class="n">jax</span><span class="o">.</span><span class="n">block_until_ready</span><span class="p">(</span><span class="n">f_tree</span><span class="p">)</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>                <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;Domain: &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>                <span class="k">else</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>            <span class="p">)</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;Number of voxels: &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>                <span class="k">else</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>            <span class="p">)</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>                <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;MLUPS: &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>                <span class="o">+</span> <span class="n">colored</span><span class="p">(</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t_max</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e6</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>                    <span class="s2">&quot;red&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>                <span class="p">)</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>            <span class="p">)</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">colored</span><span class="p">(</span><span class="s2">&quot;Domain: &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">colored</span><span class="p">(</span><span class="s2">&quot;Number of voxels: &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>                <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;MLUPS: &quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>                <span class="o">+</span> <span class="n">colored</span><span class="p">(</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t_max</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e6</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>                    <span class="s2">&quot;red&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>                <span class="p">)</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>            <span class="p">)</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mngr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mngr</span><span class="o">.</span><span class="n">wait_until_finished</span><span class="p">()</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>    <span class="k">return</span> <span class="n">f_tree</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.step" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">step</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">step</span><span class="p">(</span><span class="n">f_poststreaming_tree</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">return_fpost</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This function performs a single step of the LBM simulation.</p>
<p>It first performs the collision step, which is the relaxation of the distribution functions
towards their equilibrium values. It then applies the respective boundary conditions to the
post-collision distribution functions.</p>
<p>The function then performs the streaming step, which is the propagation of the distribution
functions in the lattice. It then applies the respective boundary conditions to the post-streaming
distribution functions.</p>
<h4 id="src.multiphase.Multiphase.step--parameters">Parameters</h4>
<p>fin_tree (pytree of jax.numpy.ndarray): Post-streaming distribution function.</p>
<p>timestep (int): Current timestep</p>
<p>return_fpost (bool): Return post-collision distribution function (pytree).</p>
<h4 id="src.multiphase.Multiphase.step--returns">Returns</h4>
<p>f_poststreaming_tree (pytree of jax.numpy.ndarray): Post-streamed distribution function.</p>
<p>f_collision_tree (pytree of jax.numpy.ndarray {Optional}): Post-collision distribution function.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_poststreaming_tree</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">return_fpost</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">    This function performs a single step of the LBM simulation.</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="sd">    It first performs the collision step, which is the relaxation of the distribution functions</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">    towards their equilibrium values. It then applies the respective boundary conditions to the</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a><span class="sd">    post-collision distribution functions.</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a><span class="sd">    The function then performs the streaming step, which is the propagation of the distribution</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a><span class="sd">    functions in the lattice. It then applies the respective boundary conditions to the post-streaming</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a><span class="sd">    distribution functions.</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a><span class="sd">    fin_tree (pytree of jax.numpy.ndarray): Post-streaming distribution function.</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a><span class="sd">    timestep (int): Current timestep</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="sd">    return_fpost (bool): Return post-collision distribution function (pytree).</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a><span class="sd">    -------</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a><span class="sd">    f_poststreaming_tree (pytree of jax.numpy.ndarray): Post-streamed distribution function.</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a><span class="sd">    f_collision_tree (pytree of jax.numpy.ndarray {Optional}): Post-collision distribution function.</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>    <span class="n">f_postcollision_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collision</span><span class="p">(</span><span class="n">f_poststreaming_tree</span><span class="p">)</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>    <span class="n">f_postcollision_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_bc</span><span class="p">(</span><span class="n">f_postcollision_tree</span><span class="p">,</span> <span class="n">f_poststreaming_tree</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="s2">&quot;PostCollision&quot;</span><span class="p">)</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>    <span class="n">f_poststreaming_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f_postcollision</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="p">(</span><span class="n">f_postcollision</span><span class="p">),</span> <span class="n">f_postcollision_tree</span><span class="p">)</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>    <span class="n">f_poststreaming_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_bc</span><span class="p">(</span><span class="n">f_poststreaming_tree</span><span class="p">,</span> <span class="n">f_postcollision_tree</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="s2">&quot;PostStreaming&quot;</span><span class="p">)</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>    <span class="k">if</span> <span class="n">return_fpost</span><span class="p">:</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>        <span class="k">return</span> <span class="n">f_poststreaming_tree</span><span class="p">,</span> <span class="n">f_postcollision_tree</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>        <span class="k">return</span> <span class="n">f_poststreaming_tree</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.Multiphase.update_macroscopic" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">update_macroscopic</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">update_macroscopic</span><span class="p">(</span><span class="n">f_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>update_macroscopic from base.py extended to pytrees.</p>
<h4 id="src.multiphase.Multiphase.update_macroscopic--parameters">Parameters</h4>
<p>f_tree (pytree of jax.numpy.ndarray): Distribution field.</p>
<h4 id="src.multiphase.Multiphase.update_macroscopic--returns">Returns</h4>
<p>rho_tree (pytree of jax.numpy.ndarray): Density field.
u_tree (pytree of jax.numpy.ndarray): Velocity field.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_macroscopic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_tree</span><span class="p">):</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">    update_macroscopic from base.py extended to pytrees.</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">    f_tree (pytree of jax.numpy.ndarray): Distribution field.</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">    -------</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="sd">    rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">    u_tree (pytree of jax.numpy.ndarray): Velocity field.</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>    <span class="n">rho_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">f_tree</span><span class="p">)</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="n">u_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="n">rho</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">rho</span><span class="p">,</span> <span class="n">f_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>  <span class="c1"># Component velocity</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>    <span class="k">return</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="src.multiphase.MultiphaseBGK"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.multiphase.Multiphase" href="#src.multiphase.Multiphase">Multiphase</a></code></p>










              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/multiphase.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1108" name="__codelineno-0-1108"></a><span class="k">class</span><span class="w"> </span><span class="nc">MultiphaseBGK</span><span class="p">(</span><span class="n">Multiphase</span><span class="p">):</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">):</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a><span class="sd">        BGK collision step for lattice, extended to pytrees.</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="sd">        The collision step is where the main physics of the LBM is applied. In the BGK approximation,</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="sd">        the distribution function is relaxed towards the equilibrium distribution function.</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>        <span class="n">fin_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fin</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_compute</span><span class="p">(</span><span class="n">fin</span><span class="p">),</span> <span class="n">fin_tree</span><span class="p">)</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>        <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_macroscopic</span><span class="p">(</span><span class="n">fin_tree</span><span class="p">)</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>        <span class="n">feq_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equilibrium</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">,</span> <span class="n">cast_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>        <span class="n">fneq_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">feq</span><span class="p">,</span> <span class="n">fin</span><span class="p">:</span> <span class="n">feq</span> <span class="o">-</span> <span class="n">fin</span><span class="p">,</span> <span class="n">feq_tree</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">)</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>        <span class="n">fout_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fin</span><span class="p">,</span> <span class="n">fneq</span><span class="p">,</span> <span class="n">omega</span><span class="p">:</span> <span class="n">fin</span> <span class="o">+</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">fneq</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">,</span> <span class="n">fneq_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">)</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>        <span class="n">fout_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_force</span><span class="p">(</span><span class="n">fout_tree</span><span class="p">,</span> <span class="n">feq_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fout</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_output</span><span class="p">(</span><span class="n">fout</span><span class="p">),</span> <span class="n">fout_tree</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="src.multiphase.MultiphaseBGK.collision" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">collision</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">collision</span><span class="p">(</span><span class="n">fin_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>BGK collision step for lattice, extended to pytrees.</p>
<p>The collision step is where the main physics of the LBM is applied. In the BGK approximation,
the distribution function is relaxed towards the equilibrium distribution function.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1112" name="__codelineno-0-1112"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a><span class="k">def</span><span class="w"> </span><span class="nf">collision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">):</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a><span class="sd">    BGK collision step for lattice, extended to pytrees.</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="sd">    The collision step is where the main physics of the LBM is applied. In the BGK approximation,</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="sd">    the distribution function is relaxed towards the equilibrium distribution function.</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>    <span class="n">fin_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fin</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_compute</span><span class="p">(</span><span class="n">fin</span><span class="p">),</span> <span class="n">fin_tree</span><span class="p">)</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>    <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_macroscopic</span><span class="p">(</span><span class="n">fin_tree</span><span class="p">)</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>    <span class="n">feq_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equilibrium</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">,</span> <span class="n">cast_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>    <span class="n">fneq_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">feq</span><span class="p">,</span> <span class="n">fin</span><span class="p">:</span> <span class="n">feq</span> <span class="o">-</span> <span class="n">fin</span><span class="p">,</span> <span class="n">feq_tree</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">)</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>    <span class="n">fout_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fin</span><span class="p">,</span> <span class="n">fneq</span><span class="p">,</span> <span class="n">omega</span><span class="p">:</span> <span class="n">fin</span> <span class="o">+</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">fneq</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">,</span> <span class="n">fneq_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">)</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>    <span class="n">fout_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_force</span><span class="p">(</span><span class="n">fout_tree</span><span class="p">,</span> <span class="n">feq_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fout</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_output</span><span class="p">(</span><span class="n">fout</span><span class="p">),</span> <span class="n">fout_tree</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="src.multiphase.MultiphaseMRT"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.multiphase.Multiphase" href="#src.multiphase.Multiphase">Multiphase</a></code></p>










              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/multiphase.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><span class="k">class</span><span class="w"> </span><span class="nc">MultiphaseMRT</span><span class="p">(</span><span class="n">Multiphase</span><span class="p">):</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s_rho</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_rho&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s_e</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_e&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s_eta</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_eta&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s_j</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_j&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s_q</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_q&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s_v</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_v&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">M_inv</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>            <span class="k">lambda</span> <span class="n">M</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>                <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>                <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">,</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>            <span class="p">),</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">),</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>        <span class="p">)</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>            <span class="k">lambda</span> <span class="n">M</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">),</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">),</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>        <span class="p">)</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD2Q9</span><span class="p">):</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>                <span class="k">lambda</span> <span class="n">s_rho</span><span class="p">,</span> <span class="n">s_e</span><span class="p">,</span> <span class="n">s_eta</span><span class="p">,</span> <span class="n">s_j</span><span class="p">,</span> <span class="n">s_q</span><span class="p">,</span> <span class="n">s_v</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="n">s_rho</span><span class="p">,</span> <span class="n">s_e</span><span class="p">,</span> <span class="n">s_eta</span><span class="p">,</span> <span class="n">s_j</span><span class="p">,</span> <span class="n">s_q</span><span class="p">,</span> <span class="n">s_j</span><span class="p">,</span> <span class="n">s_q</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_v</span><span class="p">]),</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>                    <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">,</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>                <span class="p">),</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_rho</span><span class="p">,</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_e</span><span class="p">,</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_eta</span><span class="p">,</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_j</span><span class="p">,</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_q</span><span class="p">,</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_v</span><span class="p">,</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>            <span class="p">)</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q19</span><span class="p">):</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">s_pi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_pi&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">s_m</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_m&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>                <span class="k">lambda</span> <span class="n">s_rho</span><span class="p">,</span> <span class="n">s_e</span><span class="p">,</span> <span class="n">s_eta</span><span class="p">,</span> <span class="n">s_j</span><span class="p">,</span> <span class="n">s_q</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_pi</span><span class="p">,</span> <span class="n">s_m</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>                        <span class="n">s_rho</span><span class="p">,</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>                        <span class="n">s_e</span><span class="p">,</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>                        <span class="n">s_eta</span><span class="p">,</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>                        <span class="n">s_j</span><span class="p">,</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>                        <span class="n">s_q</span><span class="p">,</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>                        <span class="n">s_j</span><span class="p">,</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>                        <span class="n">s_q</span><span class="p">,</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>                        <span class="n">s_j</span><span class="p">,</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>                        <span class="n">s_q</span><span class="p">,</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>                        <span class="n">s_v</span><span class="p">,</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>                        <span class="n">s_pi</span><span class="p">,</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>                        <span class="n">s_v</span><span class="p">,</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>                        <span class="n">s_pi</span><span class="p">,</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>                        <span class="n">s_v</span><span class="p">,</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>                        <span class="n">s_v</span><span class="p">,</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>                        <span class="n">s_v</span><span class="p">,</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>                        <span class="n">s_m</span><span class="p">,</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>                        <span class="n">s_m</span><span class="p">,</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>                        <span class="n">s_m</span><span class="p">,</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>                    <span class="p">]),</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>                    <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">,</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>                <span class="p">),</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_rho</span><span class="p">,</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_e</span><span class="p">,</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_eta</span><span class="p">,</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_j</span><span class="p">,</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_q</span><span class="p">,</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_v</span><span class="p">,</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_pi</span><span class="p">,</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_m</span><span class="p">,</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>            <span class="p">)</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">omega</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omega</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>    <span class="nd">@omega</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">omega</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_omega</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">M</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_M</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>    <span class="nd">@M</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">M</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Matrix M must be a list&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">:</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of components does not match number of matrix M passed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_M</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">adjust_surface_tension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psi_tree</span><span class="p">):</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>        <span class="n">psi_s_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">psi</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaming</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)),</span> <span class="n">psi_tree</span><span class="p">)</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD2Q9</span><span class="p">):</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>            <span class="n">tm1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">:</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_ff</span> <span class="o">*</span> <span class="p">(</span><span class="n">psi_s</span> <span class="o">-</span> <span class="n">psi</span><span class="p">),</span> <span class="n">c</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>            <span class="n">tm2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_ff</span> <span class="o">*</span> <span class="p">(</span><span class="n">psi_s</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">psi</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">c</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">compute_C</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_e</span><span class="p">,</span> <span class="n">s_eta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">):</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>                    <span class="n">psi_s</span><span class="p">,</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>                    <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">,</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>                <span class="p">)</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>                <span class="n">qxx</span> <span class="o">=</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">tm1</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">tm2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">))</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>                <span class="n">qxy</span> <span class="o">=</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">tm1</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">tm2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">))</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>                <span class="n">qyy</span> <span class="o">=</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">tm1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">tm2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">))</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">s_e</span> <span class="o">*</span> <span class="p">(</span><span class="n">qxx</span> <span class="o">+</span> <span class="n">qyy</span><span class="p">))</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">s_eta</span> <span class="o">*</span> <span class="p">(</span><span class="n">qxx</span> <span class="o">+</span> <span class="n">qyy</span><span class="p">))</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="n">s_v</span> <span class="o">*</span> <span class="p">(</span><span class="n">qxx</span> <span class="o">-</span> <span class="n">qyy</span><span class="p">))</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="n">s_v</span> <span class="o">*</span> <span class="n">qxy</span><span class="p">)</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>                <span class="k">return</span> <span class="n">C</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>            <span class="n">C_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>                <span class="k">lambda</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_e</span><span class="p">,</span> <span class="n">s_eta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">:</span> <span class="n">compute_C</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_e</span><span class="p">,</span> <span class="n">s_eta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">),</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="p">,</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()),</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_v</span><span class="p">,</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_e</span><span class="p">,</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_eta</span><span class="p">,</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>                <span class="n">psi_tree</span><span class="p">,</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>                <span class="n">psi_s_tree</span><span class="p">,</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>            <span class="p">)</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>            <span class="k">return</span> <span class="n">C_tree</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q19</span><span class="p">):</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>            <span class="n">tm1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">:</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_ff</span> <span class="o">*</span> <span class="p">(</span><span class="n">psi_s</span> <span class="o">-</span> <span class="n">psi</span><span class="p">),</span> <span class="n">c</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>            <span class="n">tm2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_ff</span> <span class="o">*</span> <span class="p">(</span><span class="n">psi_s</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">psi</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">c</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">compute_C</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_e</span><span class="p">,</span> <span class="n">s_eta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">):</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>                    <span class="n">psi_s</span><span class="p">,</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>                    <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">,</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>                <span class="p">)</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>                <span class="n">qxx</span> <span class="o">=</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">tm1</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">tm2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">))</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>                <span class="n">qxy</span> <span class="o">=</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">tm1</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">tm2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">))</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>                <span class="n">qxz</span> <span class="o">=</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">tm1</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">tm2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">))</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>                <span class="n">qyy</span> <span class="o">=</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">tm1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">tm2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">))</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>                <span class="n">qyz</span> <span class="o">=</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">tm1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">tm2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">))</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>                <span class="n">qzz</span> <span class="o">=</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">tm1</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">tm2</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">))</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">((</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">s_e</span> <span class="o">*</span> <span class="p">(</span><span class="n">qxx</span> <span class="o">+</span> <span class="n">qyy</span> <span class="o">+</span> <span class="n">qzz</span><span class="p">))</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="n">s_v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">qxx</span> <span class="o">-</span> <span class="n">qyy</span> <span class="o">-</span> <span class="n">qzz</span><span class="p">))</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="n">s_v</span> <span class="o">*</span> <span class="p">(</span><span class="n">qyy</span> <span class="o">-</span> <span class="n">qzz</span><span class="p">))</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="n">s_v</span> <span class="o">*</span> <span class="n">qxy</span><span class="p">)</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="n">s_v</span> <span class="o">*</span> <span class="n">qyz</span><span class="p">)</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="n">s_v</span> <span class="o">*</span> <span class="n">qxz</span><span class="p">)</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>                <span class="k">return</span> <span class="n">C</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>            <span class="n">C_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>                <span class="k">lambda</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_e</span><span class="p">,</span> <span class="n">s_eta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">:</span> <span class="n">compute_C</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_e</span><span class="p">,</span> <span class="n">s_eta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_s</span><span class="p">),</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="p">,</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()),</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_v</span><span class="p">,</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_e</span><span class="p">,</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_eta</span><span class="p">,</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>                <span class="n">psi_tree</span><span class="p">,</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>                <span class="n">psi_s_tree</span><span class="p">,</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>            <span class="p">)</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>            <span class="k">return</span> <span class="n">C_tree</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;MRT model with D3Q27 model has not been implemented&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_tree</span><span class="p">,</span> <span class="n">meq_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">):</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a><span class="sd">        Modified version of the apply_force defined in LBMBase to account for modified force.</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a><span class="sd">        m_tree (pytree of jax.numpy.ndarray): Post-collision distribution function.</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a><span class="sd">        meq_tree (pytree of jax.numpy.ndarray): Equilibrium distribution function.</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a><span class="sd">        rho_tree (pytree of jax.numpy.ndarray): Density field for all components.</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a><span class="sd">        u_tree (pytree of jax.numpy.ndarray): Velocity field for all components.</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a><span class="sd">        f_postcollision_tree (pytree of jax.numpy.ndarray): Post-collision distribution functions with the force applied.</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>        <span class="n">F_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_force</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>        <span class="n">delta_u_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">F</span><span class="p">,</span> <span class="n">rho</span><span class="p">:</span> <span class="n">F</span> <span class="o">/</span> <span class="n">rho</span><span class="p">,</span> <span class="n">F_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>        <span class="n">u_temp_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">,</span> <span class="n">delta_u</span><span class="p">:</span> <span class="n">u</span> <span class="o">+</span> <span class="n">delta_u</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">,</span> <span class="n">delta_u_tree</span><span class="p">)</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>        <span class="n">feq_force_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equilibrium</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_temp_tree</span><span class="p">,</span> <span class="n">cast_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>        <span class="n">meq_force_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">feq</span><span class="p">,</span> <span class="n">M</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">feq</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="n">feq_force_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>            <span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">meq_force</span><span class="p">,</span> <span class="n">meq</span><span class="p">:</span> <span class="n">m</span> <span class="o">+</span> <span class="n">meq_force</span> <span class="o">-</span> <span class="n">meq</span><span class="p">,</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>            <span class="n">m_tree</span><span class="p">,</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>            <span class="n">meq_force_tree</span><span class="p">,</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>            <span class="n">meq_tree</span><span class="p">,</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>        <span class="p">)</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">):</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a><span class="sd">        MRT collision step for lattice.</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>        <span class="n">fin_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_compute</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">fin_tree</span><span class="p">)</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>        <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_macroscopic</span><span class="p">(</span><span class="n">fin_tree</span><span class="p">)</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>        <span class="n">m_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="n">M</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="n">fin_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>        <span class="n">feq_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equilibrium</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">,</span> <span class="n">cast_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>        <span class="n">meq_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">feq</span><span class="p">,</span> <span class="n">M</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">feq</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="n">feq_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>        <span class="n">psi_tree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_potential</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>        <span class="n">C_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_surface_tension</span><span class="p">(</span><span class="n">psi_tree</span><span class="p">)</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>        <span class="n">mout_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>            <span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">meq</span><span class="p">,</span> <span class="n">S</span><span class="p">:</span> <span class="n">m</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">meq</span><span class="p">,</span> <span class="n">S</span><span class="p">),</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>            <span class="n">m_tree</span><span class="p">,</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>            <span class="n">meq_tree</span><span class="p">,</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>        <span class="p">)</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>        <span class="n">mout_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_force</span><span class="p">(</span><span class="n">mout_tree</span><span class="p">,</span> <span class="n">meq_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>        <span class="n">fout_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">Minv</span><span class="p">,</span> <span class="n">C</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">C</span><span class="p">,</span> <span class="n">Minv</span><span class="p">),</span> <span class="n">mout_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_inv</span><span class="p">,</span> <span class="n">C_tree</span><span class="p">)</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>        <span class="c1"># fout_tree = self.apply_force(fout_tree, feq_tree, rho_tree, u_tree)</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>            <span class="k">lambda</span> <span class="n">fout</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_output</span><span class="p">(</span><span class="n">fout</span><span class="p">),</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>            <span class="n">fout_tree</span><span class="p">,</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="src.multiphase.MultiphaseMRT.apply_force" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">apply_force</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">apply_force</span><span class="p">(</span><span class="n">m_tree</span><span class="p">,</span> <span class="n">meq_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Modified version of the apply_force defined in LBMBase to account for modified force.</p>
<h4 id="src.multiphase.MultiphaseMRT.apply_force--parameters">Parameters</h4>
<p>m_tree (pytree of jax.numpy.ndarray): Post-collision distribution function.</p>
<p>meq_tree (pytree of jax.numpy.ndarray): Equilibrium distribution function.</p>
<p>rho_tree (pytree of jax.numpy.ndarray): Density field for all components.</p>
<p>u_tree (pytree of jax.numpy.ndarray): Velocity field for all components.</p>
<h4 id="src.multiphase.MultiphaseMRT.apply_force--returns">Returns</h4>
<p>f_postcollision_tree (pytree of jax.numpy.ndarray): Post-collision distribution functions with the force applied.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1293" name="__codelineno-0-1293"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_tree</span><span class="p">,</span> <span class="n">meq_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">):</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a><span class="sd">    Modified version of the apply_force defined in LBMBase to account for modified force.</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a><span class="sd">    m_tree (pytree of jax.numpy.ndarray): Post-collision distribution function.</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a><span class="sd">    meq_tree (pytree of jax.numpy.ndarray): Equilibrium distribution function.</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a><span class="sd">    rho_tree (pytree of jax.numpy.ndarray): Density field for all components.</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a><span class="sd">    u_tree (pytree of jax.numpy.ndarray): Velocity field for all components.</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a><span class="sd">    f_postcollision_tree (pytree of jax.numpy.ndarray): Post-collision distribution functions with the force applied.</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>    <span class="n">F_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_force</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>    <span class="n">delta_u_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">F</span><span class="p">,</span> <span class="n">rho</span><span class="p">:</span> <span class="n">F</span> <span class="o">/</span> <span class="n">rho</span><span class="p">,</span> <span class="n">F_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>    <span class="n">u_temp_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">,</span> <span class="n">delta_u</span><span class="p">:</span> <span class="n">u</span> <span class="o">+</span> <span class="n">delta_u</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">,</span> <span class="n">delta_u_tree</span><span class="p">)</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>    <span class="n">feq_force_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equilibrium</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_temp_tree</span><span class="p">,</span> <span class="n">cast_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>    <span class="n">meq_force_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">feq</span><span class="p">,</span> <span class="n">M</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">feq</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="n">feq_force_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>        <span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">meq_force</span><span class="p">,</span> <span class="n">meq</span><span class="p">:</span> <span class="n">m</span> <span class="o">+</span> <span class="n">meq_force</span> <span class="o">-</span> <span class="n">meq</span><span class="p">,</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>        <span class="n">m_tree</span><span class="p">,</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>        <span class="n">meq_force_tree</span><span class="p">,</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>        <span class="n">meq_tree</span><span class="p">,</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.MultiphaseMRT.collision" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">collision</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">collision</span><span class="p">(</span><span class="n">fin_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>MRT collision step for lattice.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1325" name="__codelineno-0-1325"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a><span class="k">def</span><span class="w"> </span><span class="nf">collision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">):</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a><span class="sd">    MRT collision step for lattice.</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>    <span class="n">fin_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_compute</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">fin_tree</span><span class="p">)</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>    <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_macroscopic</span><span class="p">(</span><span class="n">fin_tree</span><span class="p">)</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>    <span class="n">m_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="n">M</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="n">fin_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>    <span class="n">feq_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equilibrium</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">,</span> <span class="n">cast_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>    <span class="n">meq_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">feq</span><span class="p">,</span> <span class="n">M</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">feq</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="n">feq_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>    <span class="n">psi_tree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_potential</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>    <span class="n">C_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_surface_tension</span><span class="p">(</span><span class="n">psi_tree</span><span class="p">)</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>    <span class="n">mout_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>        <span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">meq</span><span class="p">,</span> <span class="n">S</span><span class="p">:</span> <span class="n">m</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">meq</span><span class="p">,</span> <span class="n">S</span><span class="p">),</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>        <span class="n">m_tree</span><span class="p">,</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>        <span class="n">meq_tree</span><span class="p">,</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>    <span class="p">)</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>    <span class="n">mout_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_force</span><span class="p">(</span><span class="n">mout_tree</span><span class="p">,</span> <span class="n">meq_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>    <span class="n">fout_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">Minv</span><span class="p">,</span> <span class="n">C</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">C</span><span class="p">,</span> <span class="n">Minv</span><span class="p">),</span> <span class="n">mout_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_inv</span><span class="p">,</span> <span class="n">C_tree</span><span class="p">)</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>    <span class="c1"># fout_tree = self.apply_force(fout_tree, feq_tree, rho_tree, u_tree)</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>        <span class="k">lambda</span> <span class="n">fout</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_output</span><span class="p">(</span><span class="n">fout</span><span class="p">),</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>        <span class="n">fout_tree</span><span class="p">,</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="src.multiphase.MultiphaseCascade"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.multiphase.Multiphase" href="#src.multiphase.Multiphase">Multiphase</a></code></p>



        <p>Cascaded LBM collision model transforms the distribution to central moments and then relaxation them. The central moments are obtained by first
transforming distributions to raw-moment using transformation matrix similar to MRT model. The raw-moments are subsequently transformed to central
moments using shift-matrix. CLBM gives independent control over vapor diffusivity, binary diffusivity and Schmidt number, which is not possible using SRT model.</p>
<p>The current implementation is based on:
1. Fei, L. &amp; Luo, K. H. Consistent forcing scheme in the cascaded lattice Boltzmann method. Phys. Rev. E 96, 053307 (2017).</p>
<ol>
<li>Fei, L., Luo, K. H. &amp; Li, Q. Three-dimensional cascaded lattice Boltzmann method: Improved implementation and consistent forcing scheme. Phys. Rev. E 97, 053309 (2018).</li>
</ol>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/multiphase.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span>
<span class="normal"><a href="#__codelineno-0-1873">1873</a></span>
<span class="normal"><a href="#__codelineno-0-1874">1874</a></span>
<span class="normal"><a href="#__codelineno-0-1875">1875</a></span>
<span class="normal"><a href="#__codelineno-0-1876">1876</a></span>
<span class="normal"><a href="#__codelineno-0-1877">1877</a></span>
<span class="normal"><a href="#__codelineno-0-1878">1878</a></span>
<span class="normal"><a href="#__codelineno-0-1879">1879</a></span>
<span class="normal"><a href="#__codelineno-0-1880">1880</a></span>
<span class="normal"><a href="#__codelineno-0-1881">1881</a></span>
<span class="normal"><a href="#__codelineno-0-1882">1882</a></span>
<span class="normal"><a href="#__codelineno-0-1883">1883</a></span>
<span class="normal"><a href="#__codelineno-0-1884">1884</a></span>
<span class="normal"><a href="#__codelineno-0-1885">1885</a></span>
<span class="normal"><a href="#__codelineno-0-1886">1886</a></span>
<span class="normal"><a href="#__codelineno-0-1887">1887</a></span>
<span class="normal"><a href="#__codelineno-0-1888">1888</a></span>
<span class="normal"><a href="#__codelineno-0-1889">1889</a></span>
<span class="normal"><a href="#__codelineno-0-1890">1890</a></span>
<span class="normal"><a href="#__codelineno-0-1891">1891</a></span>
<span class="normal"><a href="#__codelineno-0-1892">1892</a></span>
<span class="normal"><a href="#__codelineno-0-1893">1893</a></span>
<span class="normal"><a href="#__codelineno-0-1894">1894</a></span>
<span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span>
<span class="normal"><a href="#__codelineno-0-1903">1903</a></span>
<span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span>
<span class="normal"><a href="#__codelineno-0-2009">2009</a></span>
<span class="normal"><a href="#__codelineno-0-2010">2010</a></span>
<span class="normal"><a href="#__codelineno-0-2011">2011</a></span>
<span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span>
<span class="normal"><a href="#__codelineno-0-2021">2021</a></span>
<span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span>
<span class="normal"><a href="#__codelineno-0-2039">2039</a></span>
<span class="normal"><a href="#__codelineno-0-2040">2040</a></span>
<span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span>
<span class="normal"><a href="#__codelineno-0-2044">2044</a></span>
<span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span>
<span class="normal"><a href="#__codelineno-0-2050">2050</a></span>
<span class="normal"><a href="#__codelineno-0-2051">2051</a></span>
<span class="normal"><a href="#__codelineno-0-2052">2052</a></span>
<span class="normal"><a href="#__codelineno-0-2053">2053</a></span>
<span class="normal"><a href="#__codelineno-0-2054">2054</a></span>
<span class="normal"><a href="#__codelineno-0-2055">2055</a></span>
<span class="normal"><a href="#__codelineno-0-2056">2056</a></span>
<span class="normal"><a href="#__codelineno-0-2057">2057</a></span>
<span class="normal"><a href="#__codelineno-0-2058">2058</a></span>
<span class="normal"><a href="#__codelineno-0-2059">2059</a></span>
<span class="normal"><a href="#__codelineno-0-2060">2060</a></span>
<span class="normal"><a href="#__codelineno-0-2061">2061</a></span>
<span class="normal"><a href="#__codelineno-0-2062">2062</a></span>
<span class="normal"><a href="#__codelineno-0-2063">2063</a></span>
<span class="normal"><a href="#__codelineno-0-2064">2064</a></span>
<span class="normal"><a href="#__codelineno-0-2065">2065</a></span>
<span class="normal"><a href="#__codelineno-0-2066">2066</a></span>
<span class="normal"><a href="#__codelineno-0-2067">2067</a></span>
<span class="normal"><a href="#__codelineno-0-2068">2068</a></span>
<span class="normal"><a href="#__codelineno-0-2069">2069</a></span>
<span class="normal"><a href="#__codelineno-0-2070">2070</a></span>
<span class="normal"><a href="#__codelineno-0-2071">2071</a></span>
<span class="normal"><a href="#__codelineno-0-2072">2072</a></span>
<span class="normal"><a href="#__codelineno-0-2073">2073</a></span>
<span class="normal"><a href="#__codelineno-0-2074">2074</a></span>
<span class="normal"><a href="#__codelineno-0-2075">2075</a></span>
<span class="normal"><a href="#__codelineno-0-2076">2076</a></span>
<span class="normal"><a href="#__codelineno-0-2077">2077</a></span>
<span class="normal"><a href="#__codelineno-0-2078">2078</a></span>
<span class="normal"><a href="#__codelineno-0-2079">2079</a></span>
<span class="normal"><a href="#__codelineno-0-2080">2080</a></span>
<span class="normal"><a href="#__codelineno-0-2081">2081</a></span>
<span class="normal"><a href="#__codelineno-0-2082">2082</a></span>
<span class="normal"><a href="#__codelineno-0-2083">2083</a></span>
<span class="normal"><a href="#__codelineno-0-2084">2084</a></span>
<span class="normal"><a href="#__codelineno-0-2085">2085</a></span>
<span class="normal"><a href="#__codelineno-0-2086">2086</a></span>
<span class="normal"><a href="#__codelineno-0-2087">2087</a></span>
<span class="normal"><a href="#__codelineno-0-2088">2088</a></span>
<span class="normal"><a href="#__codelineno-0-2089">2089</a></span>
<span class="normal"><a href="#__codelineno-0-2090">2090</a></span>
<span class="normal"><a href="#__codelineno-0-2091">2091</a></span>
<span class="normal"><a href="#__codelineno-0-2092">2092</a></span>
<span class="normal"><a href="#__codelineno-0-2093">2093</a></span>
<span class="normal"><a href="#__codelineno-0-2094">2094</a></span>
<span class="normal"><a href="#__codelineno-0-2095">2095</a></span>
<span class="normal"><a href="#__codelineno-0-2096">2096</a></span>
<span class="normal"><a href="#__codelineno-0-2097">2097</a></span>
<span class="normal"><a href="#__codelineno-0-2098">2098</a></span>
<span class="normal"><a href="#__codelineno-0-2099">2099</a></span>
<span class="normal"><a href="#__codelineno-0-2100">2100</a></span>
<span class="normal"><a href="#__codelineno-0-2101">2101</a></span>
<span class="normal"><a href="#__codelineno-0-2102">2102</a></span>
<span class="normal"><a href="#__codelineno-0-2103">2103</a></span>
<span class="normal"><a href="#__codelineno-0-2104">2104</a></span>
<span class="normal"><a href="#__codelineno-0-2105">2105</a></span>
<span class="normal"><a href="#__codelineno-0-2106">2106</a></span>
<span class="normal"><a href="#__codelineno-0-2107">2107</a></span>
<span class="normal"><a href="#__codelineno-0-2108">2108</a></span>
<span class="normal"><a href="#__codelineno-0-2109">2109</a></span>
<span class="normal"><a href="#__codelineno-0-2110">2110</a></span>
<span class="normal"><a href="#__codelineno-0-2111">2111</a></span>
<span class="normal"><a href="#__codelineno-0-2112">2112</a></span>
<span class="normal"><a href="#__codelineno-0-2113">2113</a></span>
<span class="normal"><a href="#__codelineno-0-2114">2114</a></span>
<span class="normal"><a href="#__codelineno-0-2115">2115</a></span>
<span class="normal"><a href="#__codelineno-0-2116">2116</a></span>
<span class="normal"><a href="#__codelineno-0-2117">2117</a></span>
<span class="normal"><a href="#__codelineno-0-2118">2118</a></span>
<span class="normal"><a href="#__codelineno-0-2119">2119</a></span>
<span class="normal"><a href="#__codelineno-0-2120">2120</a></span>
<span class="normal"><a href="#__codelineno-0-2121">2121</a></span>
<span class="normal"><a href="#__codelineno-0-2122">2122</a></span>
<span class="normal"><a href="#__codelineno-0-2123">2123</a></span>
<span class="normal"><a href="#__codelineno-0-2124">2124</a></span>
<span class="normal"><a href="#__codelineno-0-2125">2125</a></span>
<span class="normal"><a href="#__codelineno-0-2126">2126</a></span>
<span class="normal"><a href="#__codelineno-0-2127">2127</a></span>
<span class="normal"><a href="#__codelineno-0-2128">2128</a></span>
<span class="normal"><a href="#__codelineno-0-2129">2129</a></span>
<span class="normal"><a href="#__codelineno-0-2130">2130</a></span>
<span class="normal"><a href="#__codelineno-0-2131">2131</a></span>
<span class="normal"><a href="#__codelineno-0-2132">2132</a></span>
<span class="normal"><a href="#__codelineno-0-2133">2133</a></span>
<span class="normal"><a href="#__codelineno-0-2134">2134</a></span>
<span class="normal"><a href="#__codelineno-0-2135">2135</a></span>
<span class="normal"><a href="#__codelineno-0-2136">2136</a></span>
<span class="normal"><a href="#__codelineno-0-2137">2137</a></span>
<span class="normal"><a href="#__codelineno-0-2138">2138</a></span>
<span class="normal"><a href="#__codelineno-0-2139">2139</a></span>
<span class="normal"><a href="#__codelineno-0-2140">2140</a></span>
<span class="normal"><a href="#__codelineno-0-2141">2141</a></span>
<span class="normal"><a href="#__codelineno-0-2142">2142</a></span>
<span class="normal"><a href="#__codelineno-0-2143">2143</a></span>
<span class="normal"><a href="#__codelineno-0-2144">2144</a></span>
<span class="normal"><a href="#__codelineno-0-2145">2145</a></span>
<span class="normal"><a href="#__codelineno-0-2146">2146</a></span>
<span class="normal"><a href="#__codelineno-0-2147">2147</a></span>
<span class="normal"><a href="#__codelineno-0-2148">2148</a></span>
<span class="normal"><a href="#__codelineno-0-2149">2149</a></span>
<span class="normal"><a href="#__codelineno-0-2150">2150</a></span>
<span class="normal"><a href="#__codelineno-0-2151">2151</a></span>
<span class="normal"><a href="#__codelineno-0-2152">2152</a></span>
<span class="normal"><a href="#__codelineno-0-2153">2153</a></span>
<span class="normal"><a href="#__codelineno-0-2154">2154</a></span>
<span class="normal"><a href="#__codelineno-0-2155">2155</a></span>
<span class="normal"><a href="#__codelineno-0-2156">2156</a></span>
<span class="normal"><a href="#__codelineno-0-2157">2157</a></span>
<span class="normal"><a href="#__codelineno-0-2158">2158</a></span>
<span class="normal"><a href="#__codelineno-0-2159">2159</a></span>
<span class="normal"><a href="#__codelineno-0-2160">2160</a></span>
<span class="normal"><a href="#__codelineno-0-2161">2161</a></span>
<span class="normal"><a href="#__codelineno-0-2162">2162</a></span>
<span class="normal"><a href="#__codelineno-0-2163">2163</a></span>
<span class="normal"><a href="#__codelineno-0-2164">2164</a></span>
<span class="normal"><a href="#__codelineno-0-2165">2165</a></span>
<span class="normal"><a href="#__codelineno-0-2166">2166</a></span>
<span class="normal"><a href="#__codelineno-0-2167">2167</a></span>
<span class="normal"><a href="#__codelineno-0-2168">2168</a></span>
<span class="normal"><a href="#__codelineno-0-2169">2169</a></span>
<span class="normal"><a href="#__codelineno-0-2170">2170</a></span>
<span class="normal"><a href="#__codelineno-0-2171">2171</a></span>
<span class="normal"><a href="#__codelineno-0-2172">2172</a></span>
<span class="normal"><a href="#__codelineno-0-2173">2173</a></span>
<span class="normal"><a href="#__codelineno-0-2174">2174</a></span>
<span class="normal"><a href="#__codelineno-0-2175">2175</a></span>
<span class="normal"><a href="#__codelineno-0-2176">2176</a></span>
<span class="normal"><a href="#__codelineno-0-2177">2177</a></span>
<span class="normal"><a href="#__codelineno-0-2178">2178</a></span>
<span class="normal"><a href="#__codelineno-0-2179">2179</a></span>
<span class="normal"><a href="#__codelineno-0-2180">2180</a></span>
<span class="normal"><a href="#__codelineno-0-2181">2181</a></span>
<span class="normal"><a href="#__codelineno-0-2182">2182</a></span>
<span class="normal"><a href="#__codelineno-0-2183">2183</a></span>
<span class="normal"><a href="#__codelineno-0-2184">2184</a></span>
<span class="normal"><a href="#__codelineno-0-2185">2185</a></span>
<span class="normal"><a href="#__codelineno-0-2186">2186</a></span>
<span class="normal"><a href="#__codelineno-0-2187">2187</a></span>
<span class="normal"><a href="#__codelineno-0-2188">2188</a></span>
<span class="normal"><a href="#__codelineno-0-2189">2189</a></span>
<span class="normal"><a href="#__codelineno-0-2190">2190</a></span>
<span class="normal"><a href="#__codelineno-0-2191">2191</a></span>
<span class="normal"><a href="#__codelineno-0-2192">2192</a></span>
<span class="normal"><a href="#__codelineno-0-2193">2193</a></span>
<span class="normal"><a href="#__codelineno-0-2194">2194</a></span>
<span class="normal"><a href="#__codelineno-0-2195">2195</a></span>
<span class="normal"><a href="#__codelineno-0-2196">2196</a></span>
<span class="normal"><a href="#__codelineno-0-2197">2197</a></span>
<span class="normal"><a href="#__codelineno-0-2198">2198</a></span>
<span class="normal"><a href="#__codelineno-0-2199">2199</a></span>
<span class="normal"><a href="#__codelineno-0-2200">2200</a></span>
<span class="normal"><a href="#__codelineno-0-2201">2201</a></span>
<span class="normal"><a href="#__codelineno-0-2202">2202</a></span>
<span class="normal"><a href="#__codelineno-0-2203">2203</a></span>
<span class="normal"><a href="#__codelineno-0-2204">2204</a></span>
<span class="normal"><a href="#__codelineno-0-2205">2205</a></span>
<span class="normal"><a href="#__codelineno-0-2206">2206</a></span>
<span class="normal"><a href="#__codelineno-0-2207">2207</a></span>
<span class="normal"><a href="#__codelineno-0-2208">2208</a></span>
<span class="normal"><a href="#__codelineno-0-2209">2209</a></span>
<span class="normal"><a href="#__codelineno-0-2210">2210</a></span>
<span class="normal"><a href="#__codelineno-0-2211">2211</a></span>
<span class="normal"><a href="#__codelineno-0-2212">2212</a></span>
<span class="normal"><a href="#__codelineno-0-2213">2213</a></span>
<span class="normal"><a href="#__codelineno-0-2214">2214</a></span>
<span class="normal"><a href="#__codelineno-0-2215">2215</a></span>
<span class="normal"><a href="#__codelineno-0-2216">2216</a></span>
<span class="normal"><a href="#__codelineno-0-2217">2217</a></span>
<span class="normal"><a href="#__codelineno-0-2218">2218</a></span>
<span class="normal"><a href="#__codelineno-0-2219">2219</a></span>
<span class="normal"><a href="#__codelineno-0-2220">2220</a></span>
<span class="normal"><a href="#__codelineno-0-2221">2221</a></span>
<span class="normal"><a href="#__codelineno-0-2222">2222</a></span>
<span class="normal"><a href="#__codelineno-0-2223">2223</a></span>
<span class="normal"><a href="#__codelineno-0-2224">2224</a></span>
<span class="normal"><a href="#__codelineno-0-2225">2225</a></span>
<span class="normal"><a href="#__codelineno-0-2226">2226</a></span>
<span class="normal"><a href="#__codelineno-0-2227">2227</a></span>
<span class="normal"><a href="#__codelineno-0-2228">2228</a></span>
<span class="normal"><a href="#__codelineno-0-2229">2229</a></span>
<span class="normal"><a href="#__codelineno-0-2230">2230</a></span>
<span class="normal"><a href="#__codelineno-0-2231">2231</a></span>
<span class="normal"><a href="#__codelineno-0-2232">2232</a></span>
<span class="normal"><a href="#__codelineno-0-2233">2233</a></span>
<span class="normal"><a href="#__codelineno-0-2234">2234</a></span>
<span class="normal"><a href="#__codelineno-0-2235">2235</a></span>
<span class="normal"><a href="#__codelineno-0-2236">2236</a></span>
<span class="normal"><a href="#__codelineno-0-2237">2237</a></span>
<span class="normal"><a href="#__codelineno-0-2238">2238</a></span>
<span class="normal"><a href="#__codelineno-0-2239">2239</a></span>
<span class="normal"><a href="#__codelineno-0-2240">2240</a></span>
<span class="normal"><a href="#__codelineno-0-2241">2241</a></span>
<span class="normal"><a href="#__codelineno-0-2242">2242</a></span>
<span class="normal"><a href="#__codelineno-0-2243">2243</a></span>
<span class="normal"><a href="#__codelineno-0-2244">2244</a></span>
<span class="normal"><a href="#__codelineno-0-2245">2245</a></span>
<span class="normal"><a href="#__codelineno-0-2246">2246</a></span>
<span class="normal"><a href="#__codelineno-0-2247">2247</a></span>
<span class="normal"><a href="#__codelineno-0-2248">2248</a></span>
<span class="normal"><a href="#__codelineno-0-2249">2249</a></span>
<span class="normal"><a href="#__codelineno-0-2250">2250</a></span>
<span class="normal"><a href="#__codelineno-0-2251">2251</a></span>
<span class="normal"><a href="#__codelineno-0-2252">2252</a></span>
<span class="normal"><a href="#__codelineno-0-2253">2253</a></span>
<span class="normal"><a href="#__codelineno-0-2254">2254</a></span>
<span class="normal"><a href="#__codelineno-0-2255">2255</a></span>
<span class="normal"><a href="#__codelineno-0-2256">2256</a></span>
<span class="normal"><a href="#__codelineno-0-2257">2257</a></span>
<span class="normal"><a href="#__codelineno-0-2258">2258</a></span>
<span class="normal"><a href="#__codelineno-0-2259">2259</a></span>
<span class="normal"><a href="#__codelineno-0-2260">2260</a></span>
<span class="normal"><a href="#__codelineno-0-2261">2261</a></span>
<span class="normal"><a href="#__codelineno-0-2262">2262</a></span>
<span class="normal"><a href="#__codelineno-0-2263">2263</a></span>
<span class="normal"><a href="#__codelineno-0-2264">2264</a></span>
<span class="normal"><a href="#__codelineno-0-2265">2265</a></span>
<span class="normal"><a href="#__codelineno-0-2266">2266</a></span>
<span class="normal"><a href="#__codelineno-0-2267">2267</a></span>
<span class="normal"><a href="#__codelineno-0-2268">2268</a></span>
<span class="normal"><a href="#__codelineno-0-2269">2269</a></span>
<span class="normal"><a href="#__codelineno-0-2270">2270</a></span>
<span class="normal"><a href="#__codelineno-0-2271">2271</a></span>
<span class="normal"><a href="#__codelineno-0-2272">2272</a></span>
<span class="normal"><a href="#__codelineno-0-2273">2273</a></span>
<span class="normal"><a href="#__codelineno-0-2274">2274</a></span>
<span class="normal"><a href="#__codelineno-0-2275">2275</a></span>
<span class="normal"><a href="#__codelineno-0-2276">2276</a></span>
<span class="normal"><a href="#__codelineno-0-2277">2277</a></span>
<span class="normal"><a href="#__codelineno-0-2278">2278</a></span>
<span class="normal"><a href="#__codelineno-0-2279">2279</a></span>
<span class="normal"><a href="#__codelineno-0-2280">2280</a></span>
<span class="normal"><a href="#__codelineno-0-2281">2281</a></span>
<span class="normal"><a href="#__codelineno-0-2282">2282</a></span>
<span class="normal"><a href="#__codelineno-0-2283">2283</a></span>
<span class="normal"><a href="#__codelineno-0-2284">2284</a></span>
<span class="normal"><a href="#__codelineno-0-2285">2285</a></span>
<span class="normal"><a href="#__codelineno-0-2286">2286</a></span>
<span class="normal"><a href="#__codelineno-0-2287">2287</a></span>
<span class="normal"><a href="#__codelineno-0-2288">2288</a></span>
<span class="normal"><a href="#__codelineno-0-2289">2289</a></span>
<span class="normal"><a href="#__codelineno-0-2290">2290</a></span>
<span class="normal"><a href="#__codelineno-0-2291">2291</a></span>
<span class="normal"><a href="#__codelineno-0-2292">2292</a></span>
<span class="normal"><a href="#__codelineno-0-2293">2293</a></span>
<span class="normal"><a href="#__codelineno-0-2294">2294</a></span>
<span class="normal"><a href="#__codelineno-0-2295">2295</a></span>
<span class="normal"><a href="#__codelineno-0-2296">2296</a></span>
<span class="normal"><a href="#__codelineno-0-2297">2297</a></span>
<span class="normal"><a href="#__codelineno-0-2298">2298</a></span>
<span class="normal"><a href="#__codelineno-0-2299">2299</a></span>
<span class="normal"><a href="#__codelineno-0-2300">2300</a></span>
<span class="normal"><a href="#__codelineno-0-2301">2301</a></span>
<span class="normal"><a href="#__codelineno-0-2302">2302</a></span>
<span class="normal"><a href="#__codelineno-0-2303">2303</a></span>
<span class="normal"><a href="#__codelineno-0-2304">2304</a></span>
<span class="normal"><a href="#__codelineno-0-2305">2305</a></span>
<span class="normal"><a href="#__codelineno-0-2306">2306</a></span>
<span class="normal"><a href="#__codelineno-0-2307">2307</a></span>
<span class="normal"><a href="#__codelineno-0-2308">2308</a></span>
<span class="normal"><a href="#__codelineno-0-2309">2309</a></span>
<span class="normal"><a href="#__codelineno-0-2310">2310</a></span>
<span class="normal"><a href="#__codelineno-0-2311">2311</a></span>
<span class="normal"><a href="#__codelineno-0-2312">2312</a></span>
<span class="normal"><a href="#__codelineno-0-2313">2313</a></span>
<span class="normal"><a href="#__codelineno-0-2314">2314</a></span>
<span class="normal"><a href="#__codelineno-0-2315">2315</a></span>
<span class="normal"><a href="#__codelineno-0-2316">2316</a></span>
<span class="normal"><a href="#__codelineno-0-2317">2317</a></span>
<span class="normal"><a href="#__codelineno-0-2318">2318</a></span>
<span class="normal"><a href="#__codelineno-0-2319">2319</a></span>
<span class="normal"><a href="#__codelineno-0-2320">2320</a></span>
<span class="normal"><a href="#__codelineno-0-2321">2321</a></span>
<span class="normal"><a href="#__codelineno-0-2322">2322</a></span>
<span class="normal"><a href="#__codelineno-0-2323">2323</a></span>
<span class="normal"><a href="#__codelineno-0-2324">2324</a></span>
<span class="normal"><a href="#__codelineno-0-2325">2325</a></span>
<span class="normal"><a href="#__codelineno-0-2326">2326</a></span>
<span class="normal"><a href="#__codelineno-0-2327">2327</a></span>
<span class="normal"><a href="#__codelineno-0-2328">2328</a></span>
<span class="normal"><a href="#__codelineno-0-2329">2329</a></span>
<span class="normal"><a href="#__codelineno-0-2330">2330</a></span>
<span class="normal"><a href="#__codelineno-0-2331">2331</a></span>
<span class="normal"><a href="#__codelineno-0-2332">2332</a></span>
<span class="normal"><a href="#__codelineno-0-2333">2333</a></span>
<span class="normal"><a href="#__codelineno-0-2334">2334</a></span>
<span class="normal"><a href="#__codelineno-0-2335">2335</a></span>
<span class="normal"><a href="#__codelineno-0-2336">2336</a></span>
<span class="normal"><a href="#__codelineno-0-2337">2337</a></span>
<span class="normal"><a href="#__codelineno-0-2338">2338</a></span>
<span class="normal"><a href="#__codelineno-0-2339">2339</a></span>
<span class="normal"><a href="#__codelineno-0-2340">2340</a></span>
<span class="normal"><a href="#__codelineno-0-2341">2341</a></span>
<span class="normal"><a href="#__codelineno-0-2342">2342</a></span>
<span class="normal"><a href="#__codelineno-0-2343">2343</a></span>
<span class="normal"><a href="#__codelineno-0-2344">2344</a></span>
<span class="normal"><a href="#__codelineno-0-2345">2345</a></span>
<span class="normal"><a href="#__codelineno-0-2346">2346</a></span>
<span class="normal"><a href="#__codelineno-0-2347">2347</a></span>
<span class="normal"><a href="#__codelineno-0-2348">2348</a></span>
<span class="normal"><a href="#__codelineno-0-2349">2349</a></span>
<span class="normal"><a href="#__codelineno-0-2350">2350</a></span>
<span class="normal"><a href="#__codelineno-0-2351">2351</a></span>
<span class="normal"><a href="#__codelineno-0-2352">2352</a></span>
<span class="normal"><a href="#__codelineno-0-2353">2353</a></span>
<span class="normal"><a href="#__codelineno-0-2354">2354</a></span>
<span class="normal"><a href="#__codelineno-0-2355">2355</a></span>
<span class="normal"><a href="#__codelineno-0-2356">2356</a></span>
<span class="normal"><a href="#__codelineno-0-2357">2357</a></span>
<span class="normal"><a href="#__codelineno-0-2358">2358</a></span>
<span class="normal"><a href="#__codelineno-0-2359">2359</a></span>
<span class="normal"><a href="#__codelineno-0-2360">2360</a></span>
<span class="normal"><a href="#__codelineno-0-2361">2361</a></span>
<span class="normal"><a href="#__codelineno-0-2362">2362</a></span>
<span class="normal"><a href="#__codelineno-0-2363">2363</a></span>
<span class="normal"><a href="#__codelineno-0-2364">2364</a></span>
<span class="normal"><a href="#__codelineno-0-2365">2365</a></span>
<span class="normal"><a href="#__codelineno-0-2366">2366</a></span>
<span class="normal"><a href="#__codelineno-0-2367">2367</a></span>
<span class="normal"><a href="#__codelineno-0-2368">2368</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1352" name="__codelineno-0-1352"></a><span class="k">class</span><span class="w"> </span><span class="nc">MultiphaseCascade</span><span class="p">(</span><span class="n">Multiphase</span><span class="p">):</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a><span class="sd">    Cascaded LBM collision model transforms the distribution to central moments and then relaxation them. The central moments are obtained by first</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a><span class="sd">    transforming distributions to raw-moment using transformation matrix similar to MRT model. The raw-moments are subsequently transformed to central</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a><span class="sd">    moments using shift-matrix. CLBM gives independent control over vapor diffusivity, binary diffusivity and Schmidt number, which is not possible using SRT model.</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a><span class="sd">    The current implementation is based on:</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a><span class="sd">    1. Fei, L. &amp; Luo, K. H. Consistent forcing scheme in the cascaded lattice Boltzmann method. Phys. Rev. E 96, 053307 (2017).</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a><span class="sd">    2. Fei, L., Luo, K. H. &amp; Li, Q. Three-dimensional cascaded lattice Boltzmann method: Improved implementation and consistent forcing scheme. Phys. Rev. E 97, 053309 (2018).</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s_0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_0&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s_1</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_1&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s_b</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_b&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s_2</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_2&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s_3</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_3&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s_4</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_4&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">M_inv</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>            <span class="k">lambda</span> <span class="n">M</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>                <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>                <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">,</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>            <span class="p">),</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">),</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>        <span class="p">)</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>            <span class="k">lambda</span> <span class="n">M</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">),</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">),</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>        <span class="p">)</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD2Q9</span><span class="p">):</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>                <span class="k">lambda</span> <span class="n">s_0</span><span class="p">,</span> <span class="n">s_1</span><span class="p">,</span> <span class="n">s_b</span><span class="p">,</span> <span class="n">s_2</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_4</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="n">s_0</span><span class="p">,</span> <span class="n">s_1</span><span class="p">,</span> <span class="n">s_1</span><span class="p">,</span> <span class="n">s_b</span><span class="p">,</span> <span class="n">s_2</span><span class="p">,</span> <span class="n">s_2</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_4</span><span class="p">]),</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>                    <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">,</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>                <span class="p">),</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_0</span><span class="p">,</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_1</span><span class="p">,</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_b</span><span class="p">,</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_2</span><span class="p">,</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_3</span><span class="p">,</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_4</span><span class="p">,</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>            <span class="p">)</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q19</span><span class="p">):</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">s_plus</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s_b</span><span class="p">,</span> <span class="n">s_2</span><span class="p">:</span> <span class="p">(</span><span class="n">s_b</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">s_2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_2</span><span class="p">)</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">s_minus</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s_b</span><span class="p">,</span> <span class="n">s_2</span><span class="p">:</span> <span class="p">(</span><span class="n">s_b</span> <span class="o">-</span> <span class="n">s_2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_2</span><span class="p">)</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">s_0</span><span class="p">,</span> <span class="n">s_1</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_plus</span><span class="p">,</span> <span class="n">s_minus</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_4</span><span class="p">):</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>                <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="n">s_0</span><span class="p">,</span> <span class="n">s_1</span><span class="p">,</span> <span class="n">s_1</span><span class="p">,</span> <span class="n">s_1</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_plus</span><span class="p">,</span> <span class="n">s_plus</span><span class="p">,</span> <span class="n">s_plus</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_4</span><span class="p">,</span> <span class="n">s_4</span><span class="p">,</span> <span class="n">s_4</span><span class="p">])</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>                <span class="n">S</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_minus</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>                <span class="n">S</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_minus</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>                <span class="n">S</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_minus</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>                <span class="n">S</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_minus</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>                <span class="n">S</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_minus</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>                <span class="n">S</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_minus</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>                <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>                <span class="k">lambda</span> <span class="n">s_0</span><span class="p">,</span> <span class="n">s_1</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_plus</span><span class="p">,</span> <span class="n">s_minus</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_4</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">s_0</span><span class="p">,</span> <span class="n">s_1</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_plus</span><span class="p">,</span> <span class="n">s_minus</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_4</span><span class="p">),</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_0</span><span class="p">,</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_1</span><span class="p">,</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_2</span><span class="p">,</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_plus</span><span class="p">,</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_minus</span><span class="p">,</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_3</span><span class="p">,</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_4</span><span class="p">,</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>            <span class="p">)</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q27</span><span class="p">):</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">s_plus</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s_b</span><span class="p">,</span> <span class="n">s_2</span><span class="p">:</span> <span class="p">(</span><span class="n">s_b</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">s_2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_2</span><span class="p">)</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">s_minus</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s_b</span><span class="p">,</span> <span class="n">s_2</span><span class="p">:</span> <span class="p">(</span><span class="n">s_b</span> <span class="o">-</span> <span class="n">s_2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_2</span><span class="p">)</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">s_3b</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_3b&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">s_4b</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_4b&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">s_5</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">s_6</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s_6&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">s_0</span><span class="p">,</span> <span class="n">s_1</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_plus</span><span class="p">,</span> <span class="n">s_minus</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_3b</span><span class="p">,</span> <span class="n">s_4</span><span class="p">,</span> <span class="n">s_4b</span><span class="p">,</span> <span class="n">s_5</span><span class="p">,</span> <span class="n">s_6</span><span class="p">):</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>                <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>                    <span class="n">s_0</span><span class="p">,</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>                    <span class="n">s_1</span><span class="p">,</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>                    <span class="n">s_1</span><span class="p">,</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>                    <span class="n">s_1</span><span class="p">,</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>                    <span class="n">s_v</span><span class="p">,</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>                    <span class="n">s_v</span><span class="p">,</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>                    <span class="n">s_v</span><span class="p">,</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>                    <span class="n">s_plus</span><span class="p">,</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>                    <span class="n">s_plus</span><span class="p">,</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>                    <span class="n">s_plus</span><span class="p">,</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>                    <span class="n">s_3</span><span class="p">,</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>                    <span class="n">s_3</span><span class="p">,</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>                    <span class="n">s_3</span><span class="p">,</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>                    <span class="n">s_3</span><span class="p">,</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>                    <span class="n">s_3</span><span class="p">,</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>                    <span class="n">s_3</span><span class="p">,</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>                    <span class="n">s_3b</span><span class="p">,</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>                    <span class="n">s_4</span><span class="p">,</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>                    <span class="n">s_4</span><span class="p">,</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>                    <span class="n">s_4</span><span class="p">,</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>                    <span class="n">s_4b</span><span class="p">,</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>                    <span class="n">s_4b</span><span class="p">,</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>                    <span class="n">s_4b</span><span class="p">,</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>                    <span class="n">s_5</span><span class="p">,</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>                    <span class="n">s_5</span><span class="p">,</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>                    <span class="n">s_5</span><span class="p">,</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>                    <span class="n">s_6</span><span class="p">,</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>                <span class="p">])</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>                <span class="n">S</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_minus</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>                <span class="n">S</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_minus</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>                <span class="n">S</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_minus</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>                <span class="n">S</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_minus</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>                <span class="n">S</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_minus</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>                <span class="n">S</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_minus</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>                <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>                <span class="k">lambda</span> <span class="n">s_0</span><span class="p">,</span> <span class="n">s_1</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_plus</span><span class="p">,</span> <span class="n">s_minus</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_3b</span><span class="p">,</span> <span class="n">s_4</span><span class="p">,</span> <span class="n">s_4b</span><span class="p">,</span> <span class="n">s_5</span><span class="p">,</span> <span class="n">s_6</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>                    <span class="n">s_0</span><span class="p">,</span> <span class="n">s_1</span><span class="p">,</span> <span class="n">s_v</span><span class="p">,</span> <span class="n">s_plus</span><span class="p">,</span> <span class="n">s_minus</span><span class="p">,</span> <span class="n">s_3</span><span class="p">,</span> <span class="n">s_3b</span><span class="p">,</span> <span class="n">s_4</span><span class="p">,</span> <span class="n">s_4b</span><span class="p">,</span> <span class="n">s_5</span><span class="p">,</span> <span class="n">s_6</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>                <span class="p">),</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_0</span><span class="p">,</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_1</span><span class="p">,</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_2</span><span class="p">,</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_plus</span><span class="p">,</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_minus</span><span class="p">,</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_3</span><span class="p">,</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_3b</span><span class="p">,</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_4</span><span class="p">,</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_4b</span><span class="p">,</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_5</span><span class="p">,</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">s_6</span><span class="p">,</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>            <span class="p">)</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">omega</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omega</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>    <span class="nd">@omega</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">omega</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_omega</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">M</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_M</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>    <span class="nd">@M</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">M</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Matrix M must be a list&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">:</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of components does not match number of matrix M passed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_M</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_central_moment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">):</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD2Q9</span><span class="p">):</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">shift</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>                <span class="n">ux</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>                <span class="n">uy</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>                <span class="n">usq</span> <span class="o">=</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>                <span class="n">udiff</span> <span class="o">=</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">usq</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">udiff</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>                    <span class="o">-</span><span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>                    <span class="o">+</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>                    <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>                    <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>                <span class="p">)</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>                    <span class="o">-</span><span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>                    <span class="o">+</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>                    <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>                    <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>                <span class="p">)</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>                    <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>                    <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">usq</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>                    <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">udiff</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>                <span class="p">)</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>                <span class="k">return</span> <span class="n">T</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">shift</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span> <span class="n">m_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q19</span><span class="p">):</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">shift</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>                <span class="n">ux</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>                <span class="n">uy</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>                <span class="n">uz</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">((</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">((</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">((</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>                    <span class="o">-</span><span class="n">ux</span> <span class="o">*</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>                <span class="p">)</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>                    <span class="o">-</span><span class="n">ux</span> <span class="o">*</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>                <span class="p">)</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>                    <span class="o">-</span><span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>                <span class="p">)</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>                    <span class="o">-</span><span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>                <span class="p">)</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>                    <span class="o">-</span><span class="n">uy</span> <span class="o">*</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>                <span class="p">)</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>                    <span class="o">-</span><span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>                <span class="p">)</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>                    <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>                <span class="p">)</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>                    <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>                <span class="p">)</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>                    <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>                <span class="p">)</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>                <span class="k">return</span> <span class="n">T</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">shift</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span> <span class="n">m_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q27</span><span class="p">):</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">shift</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>                <span class="n">ux</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>                <span class="n">uy</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>                <span class="n">uz</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="p">)</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="p">)</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="p">)</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="p">)</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span><span class="p">)</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="p">)</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>                <span class="p">)</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>                <span class="p">)</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>                <span class="p">)</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>                <span class="p">)</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>                <span class="p">)</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>                <span class="p">)</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>                <span class="p">)</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>                <span class="p">)</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>                <span class="p">)</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>                <span class="p">)</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>                <span class="p">)</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>                <span class="p">)</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>                <span class="p">)</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">23</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">23</span><span class="p">]</span>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>                    <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>                <span class="p">)</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>                    <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>                <span class="p">)</span>
<a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span>
<a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1791" name="__codelineno-0-1791"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1792" name="__codelineno-0-1792"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1796" name="__codelineno-0-1796"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1797" name="__codelineno-0-1797"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1798" name="__codelineno-0-1798"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1799" name="__codelineno-0-1799"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1800" name="__codelineno-0-1800"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1801" name="__codelineno-0-1801"></a>                    <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1802" name="__codelineno-0-1802"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1803" name="__codelineno-0-1803"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1804" name="__codelineno-0-1804"></a>                    <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1805" name="__codelineno-0-1805"></a>                <span class="p">)</span>
<a id="__codelineno-0-1806" name="__codelineno-0-1806"></a>                <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">26</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1807" name="__codelineno-0-1807"></a>                    <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1808" name="__codelineno-0-1808"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1810" name="__codelineno-0-1810"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1811" name="__codelineno-0-1811"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1812" name="__codelineno-0-1812"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1813" name="__codelineno-0-1813"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1814" name="__codelineno-0-1814"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1815" name="__codelineno-0-1815"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1816" name="__codelineno-0-1816"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1817" name="__codelineno-0-1817"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1818" name="__codelineno-0-1818"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1819" name="__codelineno-0-1819"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1820" name="__codelineno-0-1820"></a>                    <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1821" name="__codelineno-0-1821"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1822" name="__codelineno-0-1822"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1823" name="__codelineno-0-1823"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1824" name="__codelineno-0-1824"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">23</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-1825" name="__codelineno-0-1825"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1826" name="__codelineno-0-1826"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1827" name="__codelineno-0-1827"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1829" name="__codelineno-0-1829"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1830" name="__codelineno-0-1830"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1831" name="__codelineno-0-1831"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1833" name="__codelineno-0-1833"></a>                    <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">26</span><span class="p">]</span>
<a id="__codelineno-0-1834" name="__codelineno-0-1834"></a>                <span class="p">)</span>
<a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>
<a id="__codelineno-0-1836" name="__codelineno-0-1836"></a>                <span class="k">return</span> <span class="n">T</span>
<a id="__codelineno-0-1837" name="__codelineno-0-1837"></a>
<a id="__codelineno-0-1838" name="__codelineno-0-1838"></a>            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">shift</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span> <span class="n">m_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-1839" name="__codelineno-0-1839"></a>
<a id="__codelineno-0-1840" name="__codelineno-0-1840"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-1841" name="__codelineno-0-1841"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_central_moment_inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">):</span>
<a id="__codelineno-0-1842" name="__codelineno-0-1842"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD2Q9</span><span class="p">):</span>
<a id="__codelineno-0-1843" name="__codelineno-0-1843"></a>
<a id="__codelineno-0-1844" name="__codelineno-0-1844"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">shift_inverse</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
<a id="__codelineno-0-1845" name="__codelineno-0-1845"></a>                <span class="n">ux</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1846" name="__codelineno-0-1846"></a>                <span class="n">uy</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1847" name="__codelineno-0-1847"></a>                <span class="n">usq</span> <span class="o">=</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1848" name="__codelineno-0-1848"></a>                <span class="n">udiff</span> <span class="o">=</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1849" name="__codelineno-0-1849"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<a id="__codelineno-0-1850" name="__codelineno-0-1850"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1851" name="__codelineno-0-1851"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-1852" name="__codelineno-0-1852"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-1853" name="__codelineno-0-1853"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">usq</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">udiff</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<a id="__codelineno-0-1855" name="__codelineno-0-1855"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<a id="__codelineno-0-1856" name="__codelineno-0-1856"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1857" name="__codelineno-0-1857"></a>                    <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1858" name="__codelineno-0-1858"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1859" name="__codelineno-0-1859"></a>                    <span class="o">+</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1860" name="__codelineno-0-1860"></a>                    <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>                    <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-0-1862" name="__codelineno-0-1862"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-1863" name="__codelineno-0-1863"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<a id="__codelineno-0-1864" name="__codelineno-0-1864"></a>                <span class="p">)</span>
<a id="__codelineno-0-1865" name="__codelineno-0-1865"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1866" name="__codelineno-0-1866"></a>                    <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>                    <span class="o">+</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1868" name="__codelineno-0-1868"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>                    <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1870" name="__codelineno-0-1870"></a>                    <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-0-1871" name="__codelineno-0-1871"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-1872" name="__codelineno-0-1872"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<a id="__codelineno-0-1873" name="__codelineno-0-1873"></a>                <span class="p">)</span>
<a id="__codelineno-0-1874" name="__codelineno-0-1874"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1875" name="__codelineno-0-1875"></a>                    <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1876" name="__codelineno-0-1876"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1877" name="__codelineno-0-1877"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1878" name="__codelineno-0-1878"></a>                    <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">usq</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1879" name="__codelineno-0-1879"></a>                    <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">udiff</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-0-1880" name="__codelineno-0-1880"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-1881" name="__codelineno-0-1881"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<a id="__codelineno-0-1882" name="__codelineno-0-1882"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<a id="__codelineno-0-1883" name="__codelineno-0-1883"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<a id="__codelineno-0-1884" name="__codelineno-0-1884"></a>                <span class="p">)</span>
<a id="__codelineno-0-1885" name="__codelineno-0-1885"></a>                <span class="k">return</span> <span class="n">m</span>
<a id="__codelineno-0-1886" name="__codelineno-0-1886"></a>
<a id="__codelineno-0-1887" name="__codelineno-0-1887"></a>            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">T</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">shift_inverse</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span> <span class="n">T_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-1888" name="__codelineno-0-1888"></a>
<a id="__codelineno-0-1889" name="__codelineno-0-1889"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q19</span><span class="p">):</span>
<a id="__codelineno-0-1890" name="__codelineno-0-1890"></a>
<a id="__codelineno-0-1891" name="__codelineno-0-1891"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">shift_inverse</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
<a id="__codelineno-0-1892" name="__codelineno-0-1892"></a>                <span class="n">ux</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1893" name="__codelineno-0-1893"></a>                <span class="n">uy</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1894" name="__codelineno-0-1894"></a>                <span class="n">uz</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1895" name="__codelineno-0-1895"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<a id="__codelineno-0-1896" name="__codelineno-0-1896"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1897" name="__codelineno-0-1897"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-1898" name="__codelineno-0-1898"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-1899" name="__codelineno-0-1899"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-0-1900" name="__codelineno-0-1900"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<a id="__codelineno-0-1901" name="__codelineno-0-1901"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<a id="__codelineno-0-1902" name="__codelineno-0-1902"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<a id="__codelineno-0-1903" name="__codelineno-0-1903"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">((</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<a id="__codelineno-0-1904" name="__codelineno-0-1904"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">((</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<a id="__codelineno-0-1905" name="__codelineno-0-1905"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">((</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
<a id="__codelineno-0-1906" name="__codelineno-0-1906"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1907" name="__codelineno-0-1907"></a>                    <span class="n">ux</span> <span class="o">*</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<a id="__codelineno-0-1908" name="__codelineno-0-1908"></a>                <span class="p">)</span>
<a id="__codelineno-0-1909" name="__codelineno-0-1909"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1910" name="__codelineno-0-1910"></a>                    <span class="n">ux</span> <span class="o">*</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
<a id="__codelineno-0-1911" name="__codelineno-0-1911"></a>                <span class="p">)</span>
<a id="__codelineno-0-1912" name="__codelineno-0-1912"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1913" name="__codelineno-0-1913"></a>                    <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
<a id="__codelineno-0-1914" name="__codelineno-0-1914"></a>                <span class="p">)</span>
<a id="__codelineno-0-1915" name="__codelineno-0-1915"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1916" name="__codelineno-0-1916"></a>                    <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>
<a id="__codelineno-0-1917" name="__codelineno-0-1917"></a>                <span class="p">)</span>
<a id="__codelineno-0-1918" name="__codelineno-0-1918"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1919" name="__codelineno-0-1919"></a>                    <span class="n">uy</span> <span class="o">*</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
<a id="__codelineno-0-1920" name="__codelineno-0-1920"></a>                <span class="p">)</span>
<a id="__codelineno-0-1921" name="__codelineno-0-1921"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1922" name="__codelineno-0-1922"></a>                    <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<a id="__codelineno-0-1923" name="__codelineno-0-1923"></a>                <span class="p">)</span>
<a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1925" name="__codelineno-0-1925"></a>                    <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1926" name="__codelineno-0-1926"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1927" name="__codelineno-0-1927"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-0-1929" name="__codelineno-0-1929"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<a id="__codelineno-0-1930" name="__codelineno-0-1930"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<a id="__codelineno-0-1931" name="__codelineno-0-1931"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<a id="__codelineno-0-1932" name="__codelineno-0-1932"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
<a id="__codelineno-0-1933" name="__codelineno-0-1933"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<a id="__codelineno-0-1934" name="__codelineno-0-1934"></a>                <span class="p">)</span>
<a id="__codelineno-0-1935" name="__codelineno-0-1935"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1936" name="__codelineno-0-1936"></a>                    <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1937" name="__codelineno-0-1937"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1938" name="__codelineno-0-1938"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1939" name="__codelineno-0-1939"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-1940" name="__codelineno-0-1940"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<a id="__codelineno-0-1941" name="__codelineno-0-1941"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<a id="__codelineno-0-1942" name="__codelineno-0-1942"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
<a id="__codelineno-0-1943" name="__codelineno-0-1943"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>
<a id="__codelineno-0-1944" name="__codelineno-0-1944"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span>
<a id="__codelineno-0-1945" name="__codelineno-0-1945"></a>                <span class="p">)</span>
<a id="__codelineno-0-1946" name="__codelineno-0-1946"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1947" name="__codelineno-0-1947"></a>                    <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1948" name="__codelineno-0-1948"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1949" name="__codelineno-0-1949"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1950" name="__codelineno-0-1950"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<a id="__codelineno-0-1951" name="__codelineno-0-1951"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<a id="__codelineno-0-1953" name="__codelineno-0-1953"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
<a id="__codelineno-0-1954" name="__codelineno-0-1954"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<a id="__codelineno-0-1955" name="__codelineno-0-1955"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>
<a id="__codelineno-0-1956" name="__codelineno-0-1956"></a>                <span class="p">)</span>
<a id="__codelineno-0-1957" name="__codelineno-0-1957"></a>                <span class="k">return</span> <span class="n">m</span>
<a id="__codelineno-0-1958" name="__codelineno-0-1958"></a>
<a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">T</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">shift_inverse</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span> <span class="n">T_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-1960" name="__codelineno-0-1960"></a>
<a id="__codelineno-0-1961" name="__codelineno-0-1961"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q27</span><span class="p">):</span>
<a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>
<a id="__codelineno-0-1963" name="__codelineno-0-1963"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">shift_inverse</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
<a id="__codelineno-0-1964" name="__codelineno-0-1964"></a>                <span class="n">ux</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1965" name="__codelineno-0-1965"></a>                <span class="n">uy</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1966" name="__codelineno-0-1966"></a>                <span class="n">uz</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1967" name="__codelineno-0-1967"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<a id="__codelineno-0-1968" name="__codelineno-0-1968"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1969" name="__codelineno-0-1969"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="p">)</span>
<a id="__codelineno-0-1970" name="__codelineno-0-1970"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="p">)</span>
<a id="__codelineno-0-1971" name="__codelineno-0-1971"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="p">)</span>
<a id="__codelineno-0-1972" name="__codelineno-0-1972"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="p">)</span>
<a id="__codelineno-0-1973" name="__codelineno-0-1973"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span><span class="p">)</span>
<a id="__codelineno-0-1974" name="__codelineno-0-1974"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="p">)</span>
<a id="__codelineno-0-1975" name="__codelineno-0-1975"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<a id="__codelineno-0-1976" name="__codelineno-0-1976"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<a id="__codelineno-0-1977" name="__codelineno-0-1977"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
<a id="__codelineno-0-1978" name="__codelineno-0-1978"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1980" name="__codelineno-0-1980"></a>                <span class="p">)</span>
<a id="__codelineno-0-1981" name="__codelineno-0-1981"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1982" name="__codelineno-0-1982"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1983" name="__codelineno-0-1983"></a>                <span class="p">)</span>
<a id="__codelineno-0-1984" name="__codelineno-0-1984"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1985" name="__codelineno-0-1985"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-1986" name="__codelineno-0-1986"></a>                <span class="p">)</span>
<a id="__codelineno-0-1987" name="__codelineno-0-1987"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1988" name="__codelineno-0-1988"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1989" name="__codelineno-0-1989"></a>                <span class="p">)</span>
<a id="__codelineno-0-1990" name="__codelineno-0-1990"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1991" name="__codelineno-0-1991"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1992" name="__codelineno-0-1992"></a>                <span class="p">)</span>
<a id="__codelineno-0-1993" name="__codelineno-0-1993"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1994" name="__codelineno-0-1994"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-1995" name="__codelineno-0-1995"></a>                <span class="p">)</span>
<a id="__codelineno-0-1996" name="__codelineno-0-1996"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-1997" name="__codelineno-0-1997"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<a id="__codelineno-0-1998" name="__codelineno-0-1998"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-1999" name="__codelineno-0-1999"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2000" name="__codelineno-0-2000"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2001" name="__codelineno-0-2001"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2002" name="__codelineno-0-2002"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2003" name="__codelineno-0-2003"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2004" name="__codelineno-0-2004"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2005" name="__codelineno-0-2005"></a>                <span class="p">)</span>
<a id="__codelineno-0-2006" name="__codelineno-0-2006"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-2007" name="__codelineno-0-2007"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2008" name="__codelineno-0-2008"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2009" name="__codelineno-0-2009"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2010" name="__codelineno-0-2010"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2011" name="__codelineno-0-2011"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2012" name="__codelineno-0-2012"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-2013" name="__codelineno-0-2013"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2014" name="__codelineno-0-2014"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2015" name="__codelineno-0-2015"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span>
<a id="__codelineno-0-2016" name="__codelineno-0-2016"></a>                <span class="p">)</span>
<a id="__codelineno-0-2017" name="__codelineno-0-2017"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-2018" name="__codelineno-0-2018"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2019" name="__codelineno-0-2019"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2020" name="__codelineno-0-2020"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2021" name="__codelineno-0-2021"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2022" name="__codelineno-0-2022"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2023" name="__codelineno-0-2023"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2025" name="__codelineno-0-2025"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2026" name="__codelineno-0-2026"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>
<a id="__codelineno-0-2027" name="__codelineno-0-2027"></a>                <span class="p">)</span>
<a id="__codelineno-0-2028" name="__codelineno-0-2028"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2030" name="__codelineno-0-2030"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2031" name="__codelineno-0-2031"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2032" name="__codelineno-0-2032"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2033" name="__codelineno-0-2033"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2034" name="__codelineno-0-2034"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2035" name="__codelineno-0-2035"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2036" name="__codelineno-0-2036"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2037" name="__codelineno-0-2037"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span>
<a id="__codelineno-0-2038" name="__codelineno-0-2038"></a>                <span class="p">)</span>
<a id="__codelineno-0-2039" name="__codelineno-0-2039"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-2040" name="__codelineno-0-2040"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<a id="__codelineno-0-2041" name="__codelineno-0-2041"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-2042" name="__codelineno-0-2042"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2043" name="__codelineno-0-2043"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2044" name="__codelineno-0-2044"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2045" name="__codelineno-0-2045"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2046" name="__codelineno-0-2046"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2047" name="__codelineno-0-2047"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2048" name="__codelineno-0-2048"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2049" name="__codelineno-0-2049"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2050" name="__codelineno-0-2050"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2051" name="__codelineno-0-2051"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2052" name="__codelineno-0-2052"></a>                <span class="p">)</span>
<a id="__codelineno-0-2053" name="__codelineno-0-2053"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-2054" name="__codelineno-0-2054"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span>
<a id="__codelineno-0-2055" name="__codelineno-0-2055"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-2056" name="__codelineno-0-2056"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2057" name="__codelineno-0-2057"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2058" name="__codelineno-0-2058"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2059" name="__codelineno-0-2059"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2060" name="__codelineno-0-2060"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2061" name="__codelineno-0-2061"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2062" name="__codelineno-0-2062"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2063" name="__codelineno-0-2063"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2064" name="__codelineno-0-2064"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2065" name="__codelineno-0-2065"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2066" name="__codelineno-0-2066"></a>                <span class="p">)</span>
<a id="__codelineno-0-2067" name="__codelineno-0-2067"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-2068" name="__codelineno-0-2068"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span>
<a id="__codelineno-0-2069" name="__codelineno-0-2069"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-2070" name="__codelineno-0-2070"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2071" name="__codelineno-0-2071"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2072" name="__codelineno-0-2072"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2073" name="__codelineno-0-2073"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2074" name="__codelineno-0-2074"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2075" name="__codelineno-0-2075"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2076" name="__codelineno-0-2076"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2077" name="__codelineno-0-2077"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2078" name="__codelineno-0-2078"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2079" name="__codelineno-0-2079"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2080" name="__codelineno-0-2080"></a>                <span class="p">)</span>
<a id="__codelineno-0-2081" name="__codelineno-0-2081"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">23</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-2082" name="__codelineno-0-2082"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">23</span><span class="p">]</span>
<a id="__codelineno-0-2083" name="__codelineno-0-2083"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-2084" name="__codelineno-0-2084"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2085" name="__codelineno-0-2085"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2086" name="__codelineno-0-2086"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2087" name="__codelineno-0-2087"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2088" name="__codelineno-0-2088"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2089" name="__codelineno-0-2089"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2090" name="__codelineno-0-2090"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2091" name="__codelineno-0-2091"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2092" name="__codelineno-0-2092"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2093" name="__codelineno-0-2093"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2094" name="__codelineno-0-2094"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2095" name="__codelineno-0-2095"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2096" name="__codelineno-0-2096"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2097" name="__codelineno-0-2097"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2098" name="__codelineno-0-2098"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2099" name="__codelineno-0-2099"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2100" name="__codelineno-0-2100"></a>                <span class="p">)</span>
<a id="__codelineno-0-2101" name="__codelineno-0-2101"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-2102" name="__codelineno-0-2102"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
<a id="__codelineno-0-2103" name="__codelineno-0-2103"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-2104" name="__codelineno-0-2104"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2105" name="__codelineno-0-2105"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2106" name="__codelineno-0-2106"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2107" name="__codelineno-0-2107"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2108" name="__codelineno-0-2108"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2109" name="__codelineno-0-2109"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2110" name="__codelineno-0-2110"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2111" name="__codelineno-0-2111"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2112" name="__codelineno-0-2112"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2113" name="__codelineno-0-2113"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2114" name="__codelineno-0-2114"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2115" name="__codelineno-0-2115"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2116" name="__codelineno-0-2116"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2117" name="__codelineno-0-2117"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2118" name="__codelineno-0-2118"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2119" name="__codelineno-0-2119"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2120" name="__codelineno-0-2120"></a>                <span class="p">)</span>
<a id="__codelineno-0-2121" name="__codelineno-0-2121"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-2122" name="__codelineno-0-2122"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span>
<a id="__codelineno-0-2123" name="__codelineno-0-2123"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-2124" name="__codelineno-0-2124"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2125" name="__codelineno-0-2125"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2126" name="__codelineno-0-2126"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2127" name="__codelineno-0-2127"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2128" name="__codelineno-0-2128"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2129" name="__codelineno-0-2129"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2130" name="__codelineno-0-2130"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2131" name="__codelineno-0-2131"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2132" name="__codelineno-0-2132"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2133" name="__codelineno-0-2133"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2134" name="__codelineno-0-2134"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2135" name="__codelineno-0-2135"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2136" name="__codelineno-0-2136"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2137" name="__codelineno-0-2137"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2138" name="__codelineno-0-2138"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2139" name="__codelineno-0-2139"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2140" name="__codelineno-0-2140"></a>                <span class="p">)</span>
<a id="__codelineno-0-2141" name="__codelineno-0-2141"></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">26</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a id="__codelineno-0-2142" name="__codelineno-0-2142"></a>                    <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2143" name="__codelineno-0-2143"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2144" name="__codelineno-0-2144"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2145" name="__codelineno-0-2145"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2146" name="__codelineno-0-2146"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2147" name="__codelineno-0-2147"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2148" name="__codelineno-0-2148"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2149" name="__codelineno-0-2149"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2150" name="__codelineno-0-2150"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2151" name="__codelineno-0-2151"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2152" name="__codelineno-0-2152"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2153" name="__codelineno-0-2153"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2154" name="__codelineno-0-2154"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2155" name="__codelineno-0-2155"></a>                    <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2156" name="__codelineno-0-2156"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2157" name="__codelineno-0-2157"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2158" name="__codelineno-0-2158"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2159" name="__codelineno-0-2159"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">23</span><span class="p">]</span> <span class="o">*</span> <span class="n">ux</span>
<a id="__codelineno-0-2160" name="__codelineno-0-2160"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2161" name="__codelineno-0-2161"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2162" name="__codelineno-0-2162"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2163" name="__codelineno-0-2163"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2164" name="__codelineno-0-2164"></a>                    <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2165" name="__codelineno-0-2165"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span> <span class="o">*</span> <span class="n">uy</span>
<a id="__codelineno-0-2166" name="__codelineno-0-2166"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-2167" name="__codelineno-0-2167"></a>                    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span> <span class="o">*</span> <span class="n">uz</span>
<a id="__codelineno-0-2168" name="__codelineno-0-2168"></a>                    <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">26</span><span class="p">]</span>
<a id="__codelineno-0-2169" name="__codelineno-0-2169"></a>                <span class="p">)</span>
<a id="__codelineno-0-2170" name="__codelineno-0-2170"></a>                <span class="k">return</span> <span class="n">m</span>
<a id="__codelineno-0-2171" name="__codelineno-0-2171"></a>
<a id="__codelineno-0-2172" name="__codelineno-0-2172"></a>            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">T</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">shift_inverse</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span> <span class="n">T_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-2173" name="__codelineno-0-2173"></a>
<a id="__codelineno-0-2174" name="__codelineno-0-2174"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-2175" name="__codelineno-0-2175"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_eq_central_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">):</span>
<a id="__codelineno-0-2176" name="__codelineno-0-2176"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2177" name="__codelineno-0-2177"></a><span class="sd">        Calculate the central moments of the equilibrium distribution.</span>
<a id="__codelineno-0-2178" name="__codelineno-0-2178"></a>
<a id="__codelineno-0-2179" name="__codelineno-0-2179"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-2180" name="__codelineno-0-2180"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-2181" name="__codelineno-0-2181"></a><span class="sd">        rho_tree (pytree of jax.numpy.ndarray): Density field for all components.</span>
<a id="__codelineno-0-2182" name="__codelineno-0-2182"></a>
<a id="__codelineno-0-2183" name="__codelineno-0-2183"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-2184" name="__codelineno-0-2184"></a><span class="sd">        -------</span>
<a id="__codelineno-0-2185" name="__codelineno-0-2185"></a><span class="sd">        T_eq_tree (pytree of jax.numpy.ndarray): Central moments of the equilibrium distribution.</span>
<a id="__codelineno-0-2186" name="__codelineno-0-2186"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-2187" name="__codelineno-0-2187"></a>
<a id="__codelineno-0-2188" name="__codelineno-0-2188"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">rho</span><span class="p">):</span>
<a id="__codelineno-0-2189" name="__codelineno-0-2189"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD2Q9</span><span class="p">):</span>
<a id="__codelineno-0-2190" name="__codelineno-0-2190"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-2191" name="__codelineno-0-2191"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-2192" name="__codelineno-0-2192"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2193" name="__codelineno-0-2193"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2194" name="__codelineno-0-2194"></a>
<a id="__codelineno-0-2195" name="__codelineno-0-2195"></a>                <span class="k">return</span> <span class="n">T_eq</span>
<a id="__codelineno-0-2196" name="__codelineno-0-2196"></a>
<a id="__codelineno-0-2197" name="__codelineno-0-2197"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q19</span><span class="p">):</span>
<a id="__codelineno-0-2198" name="__codelineno-0-2198"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-2199" name="__codelineno-0-2199"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-2200" name="__codelineno-0-2200"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2201" name="__codelineno-0-2201"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2202" name="__codelineno-0-2202"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2203" name="__codelineno-0-2203"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2204" name="__codelineno-0-2204"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2205" name="__codelineno-0-2205"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2206" name="__codelineno-0-2206"></a>
<a id="__codelineno-0-2207" name="__codelineno-0-2207"></a>                <span class="k">return</span> <span class="n">T_eq</span>
<a id="__codelineno-0-2208" name="__codelineno-0-2208"></a>
<a id="__codelineno-0-2209" name="__codelineno-0-2209"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q27</span><span class="p">):</span>
<a id="__codelineno-0-2210" name="__codelineno-0-2210"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-2211" name="__codelineno-0-2211"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-2212" name="__codelineno-0-2212"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2213" name="__codelineno-0-2213"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2214" name="__codelineno-0-2214"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2215" name="__codelineno-0-2215"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2216" name="__codelineno-0-2216"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2217" name="__codelineno-0-2217"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2218" name="__codelineno-0-2218"></a>                <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">26</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
<a id="__codelineno-0-2219" name="__codelineno-0-2219"></a>
<a id="__codelineno-0-2220" name="__codelineno-0-2220"></a>                <span class="k">return</span> <span class="n">T_eq</span>
<a id="__codelineno-0-2221" name="__codelineno-0-2221"></a>
<a id="__codelineno-0-2222" name="__codelineno-0-2222"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-2223" name="__codelineno-0-2223"></a>
<a id="__codelineno-0-2224" name="__codelineno-0-2224"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-2225" name="__codelineno-0-2225"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_force_central_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F_tree</span><span class="p">,</span> <span class="n">psi_tree</span><span class="p">):</span>
<a id="__codelineno-0-2226" name="__codelineno-0-2226"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2227" name="__codelineno-0-2227"></a><span class="sd">        Calculate the central moments of the force distribution. Includes modification to accurately replicate mechanical stability conditions.</span>
<a id="__codelineno-0-2228" name="__codelineno-0-2228"></a>
<a id="__codelineno-0-2229" name="__codelineno-0-2229"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-2230" name="__codelineno-0-2230"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-2231" name="__codelineno-0-2231"></a><span class="sd">        F_tree (pytree of jax.numpy.ndarray): Force field.</span>
<a id="__codelineno-0-2232" name="__codelineno-0-2232"></a>
<a id="__codelineno-0-2233" name="__codelineno-0-2233"></a><span class="sd">        psi_tree (pytree of jax.numpy.ndarray): Potential field.</span>
<a id="__codelineno-0-2234" name="__codelineno-0-2234"></a>
<a id="__codelineno-0-2235" name="__codelineno-0-2235"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-2236" name="__codelineno-0-2236"></a><span class="sd">        -------</span>
<a id="__codelineno-0-2237" name="__codelineno-0-2237"></a><span class="sd">        T_eq_tree (pytree of jax.numpy.ndarray): Central moments of the force distribution.</span>
<a id="__codelineno-0-2238" name="__codelineno-0-2238"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-2239" name="__codelineno-0-2239"></a>
<a id="__codelineno-0-2240" name="__codelineno-0-2240"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">s_b</span><span class="p">):</span>
<a id="__codelineno-0-2241" name="__codelineno-0-2241"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD2Q9</span><span class="p">):</span>
<a id="__codelineno-0-2242" name="__codelineno-0-2242"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-2243" name="__codelineno-0-2243"></a>                <span class="n">Fx</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2244" name="__codelineno-0-2244"></a>                <span class="n">Fy</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-2245" name="__codelineno-0-2245"></a>                <span class="n">eta</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">Fx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Fy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">s_b</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span>  <span class="c1"># For mechanical stability</span>
<a id="__codelineno-0-2246" name="__codelineno-0-2246"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span><span class="p">)</span>
<a id="__codelineno-0-2247" name="__codelineno-0-2247"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span><span class="p">)</span>
<a id="__codelineno-0-2248" name="__codelineno-0-2248"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
<a id="__codelineno-0-2249" name="__codelineno-0-2249"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2250" name="__codelineno-0-2250"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2251" name="__codelineno-0-2251"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2252" name="__codelineno-0-2252"></a>
<a id="__codelineno-0-2253" name="__codelineno-0-2253"></a>                <span class="k">return</span> <span class="n">C</span>
<a id="__codelineno-0-2254" name="__codelineno-0-2254"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q19</span><span class="p">):</span>
<a id="__codelineno-0-2255" name="__codelineno-0-2255"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-2256" name="__codelineno-0-2256"></a>                <span class="n">Fx</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2257" name="__codelineno-0-2257"></a>                <span class="n">Fy</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-2258" name="__codelineno-0-2258"></a>                <span class="n">Fz</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-2259" name="__codelineno-0-2259"></a>                <span class="n">eta</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">Fx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Fy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Fz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">s_b</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span>
<a id="__codelineno-0-2260" name="__codelineno-0-2260"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span><span class="p">)</span>
<a id="__codelineno-0-2261" name="__codelineno-0-2261"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span><span class="p">)</span>
<a id="__codelineno-0-2262" name="__codelineno-0-2262"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fz</span><span class="p">)</span>
<a id="__codelineno-0-2263" name="__codelineno-0-2263"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
<a id="__codelineno-0-2264" name="__codelineno-0-2264"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
<a id="__codelineno-0-2265" name="__codelineno-0-2265"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
<a id="__codelineno-0-2266" name="__codelineno-0-2266"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2267" name="__codelineno-0-2267"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2268" name="__codelineno-0-2268"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2269" name="__codelineno-0-2269"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2270" name="__codelineno-0-2270"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2271" name="__codelineno-0-2271"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2272" name="__codelineno-0-2272"></a>
<a id="__codelineno-0-2273" name="__codelineno-0-2273"></a>                <span class="k">return</span> <span class="n">C</span>
<a id="__codelineno-0-2274" name="__codelineno-0-2274"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q27</span><span class="p">):</span>
<a id="__codelineno-0-2275" name="__codelineno-0-2275"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-2276" name="__codelineno-0-2276"></a>                <span class="n">Fx</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2277" name="__codelineno-0-2277"></a>                <span class="n">Fy</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-2278" name="__codelineno-0-2278"></a>                <span class="n">Fz</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-2279" name="__codelineno-0-2279"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span><span class="p">)</span>
<a id="__codelineno-0-2280" name="__codelineno-0-2280"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span><span class="p">)</span>
<a id="__codelineno-0-2281" name="__codelineno-0-2281"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fz</span><span class="p">)</span>
<a id="__codelineno-0-2282" name="__codelineno-0-2282"></a>                <span class="n">eta</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">Fx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Fy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Fz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">s_b</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span>
<a id="__codelineno-0-2283" name="__codelineno-0-2283"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
<a id="__codelineno-0-2284" name="__codelineno-0-2284"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
<a id="__codelineno-0-2285" name="__codelineno-0-2285"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
<a id="__codelineno-0-2286" name="__codelineno-0-2286"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2287" name="__codelineno-0-2287"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2288" name="__codelineno-0-2288"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2289" name="__codelineno-0-2289"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2290" name="__codelineno-0-2290"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2291" name="__codelineno-0-2291"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2292" name="__codelineno-0-2292"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">23</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2293" name="__codelineno-0-2293"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2294" name="__codelineno-0-2294"></a>                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2295" name="__codelineno-0-2295"></a>
<a id="__codelineno-0-2296" name="__codelineno-0-2296"></a>                <span class="k">return</span> <span class="n">C</span>
<a id="__codelineno-0-2297" name="__codelineno-0-2297"></a>
<a id="__codelineno-0-2298" name="__codelineno-0-2298"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">F</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">s_b</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">s_b</span><span class="p">),</span> <span class="n">F_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span> <span class="n">psi_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_b</span><span class="p">)</span>
<a id="__codelineno-0-2299" name="__codelineno-0-2299"></a>
<a id="__codelineno-0-2300" name="__codelineno-0-2300"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-2301" name="__codelineno-0-2301"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tdash_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">):</span>
<a id="__codelineno-0-2302" name="__codelineno-0-2302"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2303" name="__codelineno-0-2303"></a><span class="sd">        Modified version of the apply_force defined in LBMBase to account for modified force.</span>
<a id="__codelineno-0-2304" name="__codelineno-0-2304"></a>
<a id="__codelineno-0-2305" name="__codelineno-0-2305"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-2306" name="__codelineno-0-2306"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-2307" name="__codelineno-0-2307"></a><span class="sd">        Tdash_tree (pytree of jax.numpy.ndarray): Central moments of post-collision distribution functions.</span>
<a id="__codelineno-0-2308" name="__codelineno-0-2308"></a>
<a id="__codelineno-0-2309" name="__codelineno-0-2309"></a><span class="sd">        rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-2310" name="__codelineno-0-2310"></a>
<a id="__codelineno-0-2311" name="__codelineno-0-2311"></a><span class="sd">        u_tree (pytree of jax.numpy.ndarray): Velocity field.</span>
<a id="__codelineno-0-2312" name="__codelineno-0-2312"></a>
<a id="__codelineno-0-2313" name="__codelineno-0-2313"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-2314" name="__codelineno-0-2314"></a><span class="sd">        -------</span>
<a id="__codelineno-0-2315" name="__codelineno-0-2315"></a><span class="sd">        f_postcollision_tree (pytree of jax.numpy.ndarray): The post-collision distribution functions with the force applied.</span>
<a id="__codelineno-0-2316" name="__codelineno-0-2316"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-2317" name="__codelineno-0-2317"></a>        <span class="n">F_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_force</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-2318" name="__codelineno-0-2318"></a>        <span class="n">psi_tree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_potential</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-2319" name="__codelineno-0-2319"></a>        <span class="n">C_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_force_central_moments</span><span class="p">(</span><span class="n">F_tree</span><span class="p">,</span> <span class="n">psi_tree</span><span class="p">)</span>
<a id="__codelineno-0-2320" name="__codelineno-0-2320"></a>        <span class="n">Tf_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">S</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">C_tree</span><span class="p">)</span>
<a id="__codelineno-0-2321" name="__codelineno-0-2321"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">Tdash</span><span class="p">,</span> <span class="n">Tf</span><span class="p">:</span> <span class="n">Tdash</span> <span class="o">+</span> <span class="n">Tf</span><span class="p">,</span> <span class="n">Tdash_tree</span><span class="p">,</span> <span class="n">Tf_tree</span><span class="p">)</span>
<a id="__codelineno-0-2322" name="__codelineno-0-2322"></a>
<a id="__codelineno-0-2323" name="__codelineno-0-2323"></a>    <span class="c1"># @partial(jit, static_argnums=(0,), donate_argnums=(1,))</span>
<a id="__codelineno-0-2324" name="__codelineno-0-2324"></a>    <span class="c1"># def collision(self, fin_tree):</span>
<a id="__codelineno-0-2325" name="__codelineno-0-2325"></a>    <span class="c1">#     &quot;&quot;&quot;</span>
<a id="__codelineno-0-2326" name="__codelineno-0-2326"></a>    <span class="c1">#     Cascaded LBM collision step for lattice.</span>
<a id="__codelineno-0-2327" name="__codelineno-0-2327"></a>    <span class="c1">#     &quot;&quot;&quot;</span>
<a id="__codelineno-0-2328" name="__codelineno-0-2328"></a>    <span class="c1">#     fin_tree = map(lambda f: self.precisionPolicy.cast_to_compute(f), fin_tree)</span>
<a id="__codelineno-0-2329" name="__codelineno-0-2329"></a>    <span class="c1">#     rho_tree, u_tree = self.update_macroscopic(fin_tree)</span>
<a id="__codelineno-0-2330" name="__codelineno-0-2330"></a>    <span class="c1">#     T_tree = map(lambda f, M: jnp.dot(f, M), fin_tree, self.M)</span>
<a id="__codelineno-0-2331" name="__codelineno-0-2331"></a>    <span class="c1">#     N_tree = self.compute_shift_matrix(u_tree)</span>
<a id="__codelineno-0-2332" name="__codelineno-0-2332"></a>    <span class="c1">#     Tdash_tree = self.compute_central_moment(T_tree, N_tree)</span>
<a id="__codelineno-0-2333" name="__codelineno-0-2333"></a>    <span class="c1">#     Tdash_eq_tree = self.compute_eq_central_moments(rho_tree)</span>
<a id="__codelineno-0-2334" name="__codelineno-0-2334"></a>    <span class="c1">#     Tout_tree = map(</span>
<a id="__codelineno-0-2335" name="__codelineno-0-2335"></a>    <span class="c1">#         lambda Tdash, Tdash_eq, S: -jnp.dot(Tdash - Tdash_eq, S),</span>
<a id="__codelineno-0-2336" name="__codelineno-0-2336"></a>    <span class="c1">#         Tdash_tree,</span>
<a id="__codelineno-0-2337" name="__codelineno-0-2337"></a>    <span class="c1">#         Tdash_eq_tree,</span>
<a id="__codelineno-0-2338" name="__codelineno-0-2338"></a>    <span class="c1">#         self.S,</span>
<a id="__codelineno-0-2339" name="__codelineno-0-2339"></a>    <span class="c1">#     )</span>
<a id="__codelineno-0-2340" name="__codelineno-0-2340"></a>    <span class="c1">#     Tout_tree = self.apply_force(Tout_tree, Tdash_eq_tree, rho_tree, u_tree)</span>
<a id="__codelineno-0-2341" name="__codelineno-0-2341"></a>    <span class="c1">#     Ninv_tree = self.compute_shift_matrix_inverse(u_tree)</span>
<a id="__codelineno-0-2342" name="__codelineno-0-2342"></a>    <span class="c1">#     Tout_tree = self.compute_central_moment(Tout_tree, Ninv_tree)</span>
<a id="__codelineno-0-2343" name="__codelineno-0-2343"></a>    <span class="c1">#     fout_tree = map(</span>
<a id="__codelineno-0-2344" name="__codelineno-0-2344"></a>    <span class="c1">#         lambda fin, T, Minv: fin + jnp.dot(T, Minv), fin_tree, Tout_tree, self.M_inv</span>
<a id="__codelineno-0-2345" name="__codelineno-0-2345"></a>    <span class="c1">#     )</span>
<a id="__codelineno-0-2346" name="__codelineno-0-2346"></a>    <span class="c1">#     return map(</span>
<a id="__codelineno-0-2347" name="__codelineno-0-2347"></a>    <span class="c1">#         lambda fout: self.precisionPolicy.cast_to_output(fout),</span>
<a id="__codelineno-0-2348" name="__codelineno-0-2348"></a>    <span class="c1">#         fout_tree,</span>
<a id="__codelineno-0-2349" name="__codelineno-0-2349"></a>    <span class="c1">#     )</span>
<a id="__codelineno-0-2350" name="__codelineno-0-2350"></a>
<a id="__codelineno-0-2351" name="__codelineno-0-2351"></a>    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<a id="__codelineno-0-2352" name="__codelineno-0-2352"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">):</span>
<a id="__codelineno-0-2353" name="__codelineno-0-2353"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2354" name="__codelineno-0-2354"></a><span class="sd">        Cascaded LBM collision step for lattice.</span>
<a id="__codelineno-0-2355" name="__codelineno-0-2355"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-2356" name="__codelineno-0-2356"></a>        <span class="n">fin_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_compute</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">fin_tree</span><span class="p">)</span>
<a id="__codelineno-0-2357" name="__codelineno-0-2357"></a>        <span class="n">rho_tree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_macroscopic</span><span class="p">(</span><span class="n">fin_tree</span><span class="p">)</span>
<a id="__codelineno-0-2358" name="__codelineno-0-2358"></a>        <span class="n">u_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macroscopic_velocity</span><span class="p">(</span><span class="n">fin_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-2359" name="__codelineno-0-2359"></a>        <span class="n">T_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="n">M</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="n">fin_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
<a id="__codelineno-0-2360" name="__codelineno-0-2360"></a>        <span class="n">Tdash_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_central_moment</span><span class="p">(</span><span class="n">T_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-2361" name="__codelineno-0-2361"></a>        <span class="n">Tdash_eq_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eq_central_moments</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-2362" name="__codelineno-0-2362"></a>        <span class="n">Tout_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-2363" name="__codelineno-0-2363"></a>            <span class="k">lambda</span> <span class="n">Tdash</span><span class="p">,</span> <span class="n">Tdash_eq</span><span class="p">,</span> <span class="n">S</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Tdash</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">S</span><span class="p">)</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Tdash_eq</span><span class="p">,</span> <span class="n">S</span><span class="p">),</span> <span class="n">Tdash_tree</span><span class="p">,</span> <span class="n">Tdash_eq_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span>
<a id="__codelineno-0-2364" name="__codelineno-0-2364"></a>        <span class="p">)</span>
<a id="__codelineno-0-2365" name="__codelineno-0-2365"></a>        <span class="n">Tout_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_force</span><span class="p">(</span><span class="n">Tout_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-2366" name="__codelineno-0-2366"></a>        <span class="n">Tout_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_central_moment_inverse</span><span class="p">(</span><span class="n">Tout_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-2367" name="__codelineno-0-2367"></a>        <span class="n">fout_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">T</span><span class="p">,</span> <span class="n">Minv</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">Minv</span><span class="p">),</span> <span class="n">Tout_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_inv</span><span class="p">)</span>
<a id="__codelineno-0-2368" name="__codelineno-0-2368"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fout</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_output</span><span class="p">(</span><span class="n">fout</span><span class="p">),</span> <span class="n">fout_tree</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="src.multiphase.MultiphaseCascade.apply_force" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">apply_force</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">apply_force</span><span class="p">(</span><span class="n">Tdash_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Modified version of the apply_force defined in LBMBase to account for modified force.</p>
<h4 id="src.multiphase.MultiphaseCascade.apply_force--parameters">Parameters</h4>
<p>Tdash_tree (pytree of jax.numpy.ndarray): Central moments of post-collision distribution functions.</p>
<p>rho_tree (pytree of jax.numpy.ndarray): Density field.</p>
<p>u_tree (pytree of jax.numpy.ndarray): Velocity field.</p>
<h4 id="src.multiphase.MultiphaseCascade.apply_force--returns">Returns</h4>
<p>f_postcollision_tree (pytree of jax.numpy.ndarray): The post-collision distribution functions with the force applied.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2300">2300</a></span>
<span class="normal"><a href="#__codelineno-0-2301">2301</a></span>
<span class="normal"><a href="#__codelineno-0-2302">2302</a></span>
<span class="normal"><a href="#__codelineno-0-2303">2303</a></span>
<span class="normal"><a href="#__codelineno-0-2304">2304</a></span>
<span class="normal"><a href="#__codelineno-0-2305">2305</a></span>
<span class="normal"><a href="#__codelineno-0-2306">2306</a></span>
<span class="normal"><a href="#__codelineno-0-2307">2307</a></span>
<span class="normal"><a href="#__codelineno-0-2308">2308</a></span>
<span class="normal"><a href="#__codelineno-0-2309">2309</a></span>
<span class="normal"><a href="#__codelineno-0-2310">2310</a></span>
<span class="normal"><a href="#__codelineno-0-2311">2311</a></span>
<span class="normal"><a href="#__codelineno-0-2312">2312</a></span>
<span class="normal"><a href="#__codelineno-0-2313">2313</a></span>
<span class="normal"><a href="#__codelineno-0-2314">2314</a></span>
<span class="normal"><a href="#__codelineno-0-2315">2315</a></span>
<span class="normal"><a href="#__codelineno-0-2316">2316</a></span>
<span class="normal"><a href="#__codelineno-0-2317">2317</a></span>
<span class="normal"><a href="#__codelineno-0-2318">2318</a></span>
<span class="normal"><a href="#__codelineno-0-2319">2319</a></span>
<span class="normal"><a href="#__codelineno-0-2320">2320</a></span>
<span class="normal"><a href="#__codelineno-0-2321">2321</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-2300" name="__codelineno-0-2300"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-2301" name="__codelineno-0-2301"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tdash_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">):</span>
<a id="__codelineno-0-2302" name="__codelineno-0-2302"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2303" name="__codelineno-0-2303"></a><span class="sd">    Modified version of the apply_force defined in LBMBase to account for modified force.</span>
<a id="__codelineno-0-2304" name="__codelineno-0-2304"></a>
<a id="__codelineno-0-2305" name="__codelineno-0-2305"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-2306" name="__codelineno-0-2306"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-2307" name="__codelineno-0-2307"></a><span class="sd">    Tdash_tree (pytree of jax.numpy.ndarray): Central moments of post-collision distribution functions.</span>
<a id="__codelineno-0-2308" name="__codelineno-0-2308"></a>
<a id="__codelineno-0-2309" name="__codelineno-0-2309"></a><span class="sd">    rho_tree (pytree of jax.numpy.ndarray): Density field.</span>
<a id="__codelineno-0-2310" name="__codelineno-0-2310"></a>
<a id="__codelineno-0-2311" name="__codelineno-0-2311"></a><span class="sd">    u_tree (pytree of jax.numpy.ndarray): Velocity field.</span>
<a id="__codelineno-0-2312" name="__codelineno-0-2312"></a>
<a id="__codelineno-0-2313" name="__codelineno-0-2313"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-2314" name="__codelineno-0-2314"></a><span class="sd">    -------</span>
<a id="__codelineno-0-2315" name="__codelineno-0-2315"></a><span class="sd">    f_postcollision_tree (pytree of jax.numpy.ndarray): The post-collision distribution functions with the force applied.</span>
<a id="__codelineno-0-2316" name="__codelineno-0-2316"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2317" name="__codelineno-0-2317"></a>    <span class="n">F_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_force</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-2318" name="__codelineno-0-2318"></a>    <span class="n">psi_tree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_potential</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-2319" name="__codelineno-0-2319"></a>    <span class="n">C_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_force_central_moments</span><span class="p">(</span><span class="n">F_tree</span><span class="p">,</span> <span class="n">psi_tree</span><span class="p">)</span>
<a id="__codelineno-0-2320" name="__codelineno-0-2320"></a>    <span class="n">Tf_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">S</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">C_tree</span><span class="p">)</span>
<a id="__codelineno-0-2321" name="__codelineno-0-2321"></a>    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">Tdash</span><span class="p">,</span> <span class="n">Tf</span><span class="p">:</span> <span class="n">Tdash</span> <span class="o">+</span> <span class="n">Tf</span><span class="p">,</span> <span class="n">Tdash_tree</span><span class="p">,</span> <span class="n">Tf_tree</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.MultiphaseCascade.collision" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">collision</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">collision</span><span class="p">(</span><span class="n">fin_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Cascaded LBM collision step for lattice.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2351">2351</a></span>
<span class="normal"><a href="#__codelineno-0-2352">2352</a></span>
<span class="normal"><a href="#__codelineno-0-2353">2353</a></span>
<span class="normal"><a href="#__codelineno-0-2354">2354</a></span>
<span class="normal"><a href="#__codelineno-0-2355">2355</a></span>
<span class="normal"><a href="#__codelineno-0-2356">2356</a></span>
<span class="normal"><a href="#__codelineno-0-2357">2357</a></span>
<span class="normal"><a href="#__codelineno-0-2358">2358</a></span>
<span class="normal"><a href="#__codelineno-0-2359">2359</a></span>
<span class="normal"><a href="#__codelineno-0-2360">2360</a></span>
<span class="normal"><a href="#__codelineno-0-2361">2361</a></span>
<span class="normal"><a href="#__codelineno-0-2362">2362</a></span>
<span class="normal"><a href="#__codelineno-0-2363">2363</a></span>
<span class="normal"><a href="#__codelineno-0-2364">2364</a></span>
<span class="normal"><a href="#__codelineno-0-2365">2365</a></span>
<span class="normal"><a href="#__codelineno-0-2366">2366</a></span>
<span class="normal"><a href="#__codelineno-0-2367">2367</a></span>
<span class="normal"><a href="#__codelineno-0-2368">2368</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-2351" name="__codelineno-0-2351"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<a id="__codelineno-0-2352" name="__codelineno-0-2352"></a><span class="k">def</span><span class="w"> </span><span class="nf">collision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fin_tree</span><span class="p">):</span>
<a id="__codelineno-0-2353" name="__codelineno-0-2353"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2354" name="__codelineno-0-2354"></a><span class="sd">    Cascaded LBM collision step for lattice.</span>
<a id="__codelineno-0-2355" name="__codelineno-0-2355"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2356" name="__codelineno-0-2356"></a>    <span class="n">fin_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_compute</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">fin_tree</span><span class="p">)</span>
<a id="__codelineno-0-2357" name="__codelineno-0-2357"></a>    <span class="n">rho_tree</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_macroscopic</span><span class="p">(</span><span class="n">fin_tree</span><span class="p">)</span>
<a id="__codelineno-0-2358" name="__codelineno-0-2358"></a>    <span class="n">u_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macroscopic_velocity</span><span class="p">(</span><span class="n">fin_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-2359" name="__codelineno-0-2359"></a>    <span class="n">T_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="n">M</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="n">fin_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
<a id="__codelineno-0-2360" name="__codelineno-0-2360"></a>    <span class="n">Tdash_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_central_moment</span><span class="p">(</span><span class="n">T_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-2361" name="__codelineno-0-2361"></a>    <span class="n">Tdash_eq_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eq_central_moments</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
<a id="__codelineno-0-2362" name="__codelineno-0-2362"></a>    <span class="n">Tout_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
<a id="__codelineno-0-2363" name="__codelineno-0-2363"></a>        <span class="k">lambda</span> <span class="n">Tdash</span><span class="p">,</span> <span class="n">Tdash_eq</span><span class="p">,</span> <span class="n">S</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Tdash</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">S</span><span class="p">)</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Tdash_eq</span><span class="p">,</span> <span class="n">S</span><span class="p">),</span> <span class="n">Tdash_tree</span><span class="p">,</span> <span class="n">Tdash_eq_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span>
<a id="__codelineno-0-2364" name="__codelineno-0-2364"></a>    <span class="p">)</span>
<a id="__codelineno-0-2365" name="__codelineno-0-2365"></a>    <span class="n">Tout_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_force</span><span class="p">(</span><span class="n">Tout_tree</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-2366" name="__codelineno-0-2366"></a>    <span class="n">Tout_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_central_moment_inverse</span><span class="p">(</span><span class="n">Tout_tree</span><span class="p">,</span> <span class="n">u_tree</span><span class="p">)</span>
<a id="__codelineno-0-2367" name="__codelineno-0-2367"></a>    <span class="n">fout_tree</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">T</span><span class="p">,</span> <span class="n">Minv</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">Minv</span><span class="p">),</span> <span class="n">Tout_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_inv</span><span class="p">)</span>
<a id="__codelineno-0-2368" name="__codelineno-0-2368"></a>    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fout</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">cast_to_output</span><span class="p">(</span><span class="n">fout</span><span class="p">),</span> <span class="n">fout_tree</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.MultiphaseCascade.compute_eq_central_moments" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">compute_eq_central_moments</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">compute_eq_central_moments</span><span class="p">(</span><span class="n">rho_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the central moments of the equilibrium distribution.</p>
<h4 id="src.multiphase.MultiphaseCascade.compute_eq_central_moments--parameters">Parameters</h4>
<p>rho_tree (pytree of jax.numpy.ndarray): Density field for all components.</p>
<h4 id="src.multiphase.MultiphaseCascade.compute_eq_central_moments--returns">Returns</h4>
<p>T_eq_tree (pytree of jax.numpy.ndarray): Central moments of the equilibrium distribution.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2174">2174</a></span>
<span class="normal"><a href="#__codelineno-0-2175">2175</a></span>
<span class="normal"><a href="#__codelineno-0-2176">2176</a></span>
<span class="normal"><a href="#__codelineno-0-2177">2177</a></span>
<span class="normal"><a href="#__codelineno-0-2178">2178</a></span>
<span class="normal"><a href="#__codelineno-0-2179">2179</a></span>
<span class="normal"><a href="#__codelineno-0-2180">2180</a></span>
<span class="normal"><a href="#__codelineno-0-2181">2181</a></span>
<span class="normal"><a href="#__codelineno-0-2182">2182</a></span>
<span class="normal"><a href="#__codelineno-0-2183">2183</a></span>
<span class="normal"><a href="#__codelineno-0-2184">2184</a></span>
<span class="normal"><a href="#__codelineno-0-2185">2185</a></span>
<span class="normal"><a href="#__codelineno-0-2186">2186</a></span>
<span class="normal"><a href="#__codelineno-0-2187">2187</a></span>
<span class="normal"><a href="#__codelineno-0-2188">2188</a></span>
<span class="normal"><a href="#__codelineno-0-2189">2189</a></span>
<span class="normal"><a href="#__codelineno-0-2190">2190</a></span>
<span class="normal"><a href="#__codelineno-0-2191">2191</a></span>
<span class="normal"><a href="#__codelineno-0-2192">2192</a></span>
<span class="normal"><a href="#__codelineno-0-2193">2193</a></span>
<span class="normal"><a href="#__codelineno-0-2194">2194</a></span>
<span class="normal"><a href="#__codelineno-0-2195">2195</a></span>
<span class="normal"><a href="#__codelineno-0-2196">2196</a></span>
<span class="normal"><a href="#__codelineno-0-2197">2197</a></span>
<span class="normal"><a href="#__codelineno-0-2198">2198</a></span>
<span class="normal"><a href="#__codelineno-0-2199">2199</a></span>
<span class="normal"><a href="#__codelineno-0-2200">2200</a></span>
<span class="normal"><a href="#__codelineno-0-2201">2201</a></span>
<span class="normal"><a href="#__codelineno-0-2202">2202</a></span>
<span class="normal"><a href="#__codelineno-0-2203">2203</a></span>
<span class="normal"><a href="#__codelineno-0-2204">2204</a></span>
<span class="normal"><a href="#__codelineno-0-2205">2205</a></span>
<span class="normal"><a href="#__codelineno-0-2206">2206</a></span>
<span class="normal"><a href="#__codelineno-0-2207">2207</a></span>
<span class="normal"><a href="#__codelineno-0-2208">2208</a></span>
<span class="normal"><a href="#__codelineno-0-2209">2209</a></span>
<span class="normal"><a href="#__codelineno-0-2210">2210</a></span>
<span class="normal"><a href="#__codelineno-0-2211">2211</a></span>
<span class="normal"><a href="#__codelineno-0-2212">2212</a></span>
<span class="normal"><a href="#__codelineno-0-2213">2213</a></span>
<span class="normal"><a href="#__codelineno-0-2214">2214</a></span>
<span class="normal"><a href="#__codelineno-0-2215">2215</a></span>
<span class="normal"><a href="#__codelineno-0-2216">2216</a></span>
<span class="normal"><a href="#__codelineno-0-2217">2217</a></span>
<span class="normal"><a href="#__codelineno-0-2218">2218</a></span>
<span class="normal"><a href="#__codelineno-0-2219">2219</a></span>
<span class="normal"><a href="#__codelineno-0-2220">2220</a></span>
<span class="normal"><a href="#__codelineno-0-2221">2221</a></span>
<span class="normal"><a href="#__codelineno-0-2222">2222</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-2174" name="__codelineno-0-2174"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-2175" name="__codelineno-0-2175"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_eq_central_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho_tree</span><span class="p">):</span>
<a id="__codelineno-0-2176" name="__codelineno-0-2176"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2177" name="__codelineno-0-2177"></a><span class="sd">    Calculate the central moments of the equilibrium distribution.</span>
<a id="__codelineno-0-2178" name="__codelineno-0-2178"></a>
<a id="__codelineno-0-2179" name="__codelineno-0-2179"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-2180" name="__codelineno-0-2180"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-2181" name="__codelineno-0-2181"></a><span class="sd">    rho_tree (pytree of jax.numpy.ndarray): Density field for all components.</span>
<a id="__codelineno-0-2182" name="__codelineno-0-2182"></a>
<a id="__codelineno-0-2183" name="__codelineno-0-2183"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-2184" name="__codelineno-0-2184"></a><span class="sd">    -------</span>
<a id="__codelineno-0-2185" name="__codelineno-0-2185"></a><span class="sd">    T_eq_tree (pytree of jax.numpy.ndarray): Central moments of the equilibrium distribution.</span>
<a id="__codelineno-0-2186" name="__codelineno-0-2186"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2187" name="__codelineno-0-2187"></a>
<a id="__codelineno-0-2188" name="__codelineno-0-2188"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">rho</span><span class="p">):</span>
<a id="__codelineno-0-2189" name="__codelineno-0-2189"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD2Q9</span><span class="p">):</span>
<a id="__codelineno-0-2190" name="__codelineno-0-2190"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-2191" name="__codelineno-0-2191"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-2192" name="__codelineno-0-2192"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2193" name="__codelineno-0-2193"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2194" name="__codelineno-0-2194"></a>
<a id="__codelineno-0-2195" name="__codelineno-0-2195"></a>            <span class="k">return</span> <span class="n">T_eq</span>
<a id="__codelineno-0-2196" name="__codelineno-0-2196"></a>
<a id="__codelineno-0-2197" name="__codelineno-0-2197"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q19</span><span class="p">):</span>
<a id="__codelineno-0-2198" name="__codelineno-0-2198"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-2199" name="__codelineno-0-2199"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-2200" name="__codelineno-0-2200"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2201" name="__codelineno-0-2201"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2202" name="__codelineno-0-2202"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2203" name="__codelineno-0-2203"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2204" name="__codelineno-0-2204"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2205" name="__codelineno-0-2205"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2206" name="__codelineno-0-2206"></a>
<a id="__codelineno-0-2207" name="__codelineno-0-2207"></a>            <span class="k">return</span> <span class="n">T_eq</span>
<a id="__codelineno-0-2208" name="__codelineno-0-2208"></a>
<a id="__codelineno-0-2209" name="__codelineno-0-2209"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q27</span><span class="p">):</span>
<a id="__codelineno-0-2210" name="__codelineno-0-2210"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-2211" name="__codelineno-0-2211"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-2212" name="__codelineno-0-2212"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2213" name="__codelineno-0-2213"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2214" name="__codelineno-0-2214"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2215" name="__codelineno-0-2215"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2216" name="__codelineno-0-2216"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2217" name="__codelineno-0-2217"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2218" name="__codelineno-0-2218"></a>            <span class="n">T_eq</span> <span class="o">=</span> <span class="n">T_eq</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">26</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
<a id="__codelineno-0-2219" name="__codelineno-0-2219"></a>
<a id="__codelineno-0-2220" name="__codelineno-0-2220"></a>            <span class="k">return</span> <span class="n">T_eq</span>
<a id="__codelineno-0-2221" name="__codelineno-0-2221"></a>
<a id="__codelineno-0-2222" name="__codelineno-0-2222"></a>    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rho</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="n">rho_tree</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.multiphase.MultiphaseCascade.compute_force_central_moments" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">compute_force_central_moments</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">compute_force_central_moments</span><span class="p">(</span><span class="n">F_tree</span><span class="p">,</span> <span class="n">psi_tree</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the central moments of the force distribution. Includes modification to accurately replicate mechanical stability conditions.</p>
<h4 id="src.multiphase.MultiphaseCascade.compute_force_central_moments--parameters">Parameters</h4>
<p>F_tree (pytree of jax.numpy.ndarray): Force field.</p>
<p>psi_tree (pytree of jax.numpy.ndarray): Potential field.</p>
<h4 id="src.multiphase.MultiphaseCascade.compute_force_central_moments--returns">Returns</h4>
<p>T_eq_tree (pytree of jax.numpy.ndarray): Central moments of the force distribution.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/multiphase.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2224">2224</a></span>
<span class="normal"><a href="#__codelineno-0-2225">2225</a></span>
<span class="normal"><a href="#__codelineno-0-2226">2226</a></span>
<span class="normal"><a href="#__codelineno-0-2227">2227</a></span>
<span class="normal"><a href="#__codelineno-0-2228">2228</a></span>
<span class="normal"><a href="#__codelineno-0-2229">2229</a></span>
<span class="normal"><a href="#__codelineno-0-2230">2230</a></span>
<span class="normal"><a href="#__codelineno-0-2231">2231</a></span>
<span class="normal"><a href="#__codelineno-0-2232">2232</a></span>
<span class="normal"><a href="#__codelineno-0-2233">2233</a></span>
<span class="normal"><a href="#__codelineno-0-2234">2234</a></span>
<span class="normal"><a href="#__codelineno-0-2235">2235</a></span>
<span class="normal"><a href="#__codelineno-0-2236">2236</a></span>
<span class="normal"><a href="#__codelineno-0-2237">2237</a></span>
<span class="normal"><a href="#__codelineno-0-2238">2238</a></span>
<span class="normal"><a href="#__codelineno-0-2239">2239</a></span>
<span class="normal"><a href="#__codelineno-0-2240">2240</a></span>
<span class="normal"><a href="#__codelineno-0-2241">2241</a></span>
<span class="normal"><a href="#__codelineno-0-2242">2242</a></span>
<span class="normal"><a href="#__codelineno-0-2243">2243</a></span>
<span class="normal"><a href="#__codelineno-0-2244">2244</a></span>
<span class="normal"><a href="#__codelineno-0-2245">2245</a></span>
<span class="normal"><a href="#__codelineno-0-2246">2246</a></span>
<span class="normal"><a href="#__codelineno-0-2247">2247</a></span>
<span class="normal"><a href="#__codelineno-0-2248">2248</a></span>
<span class="normal"><a href="#__codelineno-0-2249">2249</a></span>
<span class="normal"><a href="#__codelineno-0-2250">2250</a></span>
<span class="normal"><a href="#__codelineno-0-2251">2251</a></span>
<span class="normal"><a href="#__codelineno-0-2252">2252</a></span>
<span class="normal"><a href="#__codelineno-0-2253">2253</a></span>
<span class="normal"><a href="#__codelineno-0-2254">2254</a></span>
<span class="normal"><a href="#__codelineno-0-2255">2255</a></span>
<span class="normal"><a href="#__codelineno-0-2256">2256</a></span>
<span class="normal"><a href="#__codelineno-0-2257">2257</a></span>
<span class="normal"><a href="#__codelineno-0-2258">2258</a></span>
<span class="normal"><a href="#__codelineno-0-2259">2259</a></span>
<span class="normal"><a href="#__codelineno-0-2260">2260</a></span>
<span class="normal"><a href="#__codelineno-0-2261">2261</a></span>
<span class="normal"><a href="#__codelineno-0-2262">2262</a></span>
<span class="normal"><a href="#__codelineno-0-2263">2263</a></span>
<span class="normal"><a href="#__codelineno-0-2264">2264</a></span>
<span class="normal"><a href="#__codelineno-0-2265">2265</a></span>
<span class="normal"><a href="#__codelineno-0-2266">2266</a></span>
<span class="normal"><a href="#__codelineno-0-2267">2267</a></span>
<span class="normal"><a href="#__codelineno-0-2268">2268</a></span>
<span class="normal"><a href="#__codelineno-0-2269">2269</a></span>
<span class="normal"><a href="#__codelineno-0-2270">2270</a></span>
<span class="normal"><a href="#__codelineno-0-2271">2271</a></span>
<span class="normal"><a href="#__codelineno-0-2272">2272</a></span>
<span class="normal"><a href="#__codelineno-0-2273">2273</a></span>
<span class="normal"><a href="#__codelineno-0-2274">2274</a></span>
<span class="normal"><a href="#__codelineno-0-2275">2275</a></span>
<span class="normal"><a href="#__codelineno-0-2276">2276</a></span>
<span class="normal"><a href="#__codelineno-0-2277">2277</a></span>
<span class="normal"><a href="#__codelineno-0-2278">2278</a></span>
<span class="normal"><a href="#__codelineno-0-2279">2279</a></span>
<span class="normal"><a href="#__codelineno-0-2280">2280</a></span>
<span class="normal"><a href="#__codelineno-0-2281">2281</a></span>
<span class="normal"><a href="#__codelineno-0-2282">2282</a></span>
<span class="normal"><a href="#__codelineno-0-2283">2283</a></span>
<span class="normal"><a href="#__codelineno-0-2284">2284</a></span>
<span class="normal"><a href="#__codelineno-0-2285">2285</a></span>
<span class="normal"><a href="#__codelineno-0-2286">2286</a></span>
<span class="normal"><a href="#__codelineno-0-2287">2287</a></span>
<span class="normal"><a href="#__codelineno-0-2288">2288</a></span>
<span class="normal"><a href="#__codelineno-0-2289">2289</a></span>
<span class="normal"><a href="#__codelineno-0-2290">2290</a></span>
<span class="normal"><a href="#__codelineno-0-2291">2291</a></span>
<span class="normal"><a href="#__codelineno-0-2292">2292</a></span>
<span class="normal"><a href="#__codelineno-0-2293">2293</a></span>
<span class="normal"><a href="#__codelineno-0-2294">2294</a></span>
<span class="normal"><a href="#__codelineno-0-2295">2295</a></span>
<span class="normal"><a href="#__codelineno-0-2296">2296</a></span>
<span class="normal"><a href="#__codelineno-0-2297">2297</a></span>
<span class="normal"><a href="#__codelineno-0-2298">2298</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-2224" name="__codelineno-0-2224"></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-2225" name="__codelineno-0-2225"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_force_central_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F_tree</span><span class="p">,</span> <span class="n">psi_tree</span><span class="p">):</span>
<a id="__codelineno-0-2226" name="__codelineno-0-2226"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2227" name="__codelineno-0-2227"></a><span class="sd">    Calculate the central moments of the force distribution. Includes modification to accurately replicate mechanical stability conditions.</span>
<a id="__codelineno-0-2228" name="__codelineno-0-2228"></a>
<a id="__codelineno-0-2229" name="__codelineno-0-2229"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-2230" name="__codelineno-0-2230"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-2231" name="__codelineno-0-2231"></a><span class="sd">    F_tree (pytree of jax.numpy.ndarray): Force field.</span>
<a id="__codelineno-0-2232" name="__codelineno-0-2232"></a>
<a id="__codelineno-0-2233" name="__codelineno-0-2233"></a><span class="sd">    psi_tree (pytree of jax.numpy.ndarray): Potential field.</span>
<a id="__codelineno-0-2234" name="__codelineno-0-2234"></a>
<a id="__codelineno-0-2235" name="__codelineno-0-2235"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-2236" name="__codelineno-0-2236"></a><span class="sd">    -------</span>
<a id="__codelineno-0-2237" name="__codelineno-0-2237"></a><span class="sd">    T_eq_tree (pytree of jax.numpy.ndarray): Central moments of the force distribution.</span>
<a id="__codelineno-0-2238" name="__codelineno-0-2238"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2239" name="__codelineno-0-2239"></a>
<a id="__codelineno-0-2240" name="__codelineno-0-2240"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">s_b</span><span class="p">):</span>
<a id="__codelineno-0-2241" name="__codelineno-0-2241"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD2Q9</span><span class="p">):</span>
<a id="__codelineno-0-2242" name="__codelineno-0-2242"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-2243" name="__codelineno-0-2243"></a>            <span class="n">Fx</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2244" name="__codelineno-0-2244"></a>            <span class="n">Fy</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-2245" name="__codelineno-0-2245"></a>            <span class="n">eta</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">Fx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Fy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">s_b</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span>  <span class="c1"># For mechanical stability</span>
<a id="__codelineno-0-2246" name="__codelineno-0-2246"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span><span class="p">)</span>
<a id="__codelineno-0-2247" name="__codelineno-0-2247"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span><span class="p">)</span>
<a id="__codelineno-0-2248" name="__codelineno-0-2248"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
<a id="__codelineno-0-2249" name="__codelineno-0-2249"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2250" name="__codelineno-0-2250"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2251" name="__codelineno-0-2251"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2252" name="__codelineno-0-2252"></a>
<a id="__codelineno-0-2253" name="__codelineno-0-2253"></a>            <span class="k">return</span> <span class="n">C</span>
<a id="__codelineno-0-2254" name="__codelineno-0-2254"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q19</span><span class="p">):</span>
<a id="__codelineno-0-2255" name="__codelineno-0-2255"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-2256" name="__codelineno-0-2256"></a>            <span class="n">Fx</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2257" name="__codelineno-0-2257"></a>            <span class="n">Fy</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-2258" name="__codelineno-0-2258"></a>            <span class="n">Fz</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-2259" name="__codelineno-0-2259"></a>            <span class="n">eta</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">Fx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Fy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Fz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">s_b</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span>
<a id="__codelineno-0-2260" name="__codelineno-0-2260"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span><span class="p">)</span>
<a id="__codelineno-0-2261" name="__codelineno-0-2261"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span><span class="p">)</span>
<a id="__codelineno-0-2262" name="__codelineno-0-2262"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fz</span><span class="p">)</span>
<a id="__codelineno-0-2263" name="__codelineno-0-2263"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
<a id="__codelineno-0-2264" name="__codelineno-0-2264"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
<a id="__codelineno-0-2265" name="__codelineno-0-2265"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
<a id="__codelineno-0-2266" name="__codelineno-0-2266"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2267" name="__codelineno-0-2267"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2268" name="__codelineno-0-2268"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2269" name="__codelineno-0-2269"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2270" name="__codelineno-0-2270"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2271" name="__codelineno-0-2271"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2272" name="__codelineno-0-2272"></a>
<a id="__codelineno-0-2273" name="__codelineno-0-2273"></a>            <span class="k">return</span> <span class="n">C</span>
<a id="__codelineno-0-2274" name="__codelineno-0-2274"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">LatticeD3Q27</span><span class="p">):</span>
<a id="__codelineno-0-2275" name="__codelineno-0-2275"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">q</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precisionPolicy</span><span class="o">.</span><span class="n">compute_dtype</span><span class="p">)</span>
<a id="__codelineno-0-2276" name="__codelineno-0-2276"></a>            <span class="n">Fx</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2277" name="__codelineno-0-2277"></a>            <span class="n">Fy</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-2278" name="__codelineno-0-2278"></a>            <span class="n">Fz</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-2279" name="__codelineno-0-2279"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span><span class="p">)</span>
<a id="__codelineno-0-2280" name="__codelineno-0-2280"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span><span class="p">)</span>
<a id="__codelineno-0-2281" name="__codelineno-0-2281"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fz</span><span class="p">)</span>
<a id="__codelineno-0-2282" name="__codelineno-0-2282"></a>            <span class="n">eta</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">Fx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Fy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Fz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">s_b</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span>
<a id="__codelineno-0-2283" name="__codelineno-0-2283"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
<a id="__codelineno-0-2284" name="__codelineno-0-2284"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
<a id="__codelineno-0-2285" name="__codelineno-0-2285"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
<a id="__codelineno-0-2286" name="__codelineno-0-2286"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2287" name="__codelineno-0-2287"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2288" name="__codelineno-0-2288"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2289" name="__codelineno-0-2289"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2290" name="__codelineno-0-2290"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2291" name="__codelineno-0-2291"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs2</span><span class="p">)</span>
<a id="__codelineno-0-2292" name="__codelineno-0-2292"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">23</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2293" name="__codelineno-0-2293"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2294" name="__codelineno-0-2294"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Fz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">cs</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-2295" name="__codelineno-0-2295"></a>
<a id="__codelineno-0-2296" name="__codelineno-0-2296"></a>            <span class="k">return</span> <span class="n">C</span>
<a id="__codelineno-0-2297" name="__codelineno-0-2297"></a>
<a id="__codelineno-0-2298" name="__codelineno-0-2298"></a>    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">F</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">s_b</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">s_b</span><span class="p">),</span> <span class="n">F_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span> <span class="n">psi_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_b</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["header.autohide"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>